"use strict";var _createClass=function(){function n(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}define(["SwiftOtter_Test/js/renderer/slide/question.babel","SwiftOtter_Test/js/api.babel","SwiftOtter_Test/js/ga.babel"],function(l,n,r){function o(e){return e.results.score>this.config.pass_score?"test-stats--passed":"test-stats--failed"}return function(){function s(e,t){_classCallCheck(this,s),this.container=e,this.config=t,this.slideRenderer=new l(this.config),this.api=new n({urls:{}})}return _createClass(s,[{key:"render",value:function(e,t){this.container.innerHTML="",this.container.appendChild(this.renderHtml(t)),this.bindEmail(e,t),t.hasOwnProperty("all_features_available")&&t.all_features_available?(r.completeTest(),this.allFeaturesAvailable=!0):(r.completeFreeTest(),this.allFeaturesAvailable=!1)}},{key:"bindEmail",value:function(t,s){var n=this,e=this.container.querySelector(".email-me");s.client_id;e&&s.hasOwnProperty("all_features_available")&&s.all_features_available?e.style.display="":(this.container.querySelector(".email-me-message").style.display="none",this.container.querySelector(".email-me__title").style.display="none"),this.container.querySelector(".email-me__submit").addEventListener("click",function(e){(function(e,t){var s=this,n=this.container.querySelector(".email-me__email"),i=this.container.querySelector(".email-me__name"),a=this.container.querySelector(".email-me");a.classList.add("is-loading"),r.sendEmail(),this.api.email(e,t,n.value,i.value).then(function(){a.classList.remove("is-loading");var e=s.container.querySelector(".email-me-message");e.innerText="Your scores have been sent!",setTimeout(function(){return e.innerText=""},4e3)})}).call(n,t,s.client_id)})}},{key:"renderHtml",value:function(e){var t=this,s=e.questions.filter(function(e){return 0<e.id}),n=1,i=s.map(function(e){return new l(t.config,e).render(n++,s.count,{questionModifier:"test-question--answered",answerModifier:"test-question__answer--answered",disableFormFields:!0}).firstElementChild.outerHTML}),a='\n        <div class="test-stats-container">\n        <div class="test-primary-results">\n          <h2>Result card</h2>\n          <h3>'+e.name+'</h3>\n          <ul class="test-stats '+o.call(this,e)+'">\n              <li class="test-stats__score">'+e.results.score+'%</li>\n              <li class="test-stats__guidance">'+e.results.guidance+'</li>\n          </ul>\n          <h4 class="email-me__title">Email results to me:</h4>\n          <div class="email-me" style="display: none">\n              <input type="email" placeholder="Your email" class="email-me__email input-text" value="'+(localStorage.hasOwnProperty("email")?localStorage.email:"")+'"/>\n              <input type="text" placeholder="Your name" class="email-me__name input-text" value="'+(localStorage.hasOwnProperty("name")?localStorage.name:"")+'"/>\n              <button type="button" class="email-me__submit info-button">Send. '+window.jsonConfig.icons.next+'</button>\n          </div>\n          <div class="email-me-message"></div>\n          '+this.renderObjectiveScores(e)+'\n        </div>\n        <ul class="test-questions test-questions--answered">'+i.join("\n")+'</ul>\n        <div class="test-status__button-container">\n            <button class="test-question__close info-button">Close</button>\n            <button class="test-question__restart info-button">Start Over</button>\n        </div>        \n        </div>\n      ';return document.createRange().createContextualFragment(a)}},{key:"renderObjectiveScores",value:function(e){if(!e.results.hasOwnProperty("objective_results")||!e.results.objective_results.length)return"";if(e.hasOwnProperty("all_features_available")&&e.all_features_available){var t=e.results.objective_results.map(function(e){return'\n          <li>\n            <span class="objective__score">'+(e=JSON.parse(e)).score+'% correct</span>\n            <span class="objective__title">'+e.name+"</span>\n          </li>\n        "});return'\n        <ul class="objective-stats '+o.call(this,e)+'">\n            '+t.join("\n")+"\n        </ul>"}}},{key:"renderQuestion",value:function(t){var s=this;return'\n        <li class="test-question test-question__answered" data-question-id="'+t.id+'">\n            <h2 class="test-question__title">'+t.question+'</h2>\n            <div class="test-question__subtext">'+t.subtext+'</div>\n            <ul class="test-question__answers">\n                '+t.answers.map(function(e){return s.renderAnswer(t,e,"test-question__answered")}).join("\n")+"\n            </ul>\n        </li>\n      "}},{key:"renderAnswer",value:function(e,t){var s=t.is_chosen?' checked="checked"':"",n=t.is_chosen?" test-question__answer--chosen":"",i=t.is_correct?" test-question__answer--correct":"";return"onechoice"===e.type?'<li class="test-question__answer test-question__answer--onechoice'+i+n+'" data-question-id="'+e.id+'"><label><input type="radio" name="question-'+e.id+'"'+s+" disabled/>"+t.answer+"</label></li>":'<li class="test-question__answer test-question__answer--multichoice'+i+n+'" data-question-id="'+e.id+'"><label><input type="checkbox" name="question-'+e.id+'"'+s+" disabled/>"+t.answer+"</label></li>"}}]),s}()});