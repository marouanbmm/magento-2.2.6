function checkBrowser(e){return navigator.userAgent.match(new RegExp(e,"i"))}function isInternetExplorer(e){return checkBrowser("msie"+(e?" "+e:""))}function formatVersion(e,t){return parseInt(checkBrowser(e).first().split(t).last())}function findBrowserVersion(e){if(checkBrowser(e))return isInternetExplorer()?formatVersion(e," "):formatVersion(e,"/");console.warn("Not a recognized web browser");return void 0}function str_repeat(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}function sprintf(){for(var e,t,n,i,a,o=0,s=arguments[o++],l=[];s;){if(t=/^[^\x25]+/.exec(s))l.push(t[0]);else if(t=/^\x25{2}/.exec(s))l.push("%");else{if(!(t=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(s)))throw"Huh ?!";if(null==(e=arguments[t[1]||o++])||void 0==e)throw"Too few arguments.";if(/[^s]/.test(t[7])&&"number"!=typeof e)throw"Expecting number but found "+typeof e;switch(t[7]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e);break;case"e":e=t[6]?e.toExponential(t[6]):e.toExponential();break;case"f":e=t[6]?parseFloat(e).toFixed(t[6]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&t[6]?e.substring(0,t[6]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(t[7])&&t[2]&&e>0?"+"+e:e;i=t[3]?"0"==t[3]?"0":t[3].charAt(1):" ";a=t[5]-String(e).length;n=t[5]?str_repeat(i,a):"";l.push(t[4]?e+n:n+e)}s=s.substring(t[0].length)}return l.join("")}function MarkerClusterer(e,t,n){this.extend(MarkerClusterer,google.maps.OverlayView);this.map_=e;this.markers_=[];this.clusters_=[];this.sizes=[53,56,66,78,90];this.styles_=[];this.ready_=!1;var i=n||{};this.markerClass=i.styles[0]["markerClass"];this.shadowClass=i.styles[0]["shadowClass"];this.gridSize_=i["gridSize"]||60;this.maxZoom_=i["maxZoom"]||null;this.styles_=i["styles"]||[];this.imagePath_=i["imagePath"]||this.MARKER_CLUSTER_IMAGE_PATH_;this.imageExtension_=i["imageExtension"]||this.MARKER_CLUSTER_IMAGE_EXTENSION_;this.zoomOnClick_=i["zoomOnClick"]||!0;this.setupStyles_();this.setMap(e);this.prevZoom_=this.map_.getZoom();var a=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var e=a.map_.mapTypes[a.map_.getMapTypeId()].maxZoom,t=a.map_.getZoom();if(!(0>t||t>e)&&a.prevZoom_!=t){a.prevZoom_=a.map_.getZoom();a.resetViewport()}});google.maps.event.addListener(this.map_,"bounds_changed",function(){a.redraw()});t&&t.length&&this.addMarkers(t,!1)}function Cluster(e){this.markerClusterer_=e;this.map_=e.getMap();this.gridSize_=e.getGridSize();this.center_=null;this.markers_=[];this.bounds_=null;this.clusterIcon_=new ClusterIcon(this,e.getStyles(),e.getGridSize())}function ClusterIcon(e,t,n){e.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.styles_=t;this.padding_=n||0;this.cluster_=e;this.center_=null;this.map_=e.getMap();this.div_=null;this.sums_=null;this.visible_=!1;this.setMap(this.map_)}function parseUri(e){for(var t=parseUri.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},a=14;a--;)i[t.key[a]]=n[a]||"";i[t.q.name]={};i[t.key[12]].replace(t.q.parser,function(e,n,a){n&&(i[t.q.name][n]=a)});return i}function getChromeVersion(){var e=/Chrome[\/\s](\d+\.\d+)/;return e.test(navigator.userAgent)?Number(RegExp.$1):0}function errorfunction(){}function errorGeolocation(){}function buildJsonPathOrUrl(e){var t=document.createElement("a");t.href=e;var n=t.pathname+".json"+t.search;0!==n.indexOf("/")&&(n="/"+n);return n}function initializePointsOfSaleJSON(){var e,t=jQuery("select[class=redirects]"),n=jQuery("#lf_listmap_canvas"),i="undefined"!=typeof useOptimisedPosResults;lf.app.searchForm=new lf.SearchForm(jQuery("#lf_search")[0]);if(t.length>0||n.length>0){e=i?window.location.href:"/points_of_sale";e=buildJsonPathOrUrl(e);jQuery.getJSON(e).done(function(e){app.front_office=i?{points_of_sale:{all:e.points_of_sale},countries:["all"]}:e;t.length>0&&lf.app.searchForm.populateSelectorFromData(app.front_office.points_of_sale);if(n.length>0){lf.app.listMap=new lf.ListMap(n[0]);app.mapMarkers={locateOnMap:function(e){lf.app.listMap.showMarkerByIndex(e)}}}})}}function initializeAppDependentObjects(){jQuery("#lf_product_search").each(function(){lf.app.productSearchForm=new lf.ProductSearchForm(this)});jQuery("#lf_accessmap_canvas").each(function(){var e=lf.app.getApiModule(),t=jQuery(this);lf.app.accessMap=new e.Map(this,function(n){lf.app.accessMapMarker=new e.SingleMarker(posMarkerCoordinates);lf.app.accessMapMarker.setMap(n);n.setCenter(posMarkerCoordinates);n.setZoom(n.getPointOfSaleZoomLevel());n.redraw();t.trigger("lf.mapReady",[n])})})}function initializeFormObjects(){lf.app.posForms=[];jQuery("#lf_contactform form, #lf_coordinatesrequest form, #lf_newsletter form, #lf_reservation_form form").each(function(){lf.app.posForms.push(new lf.AjaxSubmissionForm(this))})}function detectCountry(e){var t=e.find("form").find("#country"),n=new RegExp("[\\?&]country=([^&#]*)").exec(window.location.href);n?t.find("option[value="+n[1]+"]").attr("selected",!0):jQuery.getJSON("/geocode.json",function(e){t.find("option[value="+e.country_code+"]").attr("selected",!0);"function"==typeof t.selectmenu&&t.is(":visible")&&t.selectmenu("refresh")})}void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0),function(e,t,n){function i(n){var i=t.console;o[n]||(o[n]=!0,e.migrateWarnings.push(n),i&&i.warn&&!e.migrateMute&&(i.warn("JQMIGRATE: "+n),e.migrateTrace&&i.trace&&i.trace()))}function a(t,a,o,s){if(Object.defineProperty)try{return Object.defineProperty(t,a,{configurable:!0,enumerable:!0,get:function(){return i(s),o},set:function(e){i(s),o=e}}),n}catch(l){}e._definePropertyBroken=!0,t[a]=o}var o={};e.migrateWarnings=[],!e.migrateMute&&t.console&&t.console.log&&t.console.log("JQMIGRATE: Logging is active"),e.migrateTrace===n&&(e.migrateTrace=!0),e.migrateReset=function(){o={},e.migrateWarnings.length=0},"BackCompat"===document.compatMode&&i("jQuery is not compatible with Quirks Mode");var s=e("<input/>",{size:1}).attr("size")&&e.attrFn,l=e.attr,r=e.attrHooks.value&&e.attrHooks.value.get||function(){return null},u=e.attrHooks.value&&e.attrHooks.value.set||function(){return n},d=/^(?:input|button)$/i,c=/^[238]$/,p=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,h=/^(?:checked|selected)$/i;a(e,"attrFn",s||{},"jQuery.attrFn is deprecated"),e.attr=function(t,a,o,r){var u=a.toLowerCase(),f=t&&t.nodeType;return r&&(4>l.length&&i("jQuery.fn.attr( props, pass ) is deprecated"),t&&!c.test(f)&&(s?a in s:e.isFunction(e.fn[a])))?e(t)[a](o):("type"===a&&o!==n&&d.test(t.nodeName)&&t.parentNode&&i("Can't change the 'type' of an input or button in IE 6/7/8"),!e.attrHooks[u]&&p.test(u)&&(e.attrHooks[u]={get:function(t,i){var a,o=e.prop(t,i);return o===!0||"boolean"!=typeof o&&(a=t.getAttributeNode(i))&&a.nodeValue!==!1?i.toLowerCase():n},set:function(t,n,i){var a;return n===!1?e.removeAttr(t,i):(a=e.propFix[i]||i,a in t&&(t[a]=!0),t.setAttribute(i,i.toLowerCase())),i}},h.test(u)&&i("jQuery.fn.attr('"+u+"') may use property instead of attribute")),l.call(e,t,a,o))},e.attrHooks.value={get:function(e,t){var n=(e.nodeName||"").toLowerCase();return"button"===n?r.apply(this,arguments):("input"!==n&&"option"!==n&&i("jQuery.fn.attr('value') no longer gets properties"),t in e?e.value:null)},set:function(e,t){var a=(e.nodeName||"").toLowerCase();return"button"===a?u.apply(this,arguments):("input"!==a&&"option"!==a&&i("jQuery.fn.attr('value', val) no longer sets properties"),e.value=t,n)}};var f,m,_=e.fn.init,g=e.parseJSON,v=/^([^<]*)(<[\w\W]+>)([^>]*)$/;e.fn.init=function(t,n,a){var o;return t&&"string"==typeof t&&!e.isPlainObject(n)&&(o=v.exec(e.trim(t)))&&o[0]&&("<"!==t.charAt(0)&&i("$(html) HTML strings must start with '<' character"),o[3]&&i("$(html) HTML text after last tag is ignored"),"#"===o[0].charAt(0)&&(i("HTML string cannot start with a '#' character"),e.error("JQMIGRATE: Invalid selector string (XSS)")),n&&n.context&&(n=n.context),e.parseHTML)?_.call(this,e.parseHTML(o[2],n,!0),n,a):_.apply(this,arguments)},e.fn.init.prototype=e.fn,e.parseJSON=function(e){return e||null===e?g.apply(this,arguments):(i("jQuery.parseJSON requires a valid JSON string"),null)},e.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e.browser||(f=e.uaMatch(navigator.userAgent),m={},f.browser&&(m[f.browser]=!0,m.version=f.version),m.chrome?m.webkit=!0:m.webkit&&(m.safari=!0),e.browser=m),a(e,"browser",e.browser,"jQuery.browser is deprecated"),e.sub=function(){function t(e,n){return new t.fn.init(e,n)}e.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(i,a){return a&&a instanceof e&&!(a instanceof t)&&(a=t(a)),e.fn.init.call(this,i,a,n)},t.fn.init.prototype=t.fn;var n=t(document);return i("jQuery.sub() is deprecated"),t},e.ajaxSetup({converters:{"text json":e.parseJSON}});var y=e.fn.data;e.fn.data=function(t){var a,o,s=this[0];return!s||"events"!==t||1!==arguments.length||(a=e.data(s,t),o=e._data(s,t),a!==n&&a!==o||o===n)?y.apply(this,arguments):(i("Use of jQuery.fn.data('events') is deprecated"),o)};var b=/\/(java|ecma)script/i,w=e.fn.andSelf||e.fn.addBack;e.fn.andSelf=function(){return i("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),w.apply(this,arguments)},e.clean||(e.clean=function(t,a,o,s){a=a||document,a=!a.nodeType&&a[0]||a,a=a.ownerDocument||a,i("jQuery.clean() is deprecated");var l,r,u,d,c=[];if(e.merge(c,e.buildFragment(t,a).childNodes),o)for(u=function(e){return!e.type||b.test(e.type)?s?s.push(e.parentNode?e.parentNode.removeChild(e):e):o.appendChild(e):n},l=0;null!=(r=c[l]);l++)e.nodeName(r,"script")&&u(r)||(o.appendChild(r),r.getElementsByTagName!==n&&(d=e.grep(e.merge([],r.getElementsByTagName("script")),u),c.splice.apply(c,[l+1,0].concat(d)),l+=d.length));return c});var k=e.event.add,x=e.event.remove,S=e.event.trigger,C=e.fn.toggle,T=e.fn.live,A=e.fn.die,P="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",M=RegExp("\\b(?:"+P+")\\b"),D=/(?:^|\s)hover(\.\S+|)\b/,I=function(t){return"string"!=typeof t||e.event.special.hover?t:(D.test(t)&&i("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),t&&t.replace(D,"mouseenter$1 mouseleave$1"))};e.event.props&&"attrChange"!==e.event.props[0]&&e.event.props.unshift("attrChange","attrName","relatedNode","srcElement"),e.event.dispatch&&a(e.event,"handle",e.event.dispatch,"jQuery.event.handle is undocumented and deprecated"),e.event.add=function(e,t,n,a,o){e!==document&&M.test(t)&&i("AJAX events should be attached to document: "+t),k.call(this,e,I(t||""),n,a,o)},e.event.remove=function(e,t,n,i,a){x.call(this,e,I(t)||"",n,i,a)},e.fn.error=function(){var e=Array.prototype.slice.call(arguments,0);return i("jQuery.fn.error() is deprecated"),e.splice(0,0,"error"),arguments.length?this.bind.apply(this,e):(this.triggerHandler.apply(this,e),this)},e.fn.toggle=function(t,n){if(!e.isFunction(t)||!e.isFunction(n))return C.apply(this,arguments);i("jQuery.fn.toggle(handler, handler...) is deprecated");var a=arguments,o=t.guid||e.guid++,s=0,l=function(n){var i=(e._data(this,"lastToggle"+t.guid)||0)%s;return e._data(this,"lastToggle"+t.guid,i+1),n.preventDefault(),a[i].apply(this,arguments)||!1};for(l.guid=o;a.length>s;)a[s++].guid=o;return this.click(l)},e.fn.live=function(t,n,a){return i("jQuery.fn.live() is deprecated"),T?T.apply(this,arguments):(e(this.context).on(t,this.selector,n,a),this)},e.fn.die=function(t,n){return i("jQuery.fn.die() is deprecated"),A?A.apply(this,arguments):(e(this.context).off(t,this.selector||"**",n),this)},e.event.trigger=function(e,t,n,a){return n||M.test(e)||i("Global events are undocumented and deprecated"),S.call(this,e,t,n||document,a)},e.each(P.split("|"),function(t,n){e.event.special[n]={setup:function(){var t=this;return t!==document&&(e.event.add(document,n+"."+e.guid,function(){e.event.trigger(n,null,t,!0)}),e._data(this,n,e.guid++)),!1},teardown:function(){return this!==document&&e.event.remove(document,n+"."+e._data(this,n)),!1}}})}(jQuery,window);var Base64={};Base64.code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Base64.encode=function(e,t){t="undefined"==typeof t?!1:t;var n,i,a,o,s,l,r,u,d,c,p,h=[],f="",m=Base64.code;c=t?Utf8.encode(e):e;d=c.length%3;if(d>0)for(;d++<3;){f+="=";c+="\x00"}for(d=0;d<c.length;d+=3){n=c.charCodeAt(d);i=c.charCodeAt(d+1);a=c.charCodeAt(d+2);o=n<<16|i<<8|a;s=o>>18&63;l=o>>12&63;r=o>>6&63;u=63&o;h[d/3]=m.charAt(s)+m.charAt(l)+m.charAt(r)+m.charAt(u)}p=h.join("");p=p.slice(0,p.length-f.length)+f;return p};Base64.decode=function(e,t){t="undefined"==typeof t?!1:t;var n,i,a,o,s,l,r,u,d,c,p=[],h=Base64.code;c=t?Utf8.decode(e):e;for(var f=0;f<c.length;f+=4){o=h.indexOf(c.charAt(f));s=h.indexOf(c.charAt(f+1));l=h.indexOf(c.charAt(f+2));r=h.indexOf(c.charAt(f+3));u=o<<18|s<<12|l<<6|r;n=u>>>16&255;i=u>>>8&255;a=255&u;p[f/4]=String.fromCharCode(n,i,a);64==r&&(p[f/4]=String.fromCharCode(n,i));64==l&&(p[f/4]=String.fromCharCode(n))}d=p.join("");return t?Utf8.decode(d):d};if("undefined"==typeof atob)var atob=Base64.decode;var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var i=new this;n.call(i,e);i.base=function(){};delete Base._prototyping;var a=i.constructor,o=i.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==o){this._constructing=!0;a.apply(this,arguments);delete this._constructing}else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],i)};o.ancestor=this;o.extend=this.extend;o.forEach=this.forEach;o.implement=this.implement;o.prototype=i;o.toString=this.toString;o.valueOf=function(e){return"object"==e?o:a.valueOf()};n.call(o,t);"function"==typeof o.init&&o.init();return o};Base.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var i=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=i.apply(this,arguments);this.base=e;return t};t.valueOf=function(e){return"object"==e?t:i};t.toString=Base.toString}this[e]=t}else if(e){var a=Base.prototype.extend;Base._prototyping||"function"==typeof this||(a=this.extend||a);for(var o={toSource:null},s=["constructor","toString","valueOf"],l=Base._prototyping?0:1;r=s[l++];)e[r]!=o[r]&&a.call(this,r,e[r]);for(var r in e)o[r]||a.call(this,r,e[r])}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var i in e)void 0===this.prototype[i]&&t.call(n,e[i],i,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}});Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var i=0;if(arguments.length>0){i=Number(arguments[1]);i!==i?i=0:0!==i&&1/0!==i&&i!==-1/0&&(i=(i>0||-1)*Math.floor(Math.abs(i)))}if(i>=n)return-1;for(var a=i>=0?i:Math.max(n-Math.abs(i),0);n>a;a++)if(a in t&&t[a]===e)return a;return-1});var I18n=I18n||{};I18n.defaultLocale="en";I18n.fallbacks=!0;I18n.defaultSeparator=".";I18n.locale=null;I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm;I18n.fallbackRules={};I18n.pluralizationRules={en:function(e){return 0==e?["zero","none","other"]:1==e?"one":"other"}};I18n.getFallbacks=function(e){if(e===I18n.defaultLocale)return[];if(!I18n.fallbackRules[e]){for(var t=[],n=e.split("-"),i=1;i<n.length;i++)t.push(n.slice(0,i).join("-"));t.push(I18n.defaultLocale);I18n.fallbackRules[e]=t}return I18n.fallbackRules[e]};I18n.isValidNode=function(e,t,n){return null!==e[t]&&e[t]!==n};I18n.lookup=function(e,t){var n,t=t||{},i=e,a=this.prepareOptions(I18n.translations),o=t.locale||I18n.currentLocale(),s=a[o]||{},t=this.prepareOptions(t);"object"==typeof e&&(e=e.join(this.defaultSeparator));t.scope&&(e=t.scope.toString()+this.defaultSeparator+e);e=e.split(this.defaultSeparator);for(;s&&e.length>0;){n=e.shift();s=s[n]}if(!s){if(I18n.fallbacks)for(var l=this.getFallbacks(o),r=0;r<l.length;l++){s=I18n.lookup(i,this.prepareOptions({locale:l[r]},t));if(s)break}!s&&this.isValidNode(t,"defaultValue")&&(s=t.defaultValue)}return s};I18n.prepareOptions=function(){for(var e,t={},n=arguments.length,i=0;n>i;i++){e=arguments[i];if(e)for(var a in e)this.isValidNode(t,a)||(t[a]=e[a])}return t};I18n.interpolate=function(e,t){t=this.prepareOptions(t);var n,i,a,o=e.match(this.PLACEHOLDER);if(!o)return e;for(var s=0;n=o[s];s++){a=n.replace(this.PLACEHOLDER,"$1");i=t[a];this.isValidNode(t,a)||(i="[missing "+n+" value]");regex=new RegExp(n.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}"));e=e.replace(regex,i)}return e};I18n.translate=function(e,t){t=this.prepareOptions(t);var n=this.lookup(e,t);try{return"object"==typeof n?"number"==typeof t.count?this.pluralize(t.count,e,t):n:this.interpolate(n,t)}catch(i){return this.missingTranslation(e)}};I18n.localize=function(e,t){switch(e){case"currency":return this.toCurrency(t);case"number":e=this.lookup("number.format");return this.toNumber(t,e);case"percentage":return this.toPercentage(t);default:return e.match(/^(date|time)/)?this.toTime(e,t):t.toString()}};I18n.parseDate=function(e){var t,n;if("object"==typeof e)return e;t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/);if(t){for(var i=1;6>=i;i++)t[i]=parseInt(t[i],10)||0;t[2]-=1;n=t[7]?new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else if("number"==typeof e){n=new Date;n.setTime(e)}else if(e.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)){n=new Date;n.setTime(Date.parse(e))}else{n=new Date;n.setTime(Date.parse(e))}return n};I18n.toTime=function(e,t){var n=this.parseDate(t),i=this.lookup(e);return n.toString().match(/invalid/i)?n.toString():i?this.strftime(n,i):n.toString()};I18n.strftime=function(e,t){var n=this.lookup("date");if(!n)return e.toString();n.meridian=n.meridian||["AM","PM"];var i=e.getDay(),a=e.getDate(),o=e.getFullYear(),s=e.getMonth()+1,l=e.getHours(),r=l,u=l>11?1:0,d=e.getSeconds(),c=e.getMinutes(),p=e.getTimezoneOffset(),h=Math.floor(Math.abs(p/60)),f=Math.abs(p)-60*h,m=(p>0?"-":"+")+(h.toString().length<2?"0"+h:h)+(f.toString().length<2?"0"+f:f);r>12?r-=12:0===r&&(r=12);var _=function(e){var t="0"+e.toString();return t.substr(t.length-2)},g=t;g=g.replace("%a",n.abbr_day_names[i]);g=g.replace("%A",n.day_names[i]);g=g.replace("%b",n.abbr_month_names[s]);g=g.replace("%B",n.month_names[s]);g=g.replace("%d",_(a));g=g.replace("%e",a);g=g.replace("%-d",a);g=g.replace("%H",_(l));g=g.replace("%-H",l);g=g.replace("%I",_(r));g=g.replace("%-I",r);g=g.replace("%m",_(s));g=g.replace("%-m",s);g=g.replace("%M",_(c));g=g.replace("%-M",c);g=g.replace("%p",n.meridian[u]);g=g.replace("%S",_(d));g=g.replace("%-S",d);g=g.replace("%w",i);g=g.replace("%y",_(o));g=g.replace("%-y",_(o).replace(/^0+/,""));g=g.replace("%Y",o);g=g.replace("%z",m);return g};I18n.toNumber=function(e,t){t=this.prepareOptions(t,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var n,i,a=0>e,o=Math.abs(e).toFixed(t.precision).toString(),s=o.split("."),l=[];e=s[0];n=s[1];for(;e.length>0;){l.unshift(e.substr(Math.max(0,e.length-3),3));e=e.substr(0,e.length-3)}i=l.join(t.delimiter);t.precision>0&&(i+=t.separator+s[1]);a&&(i="-"+i);if(t.strip_insignificant_zeros){var r={separator:new RegExp(t.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};i=i.replace(r.zeros,"").replace(r.separator,"")}return i};I18n.toCurrency=function(e,t){t=this.prepareOptions(t,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."});e=this.toNumber(e,t);e=t.format.replace("%u",t.unit).replace("%n",e);return e};I18n.toHumanSize=function(e,t){for(var n,i,a=1024,o=e,s=0;o>=a&&4>s;){o/=a;s+=1}if(0===s){n=this.t("number.human.storage_units.units.byte",{count:o});i=0}else{n=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][s]);i=o-Math.floor(o)===0?0:1}t=this.prepareOptions(t,{precision:i,format:"%n%u",delimiter:""});e=this.toNumber(o,t);e=t.format.replace("%u",n).replace("%n",e);return e};I18n.toPercentage=function(e,t){t=this.prepareOptions(t,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""});e=this.toNumber(e,t);return e+"%"};I18n.pluralizer=function(e){pluralizer=this.pluralizationRules[e];return void 0!==pluralizer?pluralizer:this.pluralizationRules["en"]};I18n.findAndTranslateValidNode=function(e,t){for(i=0;i<e.length;i++){key=e[i];if(this.isValidNode(t,key))return t[key]}return null};I18n.pluralize=function(e,t,n){var i;try{i=this.lookup(t,n)}catch(a){}if(!i)return this.missingTranslation(t);var o;n=this.prepareOptions(n);n.count=e.toString();pluralizer=this.pluralizer(this.currentLocale());key=pluralizer(Math.abs(e));keys="object"==typeof key&&key instanceof Array?key:[key];o=this.findAndTranslateValidNode(keys,i);null==o&&(o=this.missingTranslation(t,keys[0]));return this.interpolate(o,n)};I18n.missingTranslation=function(){for(var e='[missing "'+this.currentLocale(),t=arguments.length,n=0;t>n;n++)e+="."+arguments[n];e+='" translation]';return e};I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale};I18n.t=I18n.translate;I18n.l=I18n.localize;I18n.p=I18n.pluralize;!function(e){function t(e){return i(e).parents().andSelf().map(function(){var e=this.tagName,t="";this.className&&(t=this.className.split(/\s+/).map(function(e){return"."+e}).join(""));var n="";this.id&&(n="#"+this.id);return e+t+n}).toArray().join(" > ")}function n(e){var n=i(e).map(function(){return t(this)}).toArray(),a=[];i.each(n,function(){-1===i.inArray(this,a)&&a.push(this)});return a.join(", ")}var i=e.jQuery;i.fn.printElement=function(){var e=i("#jquery-print-element");if(0===e.length){e=i('<style id="jquery-print-element">');i("body").append(e)}e.text(["@media print {","html { height: 100%; }","body { background: white !important; padding: 0 !importnat; margin: 0 !important; min-height: 100%; position: relative; }",n(this.parents().andSelf().siblings())+" { display: none !important; }",n(this.parents())+" { display: block !important; background: white !important; padding: 0 !important; margin: 0 !important; position: static !important; float: none !important; }",n(this)+" { display: block !important; position: statis !important; overflow: hidden !important; margin: 2em !important; }","}"].join(" "));print()}}(window);!function(e){function t(t,i){var o=t==window,f=i&&void 0!==i.message?i.message:void 0;i=e.extend({},e.blockUI.defaults,i||{});i.overlayCSS=e.extend({},e.blockUI.defaults.overlayCSS,i.overlayCSS||{});var m=e.extend({},e.blockUI.defaults.css,i.css||{}),_=e.extend({},e.blockUI.defaults.themedCSS,i.themedCSS||{});f=void 0===f?i.message:f;o&&p&&n(window,{fadeOut:0});if(f&&"string"!=typeof f&&(f.parentNode||f.jquery)){var g=f.jquery?f[0]:f,v={};e(t).data("blockUI.history",v);v.el=g;v.parent=g.parentNode;v.display=g.style.display;v.position=g.style.position;v.parent&&v.parent.removeChild(g)}var y,b,w=i.baseZ,k=isInternetExplorer()||i.forceIframe?e('<iframe class="blockUI" style="z-index:'+w++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+i.iframeSrc+'"></iframe>'):e('<div class="blockUI" style="display:none"></div>'),x=e('<div class="blockUI blockOverlay" style="z-index:'+w++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');b=i.theme&&o?'<div class="blockUI blockMsg blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+w+';display:none;position:fixed"><div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(i.title||"&nbsp;")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>':i.theme?'<div class="blockUI blockMsg blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+w+';display:none;position:absolute"><div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(i.title||"&nbsp;")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>':o?'<div class="blockUI blockMsg blockPage" style="z-index:'+w+';display:none;position:fixed"></div>':'<div class="blockUI blockMsg blockElement" style="z-index:'+w+';display:none;position:absolute"></div>';y=e(b);if(f)if(i.theme){y.css(_);y.addClass("ui-widget-content")}else y.css(m);x.css("position",o?"fixed":"absolute");(isInternetExplorer()||i.forceIframe)&&k.css("opacity",0);var S=[k,x,y],C=o?e("body"):e(t);e.each(S,function(){this.appendTo(C)});i.theme&&i.draggable&&e.fn.draggable&&y.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var T=d&&(!e.boxModel||e("object,embed",o?null:t).length>0);if(c||T){o&&i.allowBodyStretch&&e.boxModel&&e("html,body").css("height","100%");if((c||!e.boxModel)&&!o)var A=r(t,"borderTopWidth"),P=r(t,"borderLeftWidth"),M=A?"(0 - "+A+")":0,D=P?"(0 - "+P+")":0;e.each([k,x,y],function(e,t){var n=t[0].style;n.position="absolute";if(2>e){o?n.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:"+i.quirksmodeOffsetHack+') + "px"'):n.setExpression("height",'this.parentNode.offsetHeight + "px"');o?n.setExpression("width",'jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):n.setExpression("width",'this.parentNode.offsetWidth + "px"');D&&n.setExpression("left",D);M&&n.setExpression("top",M)}else if(i.centerY){o&&n.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');n.marginTop=0}else if(!i.centerY&&o){var a=i.css&&i.css.top?parseInt(i.css.top):0,s="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+a+') + "px"';n.setExpression("top",s)}})}if(f){i.theme?y.find(".ui-widget-content").append(f):y.append(f);(f.jquery||f.nodeType)&&e(f).show()}(isInternetExplorer()||i.forceIframe)&&i.showOverlay&&k.show();if(i.fadeIn){var I=i.onBlock?i.onBlock:u,E=i.showOverlay&&!f?I:u,N=f?I:u;i.showOverlay&&x._fadeIn(i.fadeIn,E);f&&y._fadeIn(i.fadeIn,N)}else{i.showOverlay&&x.show();f&&y.show();i.onBlock&&i.onBlock()}a(1,t,i);if(o){p=y[0];h=e(":input:enabled:visible",p);i.focusInput&&setTimeout(s,20)}else l(y[0],i.centerX,i.centerY);if(i.timeout){var L=setTimeout(function(){o?e.unblockUI(i):e(t).unblock(i)},i.timeout);e(t).data("blockUI.timeout",L)}}function n(t,n){var o=t==window,s=e(t),l=s.data("blockUI.history"),r=s.data("blockUI.timeout");if(r){clearTimeout(r);s.removeData("blockUI.timeout")}n=e.extend({},e.blockUI.defaults,n||{});a(0,t,n);var u;u=o?e("body").children().filter(".blockUI").add("body > .blockUI"):e(".blockUI",t);o&&(p=h=null);if(n.fadeOut){u.fadeOut(n.fadeOut);setTimeout(function(){i(u,l,n,t)},n.fadeOut)}else i(u,l,n,t)}function i(t,n,i,a){t.each(function(){this.parentNode&&this.parentNode.removeChild(this)});if(n&&n.el){n.el.style.display=n.display;n.el.style.position=n.position;n.parent&&n.parent.appendChild(n.el);e(a).removeData("blockUI.history")}"function"==typeof i.onUnblock&&i.onUnblock(a,i)}function a(t,n,i){var a=n==window,s=e(n);if(t||(!a||p)&&(a||s.data("blockUI.isBlocked"))){a||s.data("blockUI.isBlocked",t);if(i.bindEvents&&(!t||i.showOverlay)){var l="mousedown mouseup keydown keypress";t?e(document).bind(l,i,o):e(document).unbind(l,o)}}}function o(t){if(t.keyCode&&9==t.keyCode&&p&&t.data.constrainTabKey){var n=h,i=!t.shiftKey&&t.target==n[n.length-1],a=t.shiftKey&&t.target==n[0];if(i||a){setTimeout(function(){s(a)},10);return!1}}return e(t.target).parents("div.blockMsg").length>0?!0:0==e(t.target).parents().children().filter("div.blockUI").length}function s(e){if(h){var t=h[e===!0?h.length-1:0];t&&t.focus()}}function l(e,t,n){var i=e.parentNode,a=e.style,o=(i.offsetWidth-e.offsetWidth)/2-r(i,"borderLeftWidth"),s=(i.offsetHeight-e.offsetHeight)/2-r(i,"borderTopWidth");t&&(a.left=o>0?o+"px":"0");n&&(a.top=s>0?s+"px":"0")}function r(t,n){return parseInt(e.css(t,n))||0}if(/1\.(0|1|2)\.(0|1|2)/.test(e.fn.jquery)||/^1.1\./.test(e.fn.jquery))alert("blockUI requires jQuery v1.2.3 or later!  You are using v"+e.fn.jquery);else{e.fn._fadeIn=e.fn.fadeIn;var u=function(){},d=(document.documentMode||0,void 0),c=void 0;e.blockUI=function(e){t(window,e)};e.unblockUI=function(e){n(window,e)};e.growlUI=function(t,n,i,a){var o=e('<div class="growlUI"></div>');t&&o.append("<h1>"+t+"</h1>");n&&o.append("<h2>"+n+"</h2>");void 0==i&&(i=3e3);e.blockUI({message:o,fadeIn:700,fadeOut:1e3,centerY:!1,timeout:i,showOverlay:!1,onUnblock:a,css:e.blockUI.defaults.growlCSS})};e.fn.block=function(n){return this.unblock({fadeOut:0}).each(function(){"static"==e.css(this,"position")&&(this.style.position="relative");this.style.zoom=1;t(this,n)})};e.fn.unblock=function(e){return this.each(function(){n(this,e)})};e.blockUI.version=2.33;e.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,applyPlatformOpacityRules:!0,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4};var p=null,h=[]}}(jQuery);jQuery.fn.inspect=function(e){jQuery.inspect($(this),e);return this};jQuery.inspect=function(e,t){t=t?t:"alert";var n="",i=null,a=null;switch(t){case"console":i=jQuery.inspect._buildText;a=jQuery.inspect._console;break;case"window":i=jQuery.inspect._buildHTML;a=jQuery.inspect._window;break;default:i=jQuery.inspect._buildText;a=jQuery.inspect._alert}switch(typeof e){case"string":n="String: "+e;break;case"number":n="Number: "+e;break;case"boolean":n="Boolean: "+e;break;case"undefined":alert("Object is undefined");return!0;default:n=jQuery.inspect._parseObject(e,i)}a(n)};jQuery.inspect._parseObject=function(e,t){var n="";for(field in e)try{n+=t(field,e[field])}catch(i){}return n};jQuery.inspect._buildText=function(e,t){return e+":"+t+"\n"};jQuery.inspect._buildHTML=function(e,t){return"<tr><td>"+e+"</td><td>"+t+"</td></tr>\n"};jQuery.inspect._console=function(e){console.log(e)};jQuery.inspect._alert=function(e){alert(e)};jQuery.inspect._window=function(e){e="<html><head>"+jQuery.inspect._windowSettings.styles+"</head><body><table>"+e+"</table></body></html>";dump_window=window.open("","",jQuery.inspect._windowSettings.config);dump_window.document.write(e);dump_window.document.close();dump_window.focus()};jQuery.inspect._windowSettings=jQuery.extend({width:800,height:600});jQuery.inspect._windowSettings.styles="<style> 	* { 	  margin: 0; 	} 	html, body { 	  height: 100%; 	  text-align: center; 	  margin-bottom: 1px; 	  font-family: verdana,helvetica,sans-serif; 	} 	table { 		width: "+(jQuery.inspect._windowSettings.width-20)+"px; 		border: 1px solid black;   }   td {     vertical-align: top;   } </style>";jQuery.inspect._windowSettings.config="width="+jQuery.inspect._windowSettings.width+",height="+jQuery.inspect._windowSettings.height+",scrollbars=yes,location=no,menubar=no,toolbar=no";jQuery.fn.inspect=function(e){jQuery.inspect($(this),e);return this};jQuery.inspect=function(e,t){t=t?t:"alert";var n="",i=null,a=null;switch(t){case"console":i=jQuery.inspect._buildText;a=jQuery.inspect._console;break;case"window":i=jQuery.inspect._buildHTML;a=jQuery.inspect._window;break;default:i=jQuery.inspect._buildText;a=jQuery.inspect._alert}switch(typeof e){case"string":n="String: "+e;break;case"number":n="Number: "+e;break;case"boolean":n="Boolean: "+e;break;case"undefined":alert("Object is undefined");return!0;default:n=jQuery.inspect._parseObject(e,i)}a(n)};jQuery.inspect._parseObject=function(e,t){var n="";
for(field in e)try{n+=t(field,e[field])}catch(i){}return n};jQuery.inspect._buildText=function(e,t){return e+":"+t+"\n"};jQuery.inspect._buildHTML=function(e,t){return"<tr><td>"+e+"</td><td>"+t+"</td></tr>\n"};jQuery.inspect._console=function(e){console.log(e)};jQuery.inspect._alert=function(e){alert(e)};jQuery.inspect._window=function(e){e="<html><head>"+jQuery.inspect._windowSettings.styles+"</head><body><table>"+e+"</table></body></html>";dump_window=window.open("","",jQuery.inspect._windowSettings.config);dump_window.document.write(e);dump_window.document.close();dump_window.focus()};jQuery.inspect._windowSettings=jQuery.extend({width:800,height:600});jQuery.inspect._windowSettings.styles="<style> * { margin: 0; } html, body { height: 100%; text-align: center; margin-bottom: 1px; font-family: verdana,helvetica,sans-serif; } table { width: "+(jQuery.inspect._windowSettings.width-20)+"px; border: 1px solid black; } td { vertical-align: top; } </style>";jQuery.inspect._windowSettings.config="width="+jQuery.inspect._windowSettings.width+",height="+jQuery.inspect._windowSettings.height+",scrollbars=yes,location=no,menubar=no,toolbar=no";jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,i,a){return jQuery.easing[jQuery.easing.def](e,t,n,i,a)},easeInQuad:function(e,t,n,i,a){return i*(t/=a)*t+n},easeOutQuad:function(e,t,n,i,a){return-i*(t/=a)*(t-2)+n},easeInOutQuad:function(e,t,n,i,a){return(t/=a/2)<1?i/2*t*t+n:-i/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,i,a){return i*(t/=a)*t*t+n},easeOutCubic:function(e,t,n,i,a){return i*((t=t/a-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,i,a){return(t/=a/2)<1?i/2*t*t*t+n:i/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,i,a){return i*(t/=a)*t*t*t+n},easeOutQuart:function(e,t,n,i,a){return-i*((t=t/a-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,i,a){return(t/=a/2)<1?i/2*t*t*t*t+n:-i/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,i,a){return i*(t/=a)*t*t*t*t+n},easeOutQuint:function(e,t,n,i,a){return i*((t=t/a-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,i,a){return(t/=a/2)<1?i/2*t*t*t*t*t+n:i/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,i,a){return-i*Math.cos(t/a*(Math.PI/2))+i+n},easeOutSine:function(e,t,n,i,a){return i*Math.sin(t/a*(Math.PI/2))+n},easeInOutSine:function(e,t,n,i,a){return-i/2*(Math.cos(Math.PI*t/a)-1)+n},easeInExpo:function(e,t,n,i,a){return 0==t?n:i*Math.pow(2,10*(t/a-1))+n},easeOutExpo:function(e,t,n,i,a){return t==a?n+i:i*(-Math.pow(2,-10*t/a)+1)+n},easeInOutExpo:function(e,t,n,i,a){return 0==t?n:t==a?n+i:(t/=a/2)<1?i/2*Math.pow(2,10*(t-1))+n:i/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,i,a){return-i*(Math.sqrt(1-(t/=a)*t)-1)+n},easeOutCirc:function(e,t,n,i,a){return i*Math.sqrt(1-(t=t/a-1)*t)+n},easeInOutCirc:function(e,t,n,i,a){return(t/=a/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+n:i/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,i,a){var o=1.70158,s=0,l=i;if(0==t)return n;if(1==(t/=a))return n+i;s||(s=.3*a);if(l<Math.abs(i)){l=i;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(i/l);return-(l*Math.pow(2,10*(t-=1))*Math.sin(2*(t*a-o)*Math.PI/s))+n},easeOutElastic:function(e,t,n,i,a){var o=1.70158,s=0,l=i;if(0==t)return n;if(1==(t/=a))return n+i;s||(s=.3*a);if(l<Math.abs(i)){l=i;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(i/l);return l*Math.pow(2,-10*t)*Math.sin(2*(t*a-o)*Math.PI/s)+i+n},easeInOutElastic:function(e,t,n,i,a){var o=1.70158,s=0,l=i;if(0==t)return n;if(2==(t/=a/2))return n+i;s||(s=.3*a*1.5);if(l<Math.abs(i)){l=i;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(i/l);return 1>t?-.5*l*Math.pow(2,10*(t-=1))*Math.sin(2*(t*a-o)*Math.PI/s)+n:l*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*a-o)*Math.PI/s)*.5+i+n},easeInBack:function(e,t,n,i,a,o){void 0==o&&(o=1.70158);return i*(t/=a)*t*((o+1)*t-o)+n},easeOutBack:function(e,t,n,i,a,o){void 0==o&&(o=1.70158);return i*((t=t/a-1)*t*((o+1)*t+o)+1)+n},easeInOutBack:function(e,t,n,i,a,o){void 0==o&&(o=1.70158);return(t/=a/2)<1?i/2*t*t*(((o*=1.525)+1)*t-o)+n:i/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+n},easeInBounce:function(e,t,n,i,a){return i-jQuery.easing.easeOutBounce(e,a-t,0,i,a)+n},easeOutBounce:function(e,t,n,i,a){return(t/=a)<1/2.75?7.5625*i*t*t+n:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+n:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+n:i*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,i,a){return a/2>t?.5*jQuery.easing.easeInBounce(e,2*t,0,i,a)+n:.5*jQuery.easing.easeOutBounce(e,2*t-a,0,i,a)+.5*i+n}});!function(){jQuery.fn.pngFix=function(e){e=jQuery.extend({blankgif:"blank.gif"},e);var t="Microsoft Internet Explorer"==navigator.appName&&4==parseInt(navigator.appVersion)&&-1!=navigator.appVersion.indexOf("MSIE 5.5"),n="Microsoft Internet Explorer"==navigator.appName&&4==parseInt(navigator.appVersion)&&-1!=navigator.appVersion.indexOf("MSIE 6.0");if(jQuery.browser.msie&&(t||n)){jQuery(this).find("img[src$='.png']").each(function(){jQuery(this).attr("width",jQuery(this).width());jQuery(this).attr("height",jQuery(this).height());var e="",t="",n=jQuery(this).attr("id")?'id="'+jQuery(this).attr("id")+'" ':"",i=jQuery(this).attr("class")?'class="'+jQuery(this).attr("class")+'" ':"",a=jQuery(this).attr("title")?'title="'+jQuery(this).attr("title")+'" ':"",o=jQuery(this).attr("alt")?'alt="'+jQuery(this).attr("alt")+'" ':"",s=jQuery(this).attr("align")?"float:"+jQuery(this).attr("align")+";":"",l=jQuery(this).parent().attr("href")?"cursor:hand;":"";if(this.style.border){e+="border:"+this.style.border+";";this.style.border=""}if(this.style.padding){e+="padding:"+this.style.padding+";";this.style.padding=""}if(this.style.margin){e+="margin:"+this.style.margin+";";this.style.margin=""}var r=this.style.cssText;t+="<span "+n+i+a+o;t+='style="position:relative;white-space:pre-line;display:inline-block;background:transparent;'+s+l;t+="width:"+jQuery(this).width()+"px;height:"+jQuery(this).height()+"px;";t+="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+jQuery(this).attr("src")+"', sizingMethod='scale');";t+=r+'"></span>';""!=e&&(t='<span style="position:relative;display:inline-block;'+e+l+"width:"+jQuery(this).width()+"px;height:"+jQuery(this).height()+'px;">'+t+"</span>");jQuery(this).hide();jQuery(this).after(t)});jQuery(this).find("*").each(function(){var e=jQuery(this).css("background-image");if(-1!=e.indexOf(".png")){var t=e.split('url("')[1].split('")')[0];jQuery(this).css("background-image","none");jQuery(this).get(0).runtimeStyle.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"',sizingMethod='scale')"}});jQuery(this).find("input[src$='.png']").each(function(){var t=jQuery(this).attr("src");jQuery(this).get(0).runtimeStyle.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale');";jQuery(this).attr("src",e.blankgif)})}return jQuery}}(jQuery);var FlashDetect=new function(){var e=this;e.installed=!1;e.raw="";e.major=-1;e.minor=-1;e.revision=-1;e.revisionStr="";var t=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(e){return n(e)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(e){var t="6,0,21";try{e.AllowScriptAccess="always";t=n(e)}catch(i){}return t}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(e){return n(e)}}],n=function(e){var t=-1;try{t=e.GetVariable("$version")}catch(n){}return t},a=function(e){var t=-1;try{t=new ActiveXObject(e)}catch(n){t={activeXError:!0}}return t},o=function(e){var t=e.split(",");return{raw:e,major:parseInt(t[0].split(" ")[1],10),minor:parseInt(t[1],10),revision:parseInt(t[2],10),revisionStr:t[2]}},s=function(e){var t=e.split(/ +/),n=t[2].split(/\./),i=t[3];return{raw:e,major:parseInt(n[0],10),minor:parseInt(n[1],10),revisionStr:i,revision:l(i)}},l=function(t){return parseInt(t.replace(/[a-zA-Z]/g,""),10)||e.revision};e.majorAtLeast=function(t){return e.major>=t};e.minorAtLeast=function(t){return e.minor>=t};e.revisionAtLeast=function(t){return e.revision>=t};e.versionAtLeast=function(){var t=[e.major,e.minor,e.revision],n=Math.min(t.length,arguments.length);for(i=0;n>i;i++){if(t[i]>=arguments[i]){if(n>i+1&&t[i]==arguments[i])continue;return!0}return!1}};e.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var n="application/x-shockwave-flash",i=navigator.mimeTypes;if(i&&i[n]&&i[n].enabledPlugin&&i[n].enabledPlugin.description){var l=i[n].enabledPlugin.description,r=s(l);e.raw=r.raw;e.major=r.major;e.minor=r.minor;e.revisionStr=r.revisionStr;e.revision=r.revision;e.installed=!0}}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var l=-1,u=0;u<t.length&&-1==l;u++){var d=a(t[u].name);if(!d.activeXError){e.installed=!0;l=t[u].version(d);if(-1!=l){var r=o(l);e.raw=r.raw;e.major=r.major;e.minor=r.minor;e.revision=r.revision;e.revisionStr=r.revisionStr}}}}()};FlashDetect.JS_RELEASE="1.0.4";$(document).ready(function(){FlashDetect.versionAtLeast(9)||$(".maps-frame").html("<a href='http://www.adobe.com/go/getflashplayer'><img src='/shared/images/get_flash_player.gif'></a>")});var swfobject=function(){function e(){if(!W){try{var e=R.getElementsByTagName("body")[0].appendChild(_("span"));e.parentNode.removeChild(e)}catch(t){return}W=!0;for(var n=F.length,i=0;n>i;i++)F[i]()}}function t(e){W?e():F[F.length]=e}function n(e){if(typeof j.addEventListener!=P)j.addEventListener("load",e,!1);else if(typeof R.addEventListener!=P)R.addEventListener("load",e,!1);else if(typeof j.attachEvent!=P)g(j,"onload",e);else if("function"==typeof j.onload){var t=j.onload;j.onload=function(){t();e()}}else j.onload=e}function i(){z?a():o()}function a(){var e=R.getElementsByTagName("body")[0],t=_(M);t.setAttribute("type",E);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=P){var a=n.GetVariable("$version");if(a){a=a.split(" ")[1].split(",");G.pv=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)]}}else if(10>i){i++;setTimeout(arguments.callee,10);return}e.removeChild(t);n=null;o()}()}else o()}function o(){var e=B.length;if(e>0)for(var t=0;e>t;t++){var n=B[t].id,i=B[t].callbackFn,a={success:!1,id:n};if(G.pv[0]>0){var o=m(n);if(o)if(!v(B[t].swfVersion)||G.wk&&G.wk<312)if(B[t].expressInstall&&l()){var d={};d.data=B[t].expressInstall;d.width=o.getAttribute("width")||"0";d.height=o.getAttribute("height")||"0";o.getAttribute("class")&&(d.styleclass=o.getAttribute("class"));o.getAttribute("align")&&(d.align=o.getAttribute("align"));for(var c={},p=o.getElementsByTagName("param"),h=p.length,f=0;h>f;f++)"movie"!=p[f].getAttribute("name").toLowerCase()&&(c[p[f].getAttribute("name")]=p[f].getAttribute("value"));r(d,c,n,i)}else{u(o);i&&i(a)}else{b(n,!0);if(i){a.success=!0;a.ref=s(n);i(a)}}}else{b(n,!0);if(i){var _=s(n);if(_&&typeof _.SetVariable!=P){a.success=!0;a.ref=_}i(a)}}}}function s(e){var t=null,n=m(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=P)t=n;else{var i=n.getElementsByTagName(M)[0];i&&(t=i)}return t}function l(){return!V&&v("6.0.65")&&(G.win||G.mac)&&!(G.wk&&G.wk<312)}function r(e,t,n,i){V=!0;S=i||null;C={success:!1,id:n};var a=m(n);if(a){if("OBJECT"==a.nodeName){k=d(a);x=null}else{k=a;x=n}e.id=N;(typeof e.width==P||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310");(typeof e.height==P||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137");R.title=R.title.slice(0,47)+" - Flash Player Installation";var o=G.ie&&G.win?"ActiveX":"PlugIn",s="MMredirectURL="+j.location.toString().replace(/&/g,"%26")+"&MMplayerType="+o+"&MMdoctitle="+R.title;typeof t.flashvars!=P?t.flashvars+="&"+s:t.flashvars=s;if(G.ie&&G.win&&4!=a.readyState){var l=_("div");n+="SWFObjectNew";l.setAttribute("id",n);a.parentNode.insertBefore(l,a);a.style.display="none";!function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}c(e,t,n)}}function u(e){if(G.ie&&G.win&&4!=e.readyState){var t=_("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(d(e),t);e.style.display="none";!function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=_("div");if(G.win&&G.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(M)[0];if(n){var i=n.childNodes;if(i)for(var a=i.length,o=0;a>o;o++)1==i[o].nodeType&&"PARAM"==i[o].nodeName||8==i[o].nodeType||t.appendChild(i[o].cloneNode(!0))}}return t}function c(e,t,n){var i,a=m(n);if(G.wk&&G.wk<312)return i;if(a){typeof e.id==P&&(e.id=n);if(G.ie&&G.win){var o="";for(var s in e)e[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?t.movie=e[s]:"styleclass"==s.toLowerCase()?o+=' class="'+e[s]+'"':"classid"!=s.toLowerCase()&&(o+=" "+s+'="'+e[s]+'"'));var l="";for(var r in t)t[r]!=Object.prototype[r]&&(l+='<param name="'+r+'" value="'+t[r]+'" />');a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+o+">"+l+"</object>";q[q.length]=e.id;i=m(e.id)}else{var u=_(M);u.setAttribute("type",E);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?u.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&u.setAttribute(d,e[d]));for(var c in t)t[c]!=Object.prototype[c]&&"movie"!=c.toLowerCase()&&p(u,c,t[c]);a.parentNode.replaceChild(u,a);i=u}}return i}function p(e,t,n){var i=_("param");i.setAttribute("name",t);i.setAttribute("value",n);e.appendChild(i)}function h(e){var t=m(e);if(t&&"OBJECT"==t.nodeName)if(G.ie&&G.win){t.style.display="none";!function(){4==t.readyState?f(e):setTimeout(arguments.callee,10)}()}else t.parentNode.removeChild(t)}function f(e){var t=m(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=R.getElementById(e)}catch(n){}return t}function _(e){return R.createElement(e)}function g(e,t,n){e.attachEvent(t,n);H[H.length]=[e,t,n]}function v(e){var t=G.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function y(e,t,n,i){if(!G.ie||!G.mac){var a=R.getElementsByTagName("head")[0];if(a){var o=n&&"string"==typeof n?n:"screen";if(i){T=null;A=null}if(!T||A!=o){var s=_("style");s.setAttribute("type","text/css");s.setAttribute("media",o);T=a.appendChild(s);G.ie&&G.win&&typeof R.styleSheets!=P&&R.styleSheets.length>0&&(T=R.styleSheets[R.styleSheets.length-1]);A=o}G.ie&&G.win?T&&typeof T.addRule==M&&T.addRule(e,t):T&&typeof R.createTextNode!=P&&T.appendChild(R.createTextNode(e+" {"+t+"}"))}}}function b(e,t){if(U){var n=t?"visible":"hidden";W&&m(e)?m(e).style.visibility=n:y("#"+e,"visibility:"+n)}}function w(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=P?encodeURIComponent(e):e}{var k,x,S,C,T,A,P="undefined",M="object",D="Shockwave Flash",I="ShockwaveFlash.ShockwaveFlash",E="application/x-shockwave-flash",N="SWFObjectExprInst",L="onreadystatechange",j=window,R=document,O=navigator,z=!1,F=[i],B=[],q=[],H=[],W=!1,V=!1,U=!0,G=function(){var e=typeof R.getElementById!=P&&typeof R.getElementsByTagName!=P&&typeof R.createElement!=P,t=O.userAgent.toLowerCase(),n=O.platform.toLowerCase(),i=n?/win/.test(n):/win/.test(t),a=n?/mac/.test(n):/mac/.test(t),o=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,s=!1,l=[0,0,0],r=null;if(typeof O.plugins!=P&&typeof O.plugins[D]==M){r=O.plugins[D].description;if(r&&(typeof O.mimeTypes==P||!O.mimeTypes[E]||O.mimeTypes[E].enabledPlugin)){z=!0;s=!1;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");l[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);l[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);l[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof j.ActiveXObject!=P)try{var u=new ActiveXObject(I);if(u){r=u.GetVariable("$version");if(r){s=!0;r=r.split(" ")[1].split(",");l=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(d){}return{w3:e,pv:l,wk:o,ie:s,win:i,mac:a}}();!function(){if(G.w3){(typeof R.readyState!=P&&"complete"==R.readyState||typeof R.readyState==P&&(R.getElementsByTagName("body")[0]||R.body))&&e();if(!W){typeof R.addEventListener!=P&&R.addEventListener("DOMContentLoaded",e,!1);if(G.ie&&G.win){R.attachEvent(L,function(){if("complete"==R.readyState){R.detachEvent(L,arguments.callee);e()}});j==top&&!function(){if(!W){try{R.documentElement.doScroll("left")}catch(t){setTimeout(arguments.callee,0);return}e()}}()}G.wk&&!function(){W||(/loaded|complete/.test(R.readyState)?e():setTimeout(arguments.callee,0))}();n(e)}}}(),function(){G.ie&&G.win&&window.attachEvent("onunload",function(){for(var e=H.length,t=0;e>t;t++)H[t][0].detachEvent(H[t][1],H[t][2]);for(var n=q.length,i=0;n>i;i++)h(q[i]);for(var a in G)G[a]=null;G=null;for(var o in swfobject)swfobject[o]=null;swfobject=null})}()}return{registerObject:function(e,t,n,i){if(G.w3&&e&&t){var a={};a.id=e;a.swfVersion=t;a.expressInstall=n;a.callbackFn=i;B[B.length]=a;b(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){return G.w3?s(e):void 0},embedSWF:function(e,n,i,a,o,s,u,d,p,h){var f={success:!1,id:n};if(G.w3&&!(G.wk&&G.wk<312)&&e&&n&&i&&a&&o){b(n,!1);t(function(){i+="";a+="";var t={};if(p&&typeof p===M)for(var m in p)t[m]=p[m];t.data=e;t.width=i;t.height=a;var _={};if(d&&typeof d===M)for(var g in d)_[g]=d[g];if(u&&typeof u===M)for(var y in u)typeof _.flashvars!=P?_.flashvars+="&"+y+"="+u[y]:_.flashvars=y+"="+u[y];if(v(o)){var w=c(t,_,n);t.id==n&&b(n,!0);f.success=!0;f.ref=w}else{if(s&&l()){t.data=s;r(t,_,n,h);return}b(n,!0)}h&&h(f)})}else h&&h(f)},switchOffAutoHideShow:function(){U=!1},ua:G,getFlashPlayerVersion:function(){return{major:G.pv[0],minor:G.pv[1],release:G.pv[2]}},hasFlashPlayerVersion:v,createSWF:function(e,t,n){return G.w3?c(e,t,n):void 0},showExpressInstall:function(e,t,n,i){G.w3&&l()&&r(e,t,n,i)},removeSWF:function(e){G.w3&&h(e)},createCSS:function(e,t,n,i){G.w3&&y(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=R.location.search||R.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(null==e)return w(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return w(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(V){var e=m(N);if(e&&k){e.parentNode.replaceChild(k,e);if(x){b(x,!0);G.ie&&G.win&&(k.style.display="block")}S&&S(C)}V=!1}}}}();MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m";MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png";MarkerClusterer.prototype.extend=function(e,t){return function(e){for(property in e.prototype)this.prototype[property]=e.prototype[property];return this}.apply(e,[t])};MarkerClusterer.prototype.onAdd=function(){this.setReady_(!0)};MarkerClusterer.prototype.idle=function(){};MarkerClusterer.prototype.draw=function(){};MarkerClusterer.prototype.setupStyles_=function(){for(var e,t=0;e=this.sizes[t];t++)this.styles_.push({url:this.imagePath_+(t+1)+"."+this.imageExtension_,height:e,width:e})};MarkerClusterer.prototype.setStyles=function(e){this.styles_=e};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_};MarkerClusterer.prototype.setMaxZoom=function(e){this.maxZoom_=e};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_||this.map_.mapTypes[this.map_.getMapTypeId()].maxZoom};MarkerClusterer.prototype.calculator_=function(e,t){for(var n=0,i=e.length,a=i;0!==a;){a=parseInt(a/10,10);n++}n=Math.min(n,t);return{text:i,index:n}};MarkerClusterer.prototype.setCalculator=function(e){this.calculator_=e};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.addMarkers=function(e,t){for(var n,i=0;n=e[i];i++)this.pushMarkerTo_(n);t||this.redraw()};MarkerClusterer.prototype.pushMarkerTo_=function(e){e.setVisible(!1);e.setMap(null);e.isAdded=!1;if(e["draggable"]){var t=this;google.maps.event.addListener(e,"dragend",function(){e.isAdded=!1;t.resetViewport();t.redraw()})}this.markers_.push(e)};MarkerClusterer.prototype.addMarker=function(e,t){this.pushMarkerTo_(e);t||this.redraw()};MarkerClusterer.prototype.removeMarker=function(e){var t=-1;if(this.markers_.indexOf)t=this.markers_.indexOf(e);else for(var n,i=0;n=this.markers_[i];i++)n!=e||(t=i);if(-1==t)return!1;this.markers_.splice(t,1);e.setVisible(!1);e.setMap(null);this.resetViewport();this.redraw();return!0};MarkerClusterer.prototype.fitMapToMarkers=function(){for(var e,t=this.getMarkers(),n=new google.maps.LatLngBounds,i=0;e=t[i];i++)n.extend(e.getPosition());this.map_.fitBounds(n)};MarkerClusterer.prototype.setReady_=function(e){if(!this.ready_){this.ready_=e;this.createClusters_()}};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};MarkerClusterer.prototype.getMap=function(){return this.map_};MarkerClusterer.prototype.setMap=function(e){this.map_=e};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(e){this.gridSize_=e};MarkerClusterer.prototype.getExtendedBounds=function(e){var t=this.getProjection(),n=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),i=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),a=t.fromLatLngToDivPixel(n);a.x+=this.gridSize_;a.y-=this.gridSize_;var o=t.fromLatLngToDivPixel(i);o.x-=this.gridSize_;o.y+=this.gridSize_;var s=t.fromDivPixelToLatLng(a),l=t.fromDivPixelToLatLng(o);e.extend(s);e.extend(l);return e};MarkerClusterer.prototype.isMarkerInBounds_=function(e,t){return t.contains(e.getPosition())};MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport();this.markers_=[]};MarkerClusterer.prototype.resetViewport=function(){for(var e,t=0;e=this.clusters_[t];t++)e.remove();for(var n,t=0;n=this.markers_[t];t++){n.isAdded=!1;n.setMap(null);n.setVisible(!1)}this.clusters_=[]};MarkerClusterer.prototype.redraw=function(){this.createClusters_()};MarkerClusterer.prototype.createClusters_=function(){if(this.ready_)for(var e,t=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),n=this.getExtendedBounds(t),i=0;e=this.markers_[i];i++){var a=!1;if(!e.isAdded&&this.isMarkerInBounds_(e,n)){for(var o,s=0;o=this.clusters_[s];s++)if(!a&&o.getCenter()&&o.isMarkerInClusterBounds(e)){a=!0;o.addMarker(e);break}if(!a){var o=new Cluster(this);o.addMarker(e);this.clusters_.push(o)}}}};Cluster.prototype.isMarkerAlreadyAdded=function(e){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(e);for(var t,n=0;t=this.markers_[n];n++)if(t==e)return!0;return!1};Cluster.prototype.addMarker=function(e){if(this.isMarkerAlreadyAdded(e))return!1;if(!this.center_){this.center_=e.getPosition();this.calculateBounds_()}if(0==this.markers_.length){e.setMap(this.map_);e.setVisible(!0)}else if(1==this.markers_.length){this.markers_[0].setMap(null);this.markers_[0].setVisible(!1)}e.isAdded=!0;this.markers_.push(e);this.updateIcon();return!0};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){this.calculateBounds_();return this.bounds_};Cluster.prototype.remove=function(){this.clusterIcon_.remove();delete this.markers_};Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.calculateBounds_=function(){var e=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(e)};Cluster.prototype.isMarkerInClusterBounds=function(e){return this.bounds_.contains(e.getPosition())};Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.updateIcon=function(){var e=this.map_.getZoom(),t=this.markerClusterer_.getMaxZoom();if(e>t)for(var n,i=0;n=this.markers_[i];i++){n.setMap(this.map_);n.setVisible(!0)}else if(this.markers_.length<2)this.clusterIcon_.hide();else{var a=this.markerClusterer_.getStyles().length,o=this.markerClusterer_.getCalculator()(this.markers_,a);this.clusterIcon_.setCenter(this.center_);this.clusterIcon_.setSums(o);this.clusterIcon_.show()}};ClusterIcon.prototype.triggerClusterClick=function(){var e=this.cluster_.getMarkerClusterer();if(e.isZoomOnClick()){this.map_.panTo(this.cluster_.getCenter());this.map_.setZoom(this.map_.getZoom()+1)}};ClusterIcon.prototype.onAdd=function(){this.div_=document.createElement("DIV");this.shadow_=document.createElement("DIV");if(this.visible_){var e=this.getPosFromLatLng_(this.center_),t=this.createCss(e);this.div_.setAttribute("class",this.styles_[0].markerClass);this.div_.setAttribute("className",this.styles_[0].markerClass);this.div_.innerHTML="x"+this.sums_.text;this.div_.style.cssText=t;this.shadow_.setAttribute("class",this.styles_[0].shadowClass);this.shadow_.setAttribute("className",this.styles_[0].shadowClass);this.shadow_.style.cssText=t}var n=this.getPanes();n.overlayImage.appendChild(this.shadow_);n.overlayImage.appendChild(this.div_);var i=this;google.maps.event.addDomListener(this.div_,"click",function(){i.triggerClusterClick()})};ClusterIcon.prototype.getPosFromLatLng_=function(e){var t=this.getProjection().fromLatLngToDivPixel(e);t.x-=parseInt(this.width_/2,10);t.y-=parseInt(this.height_/2,10);return t};ClusterIcon.prototype.draw=function(){if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.top=e.y+"px";this.div_.style.left=e.x+"px"}};ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.shadow_&&(this.shadow_.style.display="none");this.visible_=!1};ClusterIcon.prototype.show=function(){if(this.div_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(e);this.div_.style.display="";this.div_.setAttribute("class",this.styles_[0].markerClass);this.div_.setAttribute("className",this.styles_[0].markerClass)}if(this.shadow_){var e=this.getPosFromLatLng_(this.center_);this.shadow_.style.cssText=this.createCss(e);this.shadow_.style.display="";this.shadow_.setAttribute("class",this.styles_[0].shadowClass);this.shadow_.setAttribute("className",this.styles_[0].shadowClass)}this.visible_=!0};ClusterIcon.prototype.remove=function(){this.setMap(null)};ClusterIcon.prototype.onRemove=function(){if(this.div_&&this.div_.parentNode){this.hide();this.div_.parentNode.removeChild(this.div_);this.div_=null}};ClusterIcon.prototype.setSums=function(e){this.sums_=e;this.text_=e.text;this.index_=e.index;this.div_&&(this.div_.innerHTML=e.text);this.useStyle()};ClusterIcon.prototype.useStyle=function(){var e=Math.max(0,this.sums_.index-1);e=Math.min(this.styles_.length-1,e);var t=this.styles_[e];this.url_=t.url;this.height_=t.height;this.width_=t.width;this.anchor=t.opt_anchor;this.textSize_=t.opt_textSize};ClusterIcon.prototype.setCenter=function(e){this.center_=e};ClusterIcon.prototype.createCss=function(e){var t=[];t.push(" position:absolute; cursor:pointer; top:"+e.y+"px; left:"+e.x+"px;");return t.join("")};window["MarkerClusterer"]=MarkerClusterer;MarkerClusterer.prototype["addMarker"]=MarkerClusterer.prototype.addMarker;MarkerClusterer.prototype["addMarkers"]=MarkerClusterer.prototype.addMarkers;MarkerClusterer.prototype["clearMarkers"]=MarkerClusterer.prototype.clearMarkers;MarkerClusterer.prototype["getCalculator"]=MarkerClusterer.prototype.getCalculator;MarkerClusterer.prototype["getGridSize"]=MarkerClusterer.prototype.getGridSize;MarkerClusterer.prototype["getMap"]=MarkerClusterer.prototype.getMap;MarkerClusterer.prototype["getMarkers"]=MarkerClusterer.prototype.getMarkers;MarkerClusterer.prototype["getMaxZoom"]=MarkerClusterer.prototype.getMaxZoom;MarkerClusterer.prototype["getStyles"]=MarkerClusterer.prototype.getStyles;MarkerClusterer.prototype["getTotalClusters"]=MarkerClusterer.prototype.getTotalClusters;MarkerClusterer.prototype["getTotalMarkers"]=MarkerClusterer.prototype.getTotalMarkers;MarkerClusterer.prototype["redraw"]=MarkerClusterer.prototype.redraw;MarkerClusterer.prototype["removeMarker"]=MarkerClusterer.prototype.removeMarker;MarkerClusterer.prototype["resetViewport"]=MarkerClusterer.prototype.resetViewport;MarkerClusterer.prototype["setCalculator"]=MarkerClusterer.prototype.setCalculator;MarkerClusterer.prototype["setGridSize"]=MarkerClusterer.prototype.setGridSize;MarkerClusterer.prototype["onAdd"]=MarkerClusterer.prototype.onAdd;MarkerClusterer.prototype["draw"]=MarkerClusterer.prototype.draw;MarkerClusterer.prototype["idle"]=MarkerClusterer.prototype.idle;ClusterIcon.prototype["onAdd"]=ClusterIcon.prototype.onAdd;ClusterIcon.prototype["draw"]=ClusterIcon.prototype.draw;ClusterIcon.prototype["onRemove"]=ClusterIcon.prototype.onRemove;!function(e){var t=[];e.loadImages=function(n,i){n instanceof Array||(n=[n]);for(var a=n.length,o=0,s=a;s--;){var l=document.createElement("img");l.onload=function(){o++;o>=a&&e.isFunction(i)&&i()};l.src=n[s];t.push(l)}}}(jQuery);parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var Coordtransform=Coordtransform||{x_PI:52.35987755982988,gcj02tobd09:function(e,t){var n=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*this.x_PI),i=Math.atan2(t,e)+3e-6*Math.cos(e*this.x_PI),a=n*Math.cos(i)+.0065,o=n*Math.sin(i)+.006;return[a,o]}};lf={};lf.maps={};lf.maps.bing={};lf.maps.google={};lf.maps.leaflet={};lf.maps.mappy={};lf.maps.viamichelin={};lf.app={};gui={};jQuery(document).ready(function(){var e=0,t=0,n="";if(getChromeVersion()>=50&&"http:"===window.location.protocol.toLowerCase()){jQuery.getJSON("/geocode.json",function(n){e=n.latitude;t=n.longitude});n="#geo_btn, .home__search__geoloc, .lf_geoloc";n+=", .searchform-geoloc, [data-lf-searchform-geoloc]";n+=", [data-lf-search-geolocation], .home-search-nav-geoloc-button";jQuery(n).on("click",function(){event.preventDefault();event.stopPropagation();0!==e&&0!==t&&(window.location.href="//"+window.location.hostname+"/geolocation?lat="+e.toString()+"&lng="+t.toString());return!1})}window.alert=function(){}});Class=function(){};Class.getGlobalObject=function(){return function(){return this}.call(null)};Class.mixin=function(e,t){t.__mixing&&t.__mixing(e);for(var n=Class.instanceMethods(t.prototype),i=0;i<n.length;i+=1)e.prototype[n[i]]=t.prototype[n[i]];t.__mixed&&t.__mixed(e)};Class.instanceVariables=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&"function"!=typeof e[n]&&t.push(n);return t};Class.instanceMethods=function(e){var t=[],n=e.constructor===Function?e:e.constructor.prototype;for(var i in n)n.hasOwnProperty(i)&&"function"==typeof n[i]&&t.push(i);return t};Class.duplicate=function(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]=e[n]&&"object"==typeof e[n]?Class.duplicate(e[n]):e[n];return t};Class.resolvePath=function(e,t){t=t||Class.getGlobalObject();for(var n=e.split("."),i=t,a=0;a<n.length;a+=1){i=i[n[a]];if("undefined"==typeof i)throw new Error("component '%s' in path '%s' is not defined".format(n[a],e))}return i};Delegatable=function(){};Delegatable.prototype.callDelegateMethod=function(e,t,n){return this.delegate&&this.delegate[e]?this.delegate[e].apply(this.delegate,t):n};gui.Backdrop=Base.extend({constructor:function(){var e=jQuery("body");this.__background=jQuery("<div/>").addClass("backdrop").hide().appendTo(e);this.__indicator=jQuery("<div/>").addClass("backdrop_indicator").hide().appendTo(e);this.__text=jQuery("<div/>").addClass("text").appendTo(this.__indicator);var t=this;jQuery(window).resize(function(){t.__resize()}).trigger("resize")},__resize:function(){var e=jQuery(window).height(),t=jQuery(window).width(),n=this.__indicator.outerHeight(),i=this.__indicator.outerWidth(),a=e/2-n/2,o=t/2-i/2,s=e/2+20,l=t/2-this.__text.width()/2;this.__background.css({width:t,height:e});this.__indicator.css({top:a,left:o});this.__text.css({top:s,left:l})},__showWithIndicator:function(e){e=e?e:0;this.__background.fadeIn(e);this.__indicator.fadeIn(e)},__showWithoutIndicator:function(e){e=e?e:0;this.__indicator.hide();this.__background.fadeIn(e)},hide:function(e){e=e?e:0;this.__background.fadeOut(e);this.__indicator.fadeOut(e)},__setIndicator:function(e,t){this.__indicator.removeClass("loading failure success");this.__indicator.addClass(e);this.__text.html(t)},showWithoutIndicator:function(e){this.__showWithoutIndicator(e)},showLoadingIndicator:function(e){this.__setIndicator("loading",I18n.translate("bridge.index.loading"));
this.__showWithIndicator(e);this.__resize()},showFailureIndicator:function(e,t){this.__setIndicator("failure",e);this.__showWithIndicator(t);this.__resize()},showSuccessIndicator:function(e,t){this.__setIndicator("success",e);this.__showWithIndicator(t);this.__resize()}},{sharedInstance:function(){gui.Backdrop.__sharedInstance||(gui.Backdrop.__sharedInstance=new gui.Backdrop);return gui.Backdrop.__sharedInstance}});lf.app.uniqueId=function(){var e="__lfid_"+lf.app.uniqueId.__next;lf.app.uniqueId.__next+=1;return e};lf.app.uniqueId.__next=0;lf.app.getApiModule=function(){var e=jQuery("script#lf_mapping_api"),t=e.data().lfApiModule,n=e.data().lfConfiguration,i=["tomtom","yandex","baidu"];-1!==jQuery.inArray(t,i)&&(t="leaflet");if(!t)switch(parseUri(e.attr("src")).host){case"ecn.dev.virtualearth.net":t="bing";break;case"secure-apijs.viamichelin.com":t="viamichelin";break;default:t="google"}var a=lf.maps[t];a.initialize&&a.initialize(n);return a};lf.maps.Bounds=Base.extend({constructor:function(e,t){this.ne={lat:t.lat,lng:t.lng};this.sw={lat:e.lat,lng:e.lng}},contains:function(e){var t=this.sw.lat<=e.lat&&e.lat<=this.ne.lat,n=this.sw.lng<=e.lng&&e.lng<=this.ne.lng;return t&&n},extend:function(e){e.lat>this.ne.lat&&(this.ne.lat=e.lat);e.lat<this.sw.lat&&(this.sw.lat=e.lat);e.lng>this.ne.lng&&(this.ne.lng=e.lng);e.lng<this.sw.lng&&(this.sw.lng=e.lng)},getCenterPoint:function(){var e=this.ne.lat-this.sw.lat,t=this.ne.lng-this.sw.lng,n=this.sw.lat+.5*e,i=this.sw.lng+.5*t;return{lat:n,lng:i}},getNorthWest:function(){return{lat:this.ne.lat,lng:this.sw.lng}},getSouthEast:function(){return{lat:this.sw.lat,lng:this.ne.lng}},getVisualizationUrl:function(){var e=[this.ne.lat,this.ne.lng].join(","),t=[this.sw.lat,this.sw.lng].join(",");return"https://maps.googleapis.com/maps/api/staticmap?zoom=4&size=512x512&maptype=roadmap&markers=color:blue|label:N|"+e+"&markers=color:green|label:S|"+t+"&sensor=false"}});lf.maps.Cluster=Base.extend({constructor:function(e){this.markerClusterer=e;this.map=this.markerClusterer.getMap();this.center=null;this.markers=[];this.bounds=null;this.clusterIcon=new(e.getClusterIconClass())({lat:0,lng:0});var t=this;this.clusterIcon.bind("click",function(){t.map.fitBounds(t.getMarkerBounds())})},addMarker:function(e){if(this.isMarkerAlreadyAdded(e))return!1;if(!this.center){this.center=e.getPosition();this.calculateBounds()}if(0===this.markers.length){e.setMap(this.map);e.setVisible(!0)}else{this.markers[0].setMap(null);this.markers[0].setVisible(!1)}e.isAdded=!0;this.markers.push(e);this.updateIcon();return!0},getCenter:function(){return this.center},getMarkerBounds:function(){if(0===this.markers.length)return new lf.maps.Bounds({lat:0,lng:0},{lat:0,lng:0});for(var e=this.markers[0].getPosition(),t=new lf.maps.Bounds(e,e),n=0;n<this.markers.length;n+=1)t.extend(this.markers[n].getPosition());return t},isMarkerAlreadyAdded:function(e){if(this.markers.indexOf)return-1!==this.markers.indexOf(e);for(var t=0;t<this.markers.length;t+=1)if(this.markers[t]===e)return!0;return!1},isMarkerInClusterBounds:function(e){return this.bounds.contains(e.getPosition())},remove:function(){this.clusterIcon&&this.clusterIcon.setMap(null);delete this.markers},setPositioningMarkerVisible:function(e){for(var t=0;t<this.markers.length;t+=1)this.markers[t].setPositioningMarkerVisible(e);this.clusterIcon&&this.clusterIcon.setPositioningMarkerVisible(e)},calculateBounds:function(){var e=new lf.maps.Bounds(this.center,this.center);this.bounds=this.markerClusterer.getExtendedBounds(e)},updateIcon:function(){var e=this.map.getZoom(),t=this.markerClusterer.getMaxZoom();if(e>t)for(var n=0;n<this.markers.length;n+=1){this.markers[n].setMap(this.map);this.markers[n].setVisible(!0)}else if(this.markers.length<2){this.clusterIcon.setVisible(!1);this.clusterIcon.setMap(null)}else{this.clusterIcon.setPosition(this.center);this.clusterIcon.setLabel(this.markers.length);this.clusterIcon.setVisible(!0);this.clusterIcon.setMap(this.map)}}});lf.maps.MarkerClusterer=Base.extend({constructor:function(e,t){this.map=e;this.markers=[];this.clusters=[];this.gridSize=60;this.maxZoom=null;this.ready=!1;this.prevZoom=this.map.getZoom();this.clusterIconClass=t;this.bindEvents()},addMarkers:function(e,t){for(var n=0;n<e.length;n+=1)this.addMarker(e[n]);t||this.redraw()},addMarker:function(e,t){this.pushMarker(e);t||this.redraw()},clearMarkers:function(){this.resetViewport();this.markers=[]},getClusterIconClass:function(){return this.clusterIconClass},getExtendedBounds:function(e){var t={lat:e.ne.lat,lng:e.ne.lng},n={lat:e.sw.lat,lng:e.sw.lng},i=this.map.getPixelForLatLng(t);i.x+=this.gridSize;i.y-=this.gridSize;var a=this.map.getPixelForLatLng(n);a.x-=this.gridSize;a.y+=this.gridSize;var o=this.map.getLatLngForPixel(i),s=this.map.getLatLngForPixel(a);return new lf.maps.Bounds(s,o)},getGridSize:function(){return this.gridSize},getMap:function(){return this.map},getMarkers:function(){return this.markers},getMarkerBounds:function(){if(0===this.markers.length)return new lf.maps.Bounds({lat:0,lng:0},{lat:0,lng:0});for(var e=this.markers[0].getPosition(),t=new lf.maps.Bounds(e,e),n=1;n<this.markers.length;n+=1)t.extend(this.markers[n].getPosition());return t},getClusterBounds:function(){if(0===this.clusters.length)return new lf.maps.Bounds({lat:0,lng:0},{lat:0,lng:0});for(var e=this.clusters[0],t=new lf.maps.Bounds(e.bounds.sw,e.bounds.ne),n=1;n<this.clusters.length;n+=1){t.extend(this.clusters[n].bounds.sw);t.extend(this.clusters[n].bounds.ne)}return t},getMaxZoom:function(){return"number"==typeof this.maxZoom?this.maxZoom:this.map.getMaxZoom()},getTotalClusters:function(){return this.clusters.length},getTotalMarkers:function(){return this.markers},redraw:function(){this.createClusters()},resetViewport:function(){var e;for(e=0;e<this.clusters.length;e+=1)this.clusters[e].remove();for(e=0;e<this.markers.length;e+=1){this.markers[e].isAdded=!1;this.markers[e].setMap(null);this.markers[e].setVisible(!1)}this.clusters=[]},setGridSize:function(e){this.gridSize=e},setMap:function(e){this.map=e},setMaxZoom:function(e){this.maxZoom=e},setPositioningMarkerVisible:function(e){for(var t=0;t<this.clusters.length;t+=1)this.clusters[t].setPositioningMarkerVisible(e)},bindEvents:function(){var e=this;this.map.bind("zoom_changed",function(){var t=e.map.getMaxZoom(),n=e.map.getZoom();if(!(0>n||n>t)&&e.prevZoom!==n){e.prevZoom=e.map.getZoom();e.resetViewport()}});this.map.bind("bounds_changed",function(){e.redraw()});this.map.bind("tilesloaded",function(){if(!e.ready){e.ready=!0;e.createClusters()}})},createClusters:function(){if(this.ready){var e=this.getExtendedBounds(this.map.getViewportBounds());this.hasPlottedMarkers=!1;for(var t=0;t<this.markers.length;t+=1){var n=this.markers[t];if(!n.isAdded&&e.contains(n.getPosition())){this.insertMarkerIntoClusters(n);this.hasPlottedMarkers=!0}}}},insertMarkerIntoClusters:function(e){for(var t=0;t<this.clusters.length;t+=1){var n=this.clusters[t];if(n.getCenter()&&n.isMarkerInClusterBounds(e)){n.addMarker(e);return n}}var i=new lf.maps.Cluster(this);i.addMarker(e);this.clusters.push(i);return i},pushMarker:function(e){e.setVisible(!1);e.setMap(null);e.isAdded=!1;this.markers.push(e)}});lf.maps.bing.Map=Base.extend({constructor:function(e,t){this.root=jQuery(e);this.root.append('<div class="map-container" style="position:absolute;"></div>');this.container=jQuery(".map-container",this.root);this.container.width(this.root.innerWidth());this.container.height(this.root.innerHeight());this.loaded=!1;this.loadedCallback=t;this.callbacks={};var n=null;n="undefined"!=typeof lf_mapping_config?lf_mapping_config.credentials:lf_bing_settings.credentials;this.map=new Microsoft.Maps.Map(this.container.get(0),{animate:!1,credentials:n,mapTypeId:Microsoft.Maps.MapTypeId.road,zoom:13,enableClickableLogo:!1,enableSearchLogo:!1});Microsoft.Maps.Events.addHandler(this.map,"tiledownloadcomplete",jQuery.proxy(this.tilesLoaded,this));Microsoft.Maps.Events.addHandler(this.map,"viewchangeend",jQuery.proxy(this.zoomLevelChanged,this));this.loaded=!0;this.loadedCallback(this)},fitBounds:function(e,t,n){var i=e.getNorthWest(),a=e.getSouthEast(),o=Microsoft.Maps.LocationRect.fromCorners(new Microsoft.Maps.Location(i.lat,i.lng),new Microsoft.Maps.Location(a.lat,a.lng));this.map.setView({animate:!1,bounds:o,padding:n});this.center=e.getCenterPoint();this.centerPointChanged();this.zoomLevelChanged()},redraw:function(){this.container.width(this.root.innerWidth());this.container.height(this.root.innerHeight())},getCenter:function(){return this.center},getZoom:function(){return this.map.getZoom()},getMaxZoom:function(){return this.map.getZoomRange.max},getPointOfSaleZoomLevel:function(){return 13},getMaxZIndex:function(){return 1e6},getPixelForLatLng:function(e){var t=new Microsoft.Maps.Location(e.lat,e.lng),n=this.map.tryLocationToPixel(t);return{x:n.x,y:n.y}},getLatLngForPixel:function(e){var t=this.map.tryPixelToLocation(e),n={lat:t.latitude,lng:t.longitude};return n},getViewportBounds:function(){var e=this.map.getBounds(),t={lng:e.getWest(),lat:e.getSouth()},n={lng:e.getEast(),lat:e.getNorth()};return new lf.maps.Bounds(t,n)},setCenter:function(e){this.center=e;var t=new Microsoft.Maps.Location(e.lat,e.lng);this.map.setView({animate:!1,center:t});this.centerPointChanged()},setZoom:function(e){this.map.setView({animate:!1,zoom:e})},bind:function(e,t){"undefined"==typeof this.callbacks[e]&&(this.callbacks[e]=[]);var n={id:lf.app.uniqueId(),event:e,fn:t};this.callbacks[e].push(n);return n},unbind:function(e){for(var t=this.callbacks[e.event],n=0;n<t.length;n+=1){var i=t[n];if(i.id===e.id){t.splice(n,1);break}}},centerPointChanged:function(){this.notifyCallbacksForEvent("bounds_changed")},zoomLevelChanged:function(){this.notifyCallbacksForEvent("zoom_changed");this.notifyCallbacksForEvent("bounds_changed")},mapLoaded:function(){this.loadedCallback&&this.loadedCallback.call(null,this);this.tilesLoaded()},tilesLoaded:function(){this.notifyCallbacksForEvent("tilesloaded")},notifyCallbacksForEvent:function(e){var t=this.callbacks[e];if(t)for(var n=0;n<t.length;n+=1)t[n].fn()}});lf.maps.bing.FrontOfficeMarker=Base.extend({constructor:function(e){this.callbacks={};this.setPosition(e);this.build()},setZIndex:function(e){this.marker.setOptions({zIndex:e})},getZIndex:function(){return this.marker.getZIndex()},showText:function(e){if(!this.popup){this.popup=new Microsoft.Maps.Infobox(this.latlng,{visible:!1,offset:new Microsoft.Maps.Point(0,20)});this.map.map.entities.push(this.popup)}var t='<div class="lf_mapbubble_text">'+e+"</div>";this.popup.setOptions({description:t,visible:!0,offset:this.getMarkerSettings().infoboxOffset,zIndex:this.getZIndex()+1});var n=this,i=function(){var e=jQuery(".lf_mapbubble_text").innerHeight(),t=jQuery(".infobox-info:visible"),i=t.outerHeight(!0)-t.height(),a=e+i;n.popup.setOptions({height:a});var o=jQuery(".infobox-close:visible");if(!o.data("hasClickHandler")){o.click(function(e){e.preventDefault()});o.data("hasClickHandler","true")}},a=Microsoft.Maps.Events.addHandler(this.map.map,"viewchangeend",function(){Microsoft.Maps.Events.removeHandler(a);i();n.scrollInfoBoxIntoView(n.popup,30)});i();this.scrollInfoBoxIntoView(n.popup,30)},hideText:function(){this.popup&&this.popup.setOptions({visible:!1})},setMap:function(e){var t=this.map;this.map=e;if(this.marker)if(this.map){t&&t.map.entities.remove(this.marker);this.map.map.entities.push(this.marker)}else t&&t.map.entities.remove(this.marker)},setLabel:function(e){this.label=e;this.marker&&this.marker.setOptions({text:e})},setPosition:function(e){this.latlng=new Microsoft.Maps.Location(e.lat,e.lng);this.marker&&this.marker.setLocation(this.latlng)},getPosition:function(){var e=this.marker.getLocation();return{lat:e.latitude,lng:e.longitude}},setVisible:function(e){this.marker.setOptions({visible:e})},setPositioningMarkerVisible:function(e){this.marker.setOptions({visible:e})},bind:function(e,t,n){"undefined"==typeof this.callbacks[e]&&(this.callbacks[e]=[]);if(2===arguments.length){n=arguments[1];t=null}this.callbacks[e].push([n,t])},build:function(){this.marker=new Microsoft.Maps.Pushpin(this.latlng,this.getMarkerSettings());var e=this;Microsoft.Maps.Events.addHandler(this.marker,"click",function(){e.notifyCallbacksForEvent("click")})},notifyCallbacksForEvent:function(e){var t=this.callbacks[e];if(t)for(var n=0;n<t.length;n+=1)t[n][0].call(null,{data:t[n][1]})},getMarkerSettings:function(){var e=this.settingsKey;"undefined"==typeof lf.maps.bing.markerSettingsCache&&(lf.maps.bing.markerSettingsCache={});if("undefined"==typeof lf.maps.bing.markerSettingsCache[e]){var t=lf_bing_settings[e];lf.maps.bing.markerSettingsCache[e]={anchor:this.getMarkerSettingsForPoint(t.anchor),icon:t.icon,width:t.width,height:t.height,textOffset:this.getMarkerSettingsForPoint(t.textOffset),infoboxOffset:this.getMarkerSettingsForPoint(t.infoboxOffset)}}return lf.maps.bing.markerSettingsCache[e]},getMarkerSettingsForPoint:function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y?new Microsoft.Maps.Point(e.x,e.y):null},scrollInfoBoxIntoView:function(e,t){var n=this.map.map,i=e.getOffset(),a=e.getAnchor(),o=n.tryLocationToPixel(e.getLocation(),Microsoft.Maps.PixelReference.control),s=o.x+i.x-a.x,l=o.y-25-a.y;if(t>l){l*=-1;l+=t}else l=0;if(t>s){s*=-1;s+=t}else{s=n.getWidth()-o.x+a.x-e.getWidth();s>t?s=0:s-=t}(0!==s||0!==l)&&n.setView({animate:!1,centerOffset:new Microsoft.Maps.Point(s,l),center:n.getCenter()})}});lf.maps.bing.ClusterMarker=lf.maps.bing.FrontOfficeMarker.extend({constructor:function(e){this.settingsKey="clusterMarker";this.base(e);this.marker.setOptions({text:"0",typeName:"lf_marker cluster"});this.setVisible(!0)},setLabel:function(e){this.base("x "+e)}});lf.maps.bing.InactiveClusterMarker=lf.maps.bing.FrontOfficeMarker.extend({constructor:function(e){this.settingsKey="inactiveClusterMarker";this.base(e);this.marker.setOptions({text:"0",typeName:"lf_marker inactive_cluster"});this.setVisible(!0)},setLabel:function(e){this.base("x "+e)}});lf.maps.bing.InactiveMarker=lf.maps.bing.FrontOfficeMarker.extend({constructor:function(e){this.settingsKey="inactiveMarker";this.base(e);this.marker.setOptions({text:"0",typeName:"lf_marker inactive_number"});this.setVisible(!0)}});lf.maps.bing.NumberMarker=lf.maps.bing.FrontOfficeMarker.extend({constructor:function(e,t){this.settingsKey="numberMarker";this.base(t);this.marker.setOptions({text:e.toString(),typeName:"lf_marker active_number"});this.setVisible(!0)}});lf.maps.bing.SingleMarker=lf.maps.bing.FrontOfficeMarker.extend({constructor:function(e){this.settingsKey="singleMarker";this.base(e);this.marker.setOptions({typeName:"lf_marker active_current"});this.setVisible(!0)}});lf.maps.bing.DirectionsService=Base.extend({constructor:function(e,t,n,i){this.delegate=e;this.origin=t;this.destination=n;var a=this,o=function(){i(a)};Microsoft.Maps.loadModule("Microsoft.Maps.Directions",{callback:o})},process:function(){var e=new Microsoft.Maps.Directions.DirectionsManager(this.delegate.map.map);e.setRequestOptions({distanceUnit:Microsoft.Maps.Directions.DistanceUnit.kilometers});var t=new Microsoft.Maps.Directions.Waypoint({address:this.origin});e.addWaypoint(t);var n={};this.destination.latitude?n.location=this.destination:n.address=this.destination;var i=new Microsoft.Maps.Directions.Waypoint(n);e.addWaypoint(i);var a=this;Microsoft.Maps.Events.addHandler(e,"directionsError",function(){e.dispose();a.callDelegateMethod("didReceiveFailingDirections",[a])});Microsoft.Maps.Events.addHandler(e,"directionsUpdated",function(t){var n=a.convertResult(e,t);e.dispose();a.callDelegateMethod("didReceiveSuccessfulDirections",[a,n])});e.setRenderOptions({autoDisplayDisambiguation:!1,autoUpdateMapView:!1});e.calculateDirections()},resultMatchesGeolocation:function(e){var t=e.route[0].routeLegs[0].endWaypointLocation;return this.delegate.resultMatchesGeolocation(t.latitude,t.longitude)},convertResult:function(e,t){var n=t.routeSummary[0],i=t.route[0];if(1===i.routeLegs.length&&this.resultMatchesGeolocation(t)){for(var a=i.routeLegs[0],o=[],s=0;s<a.itineraryItems.length;s+=1){var l=a.itineraryItems[s];l.maneuver!==Microsoft.Maps.Directions.Maneuver.arriveFinish&&o.push({description:l.formattedText,distance:l.distance})}for(var r=[],u=0;u<a.subLegs.length;u+=1)for(var d=a.subLegs[u],c=d.routePath.decodedLatitudes,p=d.routePath.decodedLongitudes,h=0;h<c.length;h+=1)r.push({lat:c[h],lng:p[h]});return{copyrights:"",estimatedDistance:n.distance,estimatedDuration:n.time,steps:o,points:r}}this.callDelegateMethod("didReceiveFailingDirections",[this])}});lf.maps.bing.DirectionsService.routeForPoint=function(e,t,n,i){var a=new Microsoft.Maps.Location(n.lat,n.lng);return new lf.maps.bing.DirectionsService(e,t,a,i)};lf.maps.bing.DirectionsService.routeForAddress=function(e,t,n,i){return new lf.maps.bing.DirectionsService(e,t,n,i)};Class.mixin(lf.maps.bing.DirectionsService,Delegatable);lf.maps.bing.PolygonLine=Base.extend({constructor:function(e,t){this.setMap(e);this.points=t.points;this.color=t.color;this.line=new Microsoft.Maps.Polyline(this.pointsToBing(t.points),{strokeColor:this.colorToBing(t.color)});this.map.map.entities.push(this.line)},setMap:function(e){this.map=e;this.line&&this.line.setMap(this.map)},getMap:function(){return this.map},setColor:function(e){this.color=e;this.line&&this.line.setOptions({strokeColor:this.colorToBing(e)})},getColor:function(){return this.color},setPoints:function(e){this.points=e;this.line&&this.line.setLocations(this.pointsToBing(e))},getPoints:function(){return this.points},colorToBing:function(e){var t=parseInt(255*e.a,10),n=parseInt(255*e.r,10),i=parseInt(255*e.g,10),a=parseInt(255*e.b,10);return new Microsoft.Maps.Color(t,n,i,a)},pointsToBing:function(e){for(var t=[],n=0;n<e.length;n+=1){var i=e[n];t.push(new Microsoft.Maps.Location(i.lat,i.lng))}return t}});lf.maps.google.Map=Base.extend({constructor:function(e,t){this.loadedCallback=t;var n=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.HYBRID];this.map=new google.maps.Map(e,{zoom:13,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,mapTypeControlOptions:{mapTypeIds:n,style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR}});var i=this;this.overlay=new google.maps.OverlayView;this.overlay.setMap(this.map);this.overlay.onAdd=function(){i.mapLoaded()};this.overlay.draw=function(){}},fitBounds:function(e,t){var n=new google.maps.LatLng(e.sw.lat,e.sw.lng),i=new google.maps.LatLng(e.ne.lat,e.ne.lng),a=new google.maps.LatLngBounds(n,i);t&&google.maps.event.addListenerOnce(this.map,"bounds_changed",function(){this.getZoom()>t&&this.setZoom(t)});this.map.fitBounds(a)},redraw:function(){google.maps.event.trigger(this.map,"resize")},getCenter:function(){var e=this.map.getCenter();return{lat:e.lat(),lng:e.lng()}},getZoom:function(){return this.map.getZoom()},getMaxZoom:function(){return this.map.mapTypes[this.map.getMapTypeId()].maxZoom},getPointOfSaleZoomLevel:function(){return 13},getMaxZIndex:function(){return google.maps.Marker.MAX_ZINDEX},getPixelForLatLng:function(e){var t=this.overlay.getProjection();if(!t)return{x:0,y:0};var n=new google.maps.LatLng(e.lat,e.lng),i=t.fromLatLngToDivPixel(n);return{x:i.x,y:i.y}},getLatLngForPixel:function(e){var t=this.overlay.getProjection();if(!t)return{lat:0,lng:0};var n=new google.maps.Point(e.x,e.y),i=t.fromDivPixelToLatLng(n);return{lat:i.lat(),lng:i.lng()}},getViewportBounds:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),i={lat:n.lat(),lng:n.lng()},a={lat:t.lat(),lng:t.lng()};return new lf.maps.Bounds(i,a)},setCenter:function(e){this.map.setCenter(new google.maps.LatLng(e.lat,e.lng))},setZoom:function(e){this.map.setZoom(e)},bind:function(e,t){return google.maps.event.addListener(this.map,e,t)},unbind:function(e){google.maps.event.removeListener(e)},mapLoaded:function(){if(!this.loaded){this.loaded=!0;this.loadedCallback&&this.loadedCallback.call(null,this)}}});lf.maps.google.Overlay=Base.extend({constructor:function(e,t){this.setLabel(e||"");this.setPosition(t);this.build()},setMap:function(e){this.map=e;this.overlay&&this.overlay.setMap(e)},setLabel:function(e){this.label=e;this.overlay&&this.icon.html(e)},setPosition:function(e){this.position=e;this.overlay&&this.ready&&this.draw()},setVisible:function(e){e?this.root.show():this.root.hide()},setActive:function(e){this.isActive=e;if(this.overlay){this.icon.attr("class",this.getIconClass());this.setZIndex(this.zIndex)}},getZIndex:function(){return this.zIndex},setZIndex:function(e){this.zIndex=e;this._setZIndex(e)},_setZIndex:function(e){this.marker&&"number"==typeof e&&this.marker.setZIndex(e);this.overlay&&this.isActive&&"number"==typeof e?this.icon.css("z-index",e):this.icon.css("z-index","auto")},setStyle:function(e){this.style=e;if(this.overlay){this.icon.attr("class",this.getIconClass());this.shadow.attr("class",this.getShadowClass())}},getShadowClass:function(){return this.style+"_shadow"},getIconClass:function(){return(this.isActive?"active":"inactive")+"_"+this.style},bind:function(){this.icon.bind.apply(this.icon,arguments)},build:function(){this.overlay=new google.maps.OverlayView;this.root=jQuery("<span/>").addClass("lf_marker").css("position","absolute");this.shadow=jQuery("<span/>").addClass(this.getShadowClass()).appendTo(this.root);this.icon=jQuery("<span/>").addClass(this.getIconClass()).css("cursor","pointer").html(this.label).appendTo(this.root);var e=this;this.overlay.onAdd=function(){e.onAdd()};this.overlay.draw=function(){e.draw()};this.overlay.onRemove=function(){e.onRemove()}},onAdd:function(){var e=this.overlay.getPanes();this.root.appendTo(e.floatShadow);this.ready=!0},draw:function(){this.createPrintIcon();var e=this.overlay.getProjection().fromLatLngToDivPixel(this.position);this.root.css({left:e.x-this.root.width()/2,top:e.y-this.root.height()})},onRemove:function(){this.root.detach();this.ready=!1},createPrintIcon:function(){if(!this.printIcon){var e=this.icon.css("background-image").match(/^url\((.+)\)$/);e&&(this.printIcon=jQuery("<img/>").attr("src",e[1].replace(/[\"]/g,"")).appendTo(this.root))}}});lf.maps.google.FrontOfficeMarker=Base.extend({constructor:function(e){this.setPosition(e);this.build()},setZIndex:function(e){this.zIndex=e;this.marker.setZIndex(e);this.overlay.setZIndex(e)},getZIndex:function(){return this.zIndex},showText:function(e){this.popup||(this.popup=new google.maps.InfoWindow);this.popup.setContent("<div class='lf_mapbubble_text' style='overflow-y:hidden;padding-right:15px;'>"+e+"</div>");this.popup.open(this.marker.getMap(),this.marker)},hideText:function(){this.popup&&this.popup.close()},setMap:function(e){this.map=e;if(this.marker)if(this.map){this.marker.setMap(this.map.map);this.overlay.setMap(this.map.map)}else{this.marker.setMap(null);this.overlay.setMap(null)}},setLabel:function(e){this.label=e;this.marker&&this.overlay.setLabel(this.label)},setPosition:function(e){this.latlng=new google.maps.LatLng(e.lat,e.lng);if(this.marker){this.marker.setPosition(this.latlng);this.overlay.setPosition(this.latlng)}},getPosition:function(){var e=this.marker.getPosition();return{lat:e.lat(),lng:e.lng()}},setVisible:function(e){this.overlay.setVisible(e)},setPositioningMarkerVisible:function(e){this.marker.setVisible(e)},bind:function(){this.overlay.bind.apply(this.overlay,arguments)},build:function(){this.marker=new google.maps.Marker({flat:!0,position:this.latlng,visible:!1});this.overlay=new lf.maps.google.Overlay(this.label,this.latlng)}});lf.maps.google.InactiveMarker=lf.maps.google.FrontOfficeMarker.extend({constructor:function(e){this.base(e);this.overlay.setActive(!1);this.overlay.setStyle("number")}});lf.maps.google.NumberMarker=lf.maps.google.FrontOfficeMarker.extend({constructor:function(e,t){this.number=e;this.base(t);this.overlay.setLabel(e);this.overlay.setActive(!0);this.overlay.setStyle("number")}});lf.maps.google.ClusterMarker=lf.maps.google.FrontOfficeMarker.extend({constructor:function(e){this.base(e);this.overlay.setLabel(0);this.overlay.setActive(!0);this.overlay.setStyle("cluster")},setLabel:function(e){this.base("x "+e)}});lf.maps.google.InactiveClusterMarker=lf.maps.google.FrontOfficeMarker.extend({constructor:function(e){this.base(e);this.overlay.setLabel(0);this.overlay.setActive(!1);this.overlay.setStyle("cluster")},setLabel:function(e){this.base("x "+e)}});lf.maps.google.SingleMarker=lf.maps.google.FrontOfficeMarker.extend({constructor:function(e){this.base(e);this.overlay.setActive(!0);this.overlay.setStyle("current")}});lf.maps.google.PolygonLine=Base.extend({constructor:function(e,t){this.setMap(e);this.setColor(t.color||{r:1,g:0,b:0,a:1});this.line=new google.maps.Polyline(this.getGoogleMapOptions(this.pointsToGMap(t.points)))},setMap:function(e){this.map=e;this.line&&this.line.setMap(this.map)},getMap:function(){return this.map},setColor:function(e){this.color=e;this.line&&this.line.setOptions(this.getGoogleMapOptions())},getColor:function(){return this.color},setPoints:function(e){this.points=e;this.line&&this.line.setPath(this.pointsToGMap(e))},getPoints:function(){return this.points},getGoogleMapOptions:function(e){return{map:this.map.map,strokeColor:this.getRGBString(),strokeOpacity:this.getColor().a,path:e}},getRGBString:function(){function e(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n}var t=parseInt(255*this.color.r,10).toString(16),n=parseInt(255*this.color.g,10).toString(16),i=parseInt(255*this.color.b,10).toString(16);return sprintf("#%s%s%s",e(t,2),e(n,2),e(i,2))},pointsToGMap:function(e){for(var t=[],n=0;n<e.length;n+=1){var i=e[n];t.push(new google.maps.LatLng(i.lat,i.lng))}return t}});lf.maps.google.DirectionsService=Base.extend({constructor:function(e,t,n,i){this.delegate=e;this.origin=t;this.destination=n;this.service=new google.maps.DirectionsService;i(this)},process:function(){var e=this;this.service.route({destination:this.destination,origin:this.origin,travelMode:google.maps.DirectionsTravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC},function(t,n){if(n===google.maps.DirectionsStatus.OK&&e.resultMatchesGeolocation(t)){var i=e.convertResult(t);e.callDelegateMethod("didReceiveSuccessfulDirections",[e,i])}else e.callDelegateMethod("didReceiveFailingDirections",[e])})},resultMatchesGeolocation:function(e){var t=e.routes[0].legs[0].end_location;return this.delegate.resultMatchesGeolocation(t.lat(),t.lng())},convertResult:function(e){var t=e.routes[0];if(1===t.legs.length){for(var n=t.legs[0],i=[],a=[],o=0;o<n.steps.length;o+=1){for(var s=n.steps[o],l=0;l<s.path.length;l+=1){var r=s.path[l];a.push({lat:r.lat(),lng:r.lng()})}i.push({description:s.instructions,distance:s.distance.value/1e3})}return{copyrights:t.copyrights,estimatedDistance:n.distance.value/1e3,estimatedDuration:n.duration.value,steps:i,points:a}}this.callDelegateMethod("didReceiveFailingDirections",[this])}});lf.maps.google.DirectionsService.routeForPoint=function(e,t,n,i){var a=[n.lat,n.lng].join(",");return new lf.maps.google.DirectionsService(e,t,a,i)};lf.maps.google.DirectionsService.routeForAddress=function(e,t,n,i){return new lf.maps.google.DirectionsService(e,t,n,i)};Class.mixin(lf.maps.google.DirectionsService,Delegatable);lf.maps.leaflet.initialize=function(e){e=jQuery.extend({posZoomLevel:13,clusterMarker:{},inactiveClusterMarker:{},inactiveMarker:{},numberMarker:{},singleMarker:{}},e);this.loadConfiguration(e)};lf.maps.leaflet.loadConfiguration=function(e){this.configuration={};var t=function(){var t=jQuery.extend({},e);jQuery.each(t,function(e,t){void 0!==t.prependTemplateAssetPathFor&&jQuery.each(t.prependTemplateAssetPathFor,function(e,n){t[n]=lf_asset_base+t[n];t.prependTemplateAssetPathFor.splice(e,1)})});return t};this.rawConfiguration=t();var n=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},i=null;for(var a in e){i=e[a];if(i&&"object"==typeof i&&/\w+Marker$/.test(a)){var o=this[n(a)];o&&(o.Icon=this.createIconClass(i))}else this.configuration[a]=i}};lf.maps.leaflet.createIconClass=function(e){var t={},n=null;for(var i in e){n=e[i];n&&n.hasOwnProperty("x")&&n.hasOwnProperty("y")&&(n=new L.Point(Number(n.x),Number(n.y)));n&&lf_asset_base&&/\w+Url$/.test(i)&&(n=lf_asset_base+n);t[i]=n}return this.LabelIcon.extend({options:t})};"undefined"!=typeof L&&(lf.maps.leaflet.LabelIcon=L.Icon.extend({options:{iconUrl:"/javascripts/leaflet-0.7.2/images/marker-icon.png",shadowUrl:"/javascripts/leaflet-0.7.2/images/marker-shadow.png",iconSize:new L.Point(25,41),shadowSize:new L.Point(41,41),iconAnchor:new L.Point(13,41),popupAnchor:new L.Point(0,-33),text:null,textAnchor:new L.Point(0,0),className:null},_createLabelAndIconIE6:function(e,t){var n=document.createElement("div");n.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+e+'")';n.style.textAlign="center";var i=document.createElement("span");i.innerHTML=this.options.text;i.className="leaflet-marker-icon-label";i.style.display="inline-block";t&&(i.style.paddingTop=this.options.textAnchor.y.toString()+"px");n.appendChild(i);return n},_createLabelAndIcon:function(e,t){var n=document.createElement("div"),i=this._createImg(e);n.appendChild(i);var a=document.createElement("div");a.innerHTML=this.options.text;a.className="leaflet-marker-icon-label";a.style.position="relative";if(t){a.style.top=0-t.y+"px";a.style.left=0-t.x+"px";a.style.paddingTop=this.options.textAnchor.y.toString()+"px"}a.style.textAlign="center";n.appendChild(a);return n},_createIcon:function(e){var t=this.options[e+"Size"],n=this.options[e+"Url"];if(!n&&"shadow"===e)return null;var i;i="icon"===e&&this.options.text?L.Browser.ie6?this._createLabelAndIconIE6(n,t):this._createLabelAndIcon(n,t):n?this._createImg(n):this._createDiv();var a="leaflet-marker-"+e;this.options.className&&(a=a+" "+this.options.className);i.className=a;i.style.marginLeft=-this.options.iconAnchor.x+"px";i.style.marginTop=-this.options.iconAnchor.y+"px";if(t){i.style.width=t.x+"px";i.style.height=t.y+"px"}return i}}));"undefined"!=typeof L&&(lf.maps.leaflet.TomtomTileLayer=L.TileLayer.WMS.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"basic",styles:"",format:"image/png",transparent:!1},getTileUrl:function(e,t){var n=this._map,i=n.options.crs,a=this.options.tileSize,o=e.multiplyBy(a),s=o.add(new L.Point(a,a)),l=n.unproject(o,t,!0),r=n.unproject(s,t,!0),u=i.project(l),d=i.project(r),c=[u.x,d.y,d.x,u.y].join(","),p={};for(var h in this.wmsParams)p[h.toUpperCase()]=this.wmsParams[h];var f=this._url+L.Util.getParamString(p)+"&BBOX="+c;return f},onAdd:function(e,t){L.TileLayer.WMS.prototype.onAdd.call(this,e,t);e.on("moveend",this._updateViewportInfo,this);this._updateViewportInfo()},_updateViewportInfo:function(){var e=this._map,t=e.getBounds(),n=e.options.crs,i=t.getNorthWest(),a=t.getSouthEast(),o=n.project(i),s=n.project(a),l={bbox:[s.y,o.x,o.y,s.x].join(","),zoomLevel:e.getZoom(),key:this.options.apikey},r=this._applyTemplate("http://lbs.tomtom.com/lbs/services/wbrp/1/viewportDesc/{bbox}/{zoomLevel}/{bbox}/{zoomLevel}/true/jsonp/{key}?jsonp=?",l);this._vpCache||(this._vpCache={});if(this._vpCache[r])this._setViewportInfo(this._vpCache[r]);else{var u=this;jQuery.getJSON(r,function(e){var t=e.viewpResp;u._vpCache[r]=t;u._setViewportInfo(t)})}},_applyTemplate:function(e,t){return e.replace(/\{(\w*)\}/g,function(e,n){return t[n]})},_setViewportInfo:function(e){this._constrainZoom(e.canZoomIn);this._setAttribution(e.copyrightIds.replace(/\^/g," "))},_constrainZoom:function(e){var t=this._map;t.options.maxZoom=e?1/0:t.getZoom()},_setAttribution:function(e){if(!this._currentAttribution||this._currentAttribution!==e){var t=this._map.attributionControl;this._map.attributionControl._attributions={};t.addAttribution(e);this._currentAttribution=e}}}));"undefined"!=typeof L&&(lf.maps.leaflet.YandexTileLayer=L.TileLayer.WMS.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1,routePoints:[]},initialize:function(e,t){L.Util.setOptions(this,t);this._type="yandex#"+(e||"map");if(this.options.routePoints.length>0){this.from=[this.options.routePoints[0].lat,this.options.routePoints[0].lng].join(",");this.to=[this.options.routePoints[1].lat,this.options.routePoints[1].lng].join(",")}},onAdd:function(e,t){this._map=e;this._insertAtTheBottom=t;this._initContainer();this._initMapObject();e.on("viewreset",this._resetCallback,this);this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);e.on("move",this._update,this);this._reset();this._update(!0)},onRemove:function(){this._map._container.removeChild(this._container);this._map.off("viewreset",this._resetCallback,this);this._map.off("move",this._update,this)},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e;
1>e&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px";e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;if(!this._container){this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left");this._container.id="_YMapContainer_"+L.Util.stamp(this);this._container.style.zIndex="auto"}if(this.options.overlay){t=this._map._container.getElementsByClassName("leaflet-map-pane")[0];t=t.nextSibling;L.Browser.opera&&(this._container.className+=" leaflet-objects-pane")}e.insertBefore(this._container,t);this.setOpacity(this.options.opacity);this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._yandex){this.loadRequiredPackages();var e=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[]});this.options.traffic&&e.controls.add(new ymaps.control.TrafficControl({shown:!0}));if("yandex#null"===this._type){this._type=new ymaps.MapType("null",[]);e.container.getElement().style.background="transparent"}this.options.routePoints.length>0&&this.displayItinerary(e);e.setType(this._type);this._yandex=e;this._update(!0)}},_resetCallback:function(e){this._reset(e.hard)},_reset:function(){this._initContainer()},_update:function(e){if(this._yandex){this._resize(e);var t=this._map.getCenter(),n=[t.lat,t.lng],i=this._map.getZoom();(e||this._yandex.getZoom()!==i)&&this._yandex.setZoom(i);this._yandex.panTo(n,{duration:0,delay:0})}},_resize:function(e){var t=this._map.getSize(),n=this._container.style;if(n.width!==t.x+"px"||n.height!==t.y+"px"||e===!0){this.setElementSize(this._container,t);{var i=this._map.getBounds();i.getSouthWest(),i.getNorthEast()}this._yandex.container.fitToViewport()}},loadRequiredPackages:function(){return void 0===ymaps.Map?ymaps.load(["package.map"],this._initMapObject,this):this.options.routePoints.length>0&&void 0===ymaps.route?ymaps.load(["package.route"],this._initMapObject,this):!this.options.traffic||void 0!==ymaps.control&&void 0!==ymaps.control.TrafficControl?void 0:ymaps.load(["package.traffic","package.controls"],this._initMapObject,this)},displayItinerary:function(e){ymaps.route([this.from,this.to],{avoidTrafficJams:!0}).then(function(t){var n=t.getWayPoints(),i=lf.maps.leaflet.rawConfiguration,a=jQuery.extend({},i.yandexStartMarker),o=jQuery.extend({},i.yandexEndMarker),s=n.get(0),l=n.get(n.getLength()-1);s.options.set(a);l.options.set(o);e.geoObjects.add(t)},function(e){alert("Error occurred: "+e.message)})}}));"undefined"!=typeof L&&(lf.maps.leaflet.BaiduTileLayer=L.TileLayer.WMS.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1,routePoints:[]},initialize:function(e,t){L.Util.setOptions(this,t);this._type="baidu#"+(e||"map");if(this.options.routePoints.length>0){this.from=new BMap.Point(this.options.routePoints[0].lng,this.options.routePoints[0].lat);this.to=new BMap.Point(this.options.routePoints[1].lng,this.options.routePoints[1].lat)}},onAdd:function(e,t){this._map=e;this._insertAtTheBottom=t;this._initContainer();this._initMapObject();e.on("viewreset",this._resetCallback,this);this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);e.on("move",this._update,this);this._reset();this._update()},onRemove:function(){this._map._container.removeChild(this._container);this._map.off("viewreset",this._resetCallback,this);this._map.off("move",this._update,this)},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e;1>e&&L.DomUtil.setOpacity(this._container,e)},setElementSize:function(e,t){e.style.width=t.x+"px";e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;if(!this._container){this._container=L.DomUtil.create("div","leaflet-baidu-layer leaflet-top leaflet-left");this._container.id="_BMapContainer_"+L.Util.stamp(this);this._container.style.zIndex="auto";this._container.style.pointerEvents="auto"}e.insertBefore(this._container,t);this.setOpacity(this.options.opacity);this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._baidu){this._baidu=new BMap.Map(this._container);this._baidu.addControl(new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_SATELLITE_MAP]}));var e=this._map.getCenter(),t=new BMap.Point(e.lng,e.lat),n=this._map.getZoom();this._baidu.centerAndZoom(t,n);this.options.routePoints.length>0&&this.displayItinerary(this._baidu);this._update()}},_resetCallback:function(e){this._reset(e.hard)},_reset:function(){this._initContainer()},_update:function(){if(this._baidu){var e=this._map.getCenter(),t=this._gcj02tobd09(e),n=this._map.getZoom();this._baidu.setZoom(n);this._baidu.panTo(t,{noAnimation:!0});for(var i=0;Object.keys(this._map._layers).length>1;i+=1){var a=this._map._layers[Object.keys(this._map._layers)[1]],o=new BMap.Point(a._latlng.lng,a._latlng.lat),s=jQuery("script#lf_mapping_api").data(),l=s.lfConfiguration.numberMarker.iconSize,r=s.lfConfiguration.numberMarker.iconAnchor,u=s.lfConfiguration.numberMarker.textAnchor,d=new BMap.Icon(s.lfFoPath+s.lfConfiguration.numberMarker.iconUrl,new BMap.Size(l.x,l.y),{anchor:new BMap.Size(r.x,r.y),infoWindowAnchor:new BMap.Size(10,0)}),c=new BMap.Marker(o,{icon:d}),p=a._icon.outerText;"undefined"==typeof p&&(p=a._icon.textContent);var h=new BMap.Label(p,{offset:new BMap.Size(u.x,u.y)});h.setStyle({border:0});c.setLabel(h);void 0!==a.pos_url&&this.addEventOnClick(c,a);this._map.removeLayer(a);this.addOffsetToMarker(c)}}},addOffsetToMarker:function(e){var t=this._gcj02tobd09(e.point);e.setPosition(t);this._baidu.addOverlay(e)},_gcj02tobd09:function(e){var t=e.lng,n=e.lat,i=Coordtransform.gcj02tobd09(t,n),a=i[0],o=i[1];return new BMap.Point(a,o)},baiduURL:function(e){return"https://api.map.baidu.com/ag/coord/convert?from=2&to=4&x="+e.lng+"&y="+e.lat},displayItinerary:function(){var e=new BMap.DrivingRoute("中国",{renderOptions:{map:this._baidu}});e.search(this.from,this.to)},addEventOnClick:function(e,t){e.addEventListener("click",function(){var e=t.pos_url.split("-")[0];jQuery.ajax({url:"/popup/"+e,dataType:"text",success:function(e){this.openInfoWindow(new BMap.InfoWindow(e))}.bind(this)})})}}));lf.maps.leaflet.Map=Base.extend({constructor:function(e,t,n){this.root=jQuery(e);var i=this.generateContainerId();this.root.append('<div id="'+i+'"></div>');this.container=jQuery("#"+i,this.root);this.container.width(this.root.innerWidth());this.container.height(this.root.innerHeight());this.loaded=!1;this.loadedCallback=t;this.callbacks={};this.map=new L.Map(this.container.attr("id"),n);this.map.attributionControl.setPrefix(null);this.service=jQuery("script#lf_mapping_api").data().lfApiModule;var a=this;this.map.on("load",function(){var e=a.initLeafletLayer();a.map.addLayer(e);a.loaded=!0;a.mapLoaded()});this.map.on("move",function(){a.centerPointChanged()});this.map.on("zoomend",function(){a.zoomLevelChanged()});this.map.on("click",function(){a.mapClicked()});this.map.setView(new L.LatLng(0,0),this.getPointOfSaleZoomLevel())},initLeafletLayer:function(){return"tomtom"===this.service?new lf.maps.leaflet.TomtomTileLayer("http://lbs.tomtom.com/lbs/wms/1213610065958",{apikey:lf.maps.leaflet.configuration.apikey,minZoom:2,maxZoom:17}):"yandex"===this.service?new lf.maps.leaflet.YandexTileLayer:"baidu"===this.service?new lf.maps.leaflet.BaiduTileLayer:void 0},fitBounds:function(e){var t=new L.LatLngBounds(e.sw,e.ne);this.map.fitBounds(t);this.center=e.getCenterPoint();this.centerPointChanged();this.zoomLevelChanged()},redraw:function(){this.container.width(this.root.innerWidth());this.container.height(this.root.innerHeight());this.map.invalidateSize()},getCenter:function(){return this.center},getZoom:function(){return this.map.getZoom()},getMaxZoom:function(){return this.map.getMaxZoom()},getPointOfSaleZoomLevel:function(){return lf.maps.leaflet.configuration.posZoomLevel},getMaxZIndex:function(){return 1e6},getPixelForLatLng:function(e){var t=this.map.layerPointToContainerPoint(this.map.latLngToLayerPoint(this.getLatLng(e)));return{x:t.x,y:t.y}},getLatLngForPixel:function(e){var t=new L.Point(e.x,e.y),n=this.map.unproject(t.add(this.map._getTopLeftPoint())),i={lat:n.lat,lng:n.lng};return i},getViewportBounds:function(){var e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast(),i={lng:t.lng,lat:t.lat},a={lng:n.lng,lat:n.lat},o=new lf.maps.Bounds(i,a);return o},setCenter:function(e){this.center=e;this.map.setView(this.getLatLng(this.center),this.getZoom(),!1);this.centerPointChanged()},getLatLng:function(e){return new L.LatLng(e.lat,e.lng)},setZoom:function(e){this.map.setZoom(e)},bind:function(e,t){"undefined"==typeof this.callbacks[e]&&(this.callbacks[e]=[]);var n={id:lf.app.uniqueId(),event:e,fn:t};this.callbacks[e].push(n);return n},unbind:function(e){for(var t=this.callbacks[e.event],n=0;n<t.length;n+=1){var i=t[n];if(i.id===e.id){t.splice(n,1);break}}},displayRoute:function(e){this.routeLayer&&this.map.removeLayer(this.routeLayer);if("tomtom"===this.service)this.routeLayer=new lf.maps.leaflet.TomtomTileLayer("http://lbs.tomtom.com/lbs/wms/1213610065958",{apikey:lf.maps.leaflet.configuration.apikey,minZoom:2,maxZoom:17,layers:"canvas",format:"image/gif",routekey:e.routeKey});else if("yandex"===this.service){this.removeLayers();this.routeLayer=new lf.maps.leaflet.YandexTileLayer("map",{routePoints:[e[0],e[e.length-1]]})}else if("baidu"===this.service){this.removeLayers();this.routeLayer=new lf.maps.leaflet.BaiduTileLayer("map",{routePoints:e})}this.map.addLayer(this.routeLayer)},visualizeBounds:function(e){this.visualizedBounds&&this.map.removeLayer(this.visualizedBounds);if(e){e=jQuery.makeArray(e);this.visualizedBounds=new L.LayerGroup;var t=this;jQuery.each(e,function(){var e=[this.getLatLng(this.sw),this.getLatLng(this.getNorthWest()),this.getLatLng(this.ne),this.getLatLng(this.getSouthEast()),this.getLatLng(this.sw)],n=new L.Polyline(e,{fillColor:"#ff7800",color:"#000000",opacity:1,weight:2,clickable:!1});t.visualizedBounds.addLayer(n)});this.map.addLayer(this.visualizedBounds)}},centerPointChanged:function(){this.notifyCallbacksForEvent("bounds_changed")},zoomLevelChanged:function(){this.notifyCallbacksForEvent("zoom_changed");this.notifyCallbacksForEvent("bounds_changed")},mapClicked:function(){this.notifyCallbacksForEvent("clicked")},mapLoaded:function(){this.loadedCallback&&this.loadedCallback.call(null,this);this.tilesLoaded()},tilesLoaded:function(){"baidu"!==this.service&&this.notifyCallbacksForEvent("tilesloaded")},notifyCallbacksForEvent:function(e){var t=this.callbacks[e];if(t)for(var n=0;n<t.length;n+=1)t[n].fn()},generateContainerId:function(){lf.maps.leaflet.Map.instanceCount||(lf.maps.leaflet.Map.instanceCount=0);lf.maps.leaflet.Map.instanceCount=lf.maps.leaflet.Map.instanceCount+1;return"lf-leaflet-map-container-"+lf.maps.leaflet.Map.instanceCount.toString()},removeLayers:function(){for(var e=0;Object.keys(this.map._layers).length;e+=1){var t=this.map._layers[Object.keys(this.map._layers)[0]];this.map.removeLayer(t)}}});lf.maps.leaflet.FrontOfficeMarker=Base.extend({constructor:function(e,t){this.callbacks={};this.setPosition(e);this.build(e,t)},setZIndex:function(e){this.marker.setZIndexOffset(e)},getZIndex:function(){return this.marker.options.zIndexOffset},showText:function(e){this.marker.bindPopup(e);this.marker.openPopup()},hideText:function(){this.map&&this.map.map.closePopup()},setMap:function(e){var t=this.map;this.map=e;if(this.marker)if(this.map){t&&t.map.removeLayer(this.marker);this.isVisible&&this.map.map.addLayer(this.marker)}else t&&t.map.removeLayer(this.marker)},setLabel:function(e){this.label=e;if(this.marker){this.marker.options.icon.options.text=e;if(this.marker._icon){var t=jQuery(".leaflet-marker-icon-label",this.marker._icon);t.text(e)}}},setPosition:function(e){this.latlng=new L.LatLng(e.lat,e.lng);this.marker&&this.marker.setLatLng(this.latlng)},getPosition:function(){return this.latlng},setVisible:function(e){if(!this.isVisible&&e){this.map&&this.map.map.addLayer(this.marker);this.isVisible=!0}else if(this.isVisible&&!e){this.map&&this.map.map.removeLayer(this.marker);this.isVisible=!1}},setPositioningMarkerVisible:function(e){this.setVisible(e)},bind:function(e,t,n){"undefined"==typeof this.callbacks[e]&&(this.callbacks[e]=[]);if(2===arguments.length){n=arguments[1];t=null}this.callbacks[e].push([n,t])},build:function(e,t){this.marker=new L.Marker(this.latlng,t);this.marker.pos_url=e.url;this.isVisible=!1;var n=this;this.marker.on("click",function(){n.notifyCallbacksForEvent("click")})},notifyCallbacksForEvent:function(e){var t=this.callbacks[e];if(t)for(var n=0;n<t.length;n+=1)t[n][0].call(null,{data:t[n][1]})}});lf.maps.leaflet.ClusterMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e){var t=new lf.maps.leaflet.ClusterMarker.Icon;t.options.text="x";this.base(e,{icon:t});this.setVisible(!0)},setLabel:function(e){this.base("x "+e)}});lf.maps.leaflet.InactiveClusterMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e,t){var n=new lf.maps.leaflet.InactiveClusterMarker.Icon;n.options.text="x";this.base(e,{icon:n});null!==t&&void 0!==t&&t.addLayer(this.marker);this.setVisible(!0)},setLabel:function(e){this.base("x "+e)}});lf.maps.leaflet.InactiveMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e,t){var n=new lf.maps.leaflet.InactiveMarker.Icon;this.base(e,{icon:n});null!==t&&void 0!==t&&t.addLayer(this.marker);this.setVisible(!1)}});lf.maps.leaflet.NumberMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e,t,n){var i=new lf.maps.leaflet.NumberMarker.Icon;i.options.text=e.toString();this.base(t,{icon:i});null!==n&&void 0!==n&&n.addLayer(this.marker);this.setVisible(!0)}});lf.maps.leaflet.SingleMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e){var t=new lf.maps.leaflet.SingleMarker.Icon;this.base(e,{icon:t});this.setVisible(!0)}});lf.maps.leaflet.DirectionsService=Base.extend({constructor:function(e,t,n,i){this.delegate=e;this.origin=t;this.destination=n;n.lat&&(this.biasPoint=n);i(this)},process:function(){"string"==typeof this.destination&&this.geocode("destination");"string"==typeof this.origin&&this.geocode("origin");this.processIfPossible()},processIfPossible:function(){"string"!=typeof this.origin&&"string"!=typeof this.destination&&this.calculateRoute()},resultMatchesGeolocation:function(e){var t=e.route[0].routeLegs[0].endWaypointLocation;return this.delegate.resultMatchesGeolocation(t.latitude,t.longitude)}});lf.maps.leaflet.DirectionsService.routeForPoint=function(e,t,n,i){var a=jQuery("script#lf_mapping_api").data().lfApiModule;return"tomtom"===a?new lf.maps.leaflet.TomtomDirectionsService(e,t,n,i):"yandex"===a?new lf.maps.leaflet.YandexDirectionsService(e,t,n,i):"baidu"===a?new lf.maps.leaflet.BaiduDirectionsService(e,t,n,i):void 0};lf.maps.leaflet.DirectionsService.routeForAddress=function(e,t,n,i){var a=jQuery("script#lf_mapping_api").data().lfApiModule;return"tomtom"===a?new lf.maps.leaflet.TomtomDirectionsService(e,t,n,i):"yandex"===a?new lf.maps.leaflet.YandexDirectionsService(e,t,n,i):"baidu"===a?new lf.maps.leaflet.BaiduDirectionsService(e,t,n,i):void 0};Class.mixin(lf.maps.leaflet.DirectionsService,Delegatable);lf.maps.leaflet.PolygonLine=Base.extend({constructor:function(e,t){this.setMap(e);this.points=t.points;this.color=t.color;this.line=new L.Polyline(this.pointsToLeaflet(t.points),this.getLeafletOptions());this.map.map.addLayer(this.line)},setMap:function(e){var t=this.map;this.map=e;if(this.line)if(this.map){t&&t.map.removeLayer(this.line);this.map.map.addLayer(this.line)}else t&&t.map.removeLayer(this.line)},getMap:function(){return this.map},setColor:function(e){this.color=e;this.line&&this.line.setStyle(this.getLeafletOptions())},getColor:function(){return this.color},setPoints:function(e){this.points=e;this.line&&this.line.setLatLngs(this.pointsToLeaflet(e))},getPoints:function(){return this.points},getLeafletOptions:function(){return{color:this.colorToRGBString(this.color),opacity:this.color.a,clickable:!1,smoothFactor:!1}},colorToRGBString:function(e){function t(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n}var n=parseInt(255*e.r,10).toString(16),i=parseInt(255*e.g,10).toString(16),a=parseInt(255*e.b,10).toString(16);return sprintf("#%s%s%s",t(n,2),t(i,2),t(a,2))},pointsToLeaflet:function(e){for(var t=[],n=0;n<e.length;n+=1){var i=e[n];t.push(new L.LatLng(i.lat,i.lng))}return t}});!function(){function e(e,t){function n(){return/^[\-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),?\s*[\-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/.test(e)}function i(e,t){return n()?e():t()}function a(){return e.trim().replace(/\s+/g,",")}function o(){return encodeURIComponent(e)}function s(){return i(a,o)}function l(e){return"https://api.map.baidu.com/geocoder/v2/?"+e+"="+s()+"&output=json&ak="+t+"&callback=?"}function r(){return l("location")}function u(){return l("address")}return i(r,u)}lf.maps.leaflet.BaiduDirectionsService=lf.maps.leaflet.DirectionsService.extend({geocode:function(t){var n=jQuery.trim(this[t]),i=lf.maps.leaflet.configuration.apikey,a=e(n,i),o=this;jQuery.getJSON(a,function(e){var n=e.result;if(void 0===n||0===n.length)o.callDelegateMethod("didReceiveFailingDirections",[o]);else{o[t]={lat:n.location.lat,lng:n.location.lng};o.processIfPossible()}})},calculateRoute:function(){var e=[this.origin.lat,this.origin.lng].join(","),t=[this.destination.lat,this.destination.lng].join(","),n=(encodeURIComponent(e+":"+t),lf.maps.leaflet.configuration.apikey),i="https://api.map.baidu.com/direction/v1?origin="+e+"&destination="+t+"&origin_region=中国&destination_region=中国&output=json&ak="+n+"&callback=?",a=this;jQuery.getJSON(i,function(e){var t=e.result;void 0===t||0===t.length?a.callDelegateMethod("didReceiveFailingDirections",[a]):a.callDelegateMethod("didReceiveSuccessfulDirections",[a,a.convertRoute(t)])})},convertRoute:function(e){for(var t=e.routes[0],n=t.steps,i=[],a=[e.origin.originPt,e.destination.destinationPt],o=0;o<n.length;o+=1){var s=n[o];i.push({description:s.instructions,distance:s.distance/1e3})}return{copyrights:"",estimatedDistance:t.distance/1e3,estimatedDuration:t.duration,steps:i,points:a}}})}();lf.maps.leaflet.TomtomDirectionsService=lf.maps.leaflet.DirectionsService.extend({geocode:function(e){var t=jQuery.trim(this[e]);if(0!==t.length){var n="";this.biasPoint&&(n=";biasPoint="+this.biasPoint.lat+","+this.biasPoint.lng);var i=lf.maps.leaflet.configuration.apikey,a="http://lbs.tomtom.com/lbs/services/geocode/1/query/"+encodeURIComponent(t)+"/jsonp/"+i+";language="+I18n.locale+n+"?jsonp=?",o=this;jQuery.getJSON(a,function(t){var n=t.geoResponse;if(n["@count"]>0&&n.geoResult){var i=null;i=1===n["@count"]?n.geoResult:n.geoResult[0];i.latitude||o.callDelegateMethod("didReceiveFailingDirections",[o]);o[e]={lat:i.latitude,lng:i.longitude};o.processIfPossible()}else o.callDelegateMethod("didReceiveFailingDirections",[o])})}else this.callDelegateMethod("didReceiveFailingDirections",[this])},calculateRoute:function(){var e=lf.maps.leaflet.configuration.apikey,t=[this.origin.lat,this.origin.lng].join(","),n=[this.destination.lat,this.destination.lng].join(","),i=encodeURIComponent(t+":"+n),a="http://lbs.tomtom.com/lbs/services/route/1/"+i+"/Quickest/jsonp/"+e+";language="+I18n.locale+";iqRoutes=2;avoidTraffic=true;includeTraffic=true?jsonp=?",o=this;jQuery.getJSON(a,function(e){if(e.route){var t=o.convertRoute(e.route);o.callDelegateMethod("didReceiveSuccessfulDirections",[o,t])}else o.callDelegateMethod("didReceiveFailingDirections",[o])})},convertRoute:function(e){for(var t,n=e.instructions.instruction,i=[],a=[],o=0,s=0;s<n.length;s+=1){t=n[s];i.push({description:[t.text,t.roadName,t.roadNumber].join(" "),distance:t.distanceMeters/1e3-o});o=t.distanceMeters/1e3;a.push({lat:t.point.latitude,lng:t.point.longitude})}a.routeKey=e.summary.routeKey;return{copyrights:"",estimatedDistance:e.summary.totalDistanceMeters/1e3,estimatedDuration:e.summary.totalTimeSeconds,steps:i,points:a}}});lf.maps.leaflet.YandexDirectionsService=lf.maps.leaflet.DirectionsService.extend({geocode:function(e){var t=this;ymaps.geocode(jQuery.trim(this[e])).then(function(n){var i=n.geoObjects.get(0).geometry.getCoordinates();t[e]={lat:i[0],lng:i[1]};t.processIfPossible()},function(){t.callDelegateMethod("didReceiveFailingDirections",[t])})},calculateRoute:function(){this.startPoint=[this.origin.lat,this.origin.lng].join(",");this.endPoint=[this.destination.lat,this.destination.lng].join(",");var e=this;ymaps.route([this.startPoint,this.endPoint],{avoidTrafficJams:!0}).then(function(t){e.callDelegateMethod("didReceiveSuccessfulDirections",[e,e.convertRoute(t)])},function(){e.callDelegateMethod("didReceiveFailingDirections",[e])})},convertRoute:function(e){for(var t=e.getPaths().get(0).getSegments(),n=[],i=[],a=0,o=0;o<t.length;o+=1){a=t[o];n.push({description:[a.getHumanAction(),a.getStreet()].join(" "),distance:a.getLength()/1e3});i.push({lat:a.getCoordinates()[0][0],lng:a.getCoordinates()[0][1]})}return{copyrights:"",estimatedDistance:e.getPaths().get(0).getLength()/1e3,estimatedDuration:e.getPaths().get(0).getTime(),steps:n,points:i,from:this.startPoint,to:this.endPoint}}});lf.maps.mappy.initialize=function(e){e=jQuery.extend({clusterMarker:{},inactiveClusterMarker:{},inactiveMarker:{},numberMarker:{},singleMarker:{}},e);e.posZoomLevel=17;this.loadConfiguration(e);L.Mappy.setClientId(this.configuration.apikey)};lf.maps.mappy.loadConfiguration=function(e){this.configuration={};var t=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},n=null;for(var i in e){n=e[i];if(n&&"object"==typeof n&&/\w+Marker$/.test(i)){var a=this[t(i)];a&&(a.Icon=this.createIconClass(n))}else this.configuration[i]=n}};lf.maps.mappy.createIconClass=function(e){var t={},n=null;for(var i in e){n=e[i];n&&n.hasOwnProperty("x")&&n.hasOwnProperty("y")&&(n=new L.Point(Number(n.x),Number(n.y)));n&&lf_asset_base&&/\w+Url$/.test(i)&&(n=lf_asset_base+n);t[i]=n}return this.LabelIcon.extend({options:t})};lf.maps.mappy.ClusterMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e){var t=new lf.maps.mappy.ClusterMarker.Icon;t.options.text="x";this.base(e,{icon:t});this.setVisible(!0)},setLabel:function(e){this.base("x "+e)}});lf.maps.mappy.DirectionsService=Base.extend({constructor:function(e,t,n,i){this.delegate=e;this.origin=t;this.destination=n;i(this)},process:function(){var e=this,t={vehicle:L.Mappy.Vehicles.comcar,cost:"length",gascost:1,gas:"petrol",nopass:0,notoll:0,caravane:0,infotraffic:0};this.normalizeLocation(this.origin,function(n){e.normalizeLocation(e.destination,function(i){L.Mappy.Services.route([n,i],t,function(t){var n=e.convertResult(t);e.callDelegateMethod("didReceiveSuccessfulDirections",[e,n])},function(){e.callDelegateMethod("didReceiveFailingDirections",[e])})},function(){e.callDelegateMethod("didReceiveFailingDirections",[e])})},function(){e.callDelegateMethod("didReceiveFailingDirections",[e])})},convertResult:function(e){for(var t=e.routes.route[0],n=t.actions.action,i=[],a=[],o=0;o<n.length;o+=1){var s=n[o];a.push({lng:s.x,lat:s.y});i.push({description:s.label,distance:s.meter/1e3})}a.polyline=L.polyline(t["polyline-definition"].polyline);return{estimatedDistance:t.summary.length/1e3,estimatedDuration:t.summary.time,steps:i,points:a}},normalizeLocation:function(e,t,n){"undefined"!=typeof e.lat&&"undefined"!=typeof e.lng?t(e):"string"==typeof e?L.Mappy.Services.geocode(e,function(e){var n=e[0].Point.coordinates.split(",").reverse();t(L.latLng(n))},function(){n()}):n()}});lf.maps.mappy.DirectionsService.routeForPoint=function(e,t,n,i){return new lf.maps.mappy.DirectionsService(e,t,n,i)};lf.maps.mappy.DirectionsService.routeForAddress=function(e,t,n,i){return new lf.maps.mappy.DirectionsService(e,t,n,i)};Class.mixin(lf.maps.mappy.DirectionsService,Delegatable);lf.maps.mappy.InactiveClusterMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e,t){var n=new lf.maps.mappy.InactiveClusterMarker.Icon;n.options.text="x";this.base(e,{icon:n});null!==t&&void 0!==t&&t.addLayer(this.marker);this.setVisible(!0)}});lf.maps.mappy.InactiveMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e,t){var n=new lf.maps.mappy.InactiveMarker.Icon;this.base(e,{icon:n});null!==t&&void 0!==t&&t.addLayer(this.marker);this.setVisible(!1)}});"undefined"!=typeof L&&(lf.maps.mappy.LabelIcon=lf.maps.leaflet.LabelIcon.extend({}));lf.maps.mappy.Map=lf.maps.leaflet.Map.extend({constructor:function(e,t,n){this.root=jQuery(e);var i=this.generateContainerId();this.root.append('<div id="'+i+'"></div>');this.container=jQuery("#"+i,this.root);this.container.width(this.root.innerWidth());this.container.height(this.root.innerHeight());this.loaded=!1;this.loadedCallback=t;this.callbacks={};this.map=new L.Mappy.Map(this.container.attr("id"),jQuery.extend({logoControl:{dir:"/javascripts/mappy/images/"},scrollWheelZoom:!1,zoomControl:!0},n||{}));var a=this;this.map.on("load",function(){a.loaded=!0;a.mapLoaded()});this.map.on("move",function(){a.centerPointChanged()});this.map.on("zoomend",function(){a.zoomLevelChanged()});this.map.on("click",function(){a.mapClicked()});this.map.setView(new L.LatLng(0,0),this.getPointOfSaleZoomLevel())},getPointOfSaleZoomLevel:function(){return lf.maps.mappy.configuration.posZoomLevel},getLatLng:function(e){return new L.LatLng(e.lat,e.lng)},displayRoute:function(e){this.routeLayer&&this.map.removeLayer(this.routeLayer);this.routeLayer=new lf.maps.mappy.PolygonLine(this,{points:e,color:{r:1,g:0,b:1,a:.5}});this.map.addLayer(this.routeLayer)},tilesLoaded:function(){this.notifyCallbacksForEvent("tilesloaded")},generateContainerId:function(){lf.maps.mappy.Map.instanceCount||(lf.maps.mappy.Map.instanceCount=0);lf.maps.mappy.Map.instanceCount=lf.maps.mappy.Map.instanceCount+1;return"lf-mappy-map-container-"+lf.maps.mappy.Map.instanceCount.toString()}});lf.maps.mappy.NumberMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e,t,n){var i=new lf.maps.mappy.NumberMarker.Icon;i.options.text=e.toString();this.base(t,{icon:i});null!==n&&void 0!==n&&n.addLayer(this.marker);this.setVisible(!0)}});lf.maps.mappy.PolygonLine=lf.maps.leaflet.PolygonLine.extend({constructor:function(e,t){this.setMap(e);this.points=t.points;this.color=t.color;this.line=this.points.polyline||new L.Polyline(this.pointsToLeaflet(t.points),this.getLeafletOptions())},onRemove:function(){this.map.map.removeLayer(this.line)},onAdd:function(){this.map.map.addLayer(this.line)}});lf.maps.mappy.SingleMarker=lf.maps.leaflet.FrontOfficeMarker.extend({constructor:function(e){var t=new lf.maps.mappy.SingleMarker.Icon;this.base(e,{icon:t});this.setVisible(!0)}});lf.maps.viamichelin.Map=Base.extend({constructor:function(e,t){this.root=jQuery(e);this.loadedCallback=t;this.callbacks={};var n=this;this.center={lat:0,lng:0};var i=VMLaunch,a={container:e,scrollwheel:!1,zoom:13,mapTypeControlOptions:{type:ViaMichelin.Api.Constants.Map.TYPE.LIGHT}};if(/mobile/i.test(navigator.userAgent)){a.mapToolsControl=!1;a.skin=ViaMichelin.Api.Constants.Map.SKIN.MOBILE.SMALL;a.navigationMode=ViaMichelin.Api.Constants.Map.NAVIGATION.STATIC}i("ViaMichelin.Api.Map",a,{onSuccess:function(e){n.map=e;n.mapLoaded()},onError:function(e){console&&console.error&&console.error(e.errorMsg,e)},onZoomChanged:function(){n.zoomLevelChanged()},onMapCenterChanged:function(){n.centerPointChanged()}})},fitBounds:function(e){var t=e.getNorthWest(),n=e.getSouthEast(),i={};i.no={lat:t.lat,lon:t.lng};i.se={lat:n.lat,lon:n.lng};this.map.drawMap({geoBoundaries:i});this.center=e.getCenterPoint();this.centerPointChanged();this.zoomLevelChanged()},redraw:function(){var e=this.root.width(),t=this.root.height();this.map.resizeTo(e,t);this.root.css({height:"",width:""})},getCenter:function(){return this.center},getZoom:function(){return this.map.getZoomLevel()},getMaxZoom:function(){return 16},getPointOfSaleZoomLevel:function(){return 13},getMaxZIndex:function(){return 1e6},getPixelForLatLng:function(e){var t={lat:e.lat,lon:e.lng},n=this.map.convertGeoToPixel(t);return{x:n.x,y:n.y}},getLatLngForPixel:function(e){var t=this.map.convertPixelToGeo(e);return{lat:t.lat,lng:t.lon}},getViewportBounds:function(){var e=this.map.getSouthWest(),t=this.map.getNorthEast(),n={lat:e.latitude,lng:e.longitude},i={lat:t.latitude,lng:t.longitude};return new lf.maps.Bounds(n,i)},setCenter:function(e){this.center=e;this.map.moveTo({lat:e.lat,lon:e.lng});this.centerPointChanged()},setZoom:function(e){this.map.setZoomLevel(e)},bind:function(e,t){"undefined"==typeof this.callbacks[e]&&(this.callbacks[e]=[]);var n={id:lf.app.uniqueId(),event:e,fn:t};this.callbacks[e].push(n);return n},unbind:function(e){for(var t=this.callbacks[e.event],n=0;n<t.length;n+=1){var i=t[n];if(i.id===e.id){t.splice(n,1);break}}},setActiveMarker:function(e){this.activeMarker=e},getActiveMarker:function(){return this.activeMarker},centerPointChanged:function(){this.notifyCallbacksForEvent("bounds_changed")},zoomLevelChanged:function(){this.notifyCallbacksForEvent("zoom_changed");this.notifyCallbacksForEvent("bounds_changed")},mapLoaded:function(){this.loadedCallback&&this.loadedCallback.call(null,this);this.notifyCallbacksForEvent("tilesloaded")},notifyCallbacksForEvent:function(e){var t=this.callbacks[e];if(t)for(var n=0;n<t.length;n+=1)t[n].fn()}});lf.maps.viamichelin.FrontOfficeMarker=Base.extend({constructor:function(e){this.callbacks={};this.isAdded=!1;this.marker=new ViaMichelin.Api.Map.Marker(this.getMarkerSettings(e));this.setPosition(e);var t=this;this.marker.addEventListener("onClick",function(){t.markerClicked()})},setZIndex:function(e){this.marker.setZindex(e)},getZIndex:function(){return this.marker.getZindex()},showText:function(e){if(this.bubbleId){var t='<span class="lf_mapbubble_text">'+e+"</span>";this.marker.setBubbleContent(t)}},hideText:function(){this.bubbleId&&this.marker.closeExpandLayer()},setMap:function(e){if(this.map!==e){this.isAdded&&this.detachMarker();this.map=e;this.map&&this.attachMarker()}},setLabel:function(e){this.labelText=e;if(this.marker&&this.labelText)if(this.labelId)jQuery("#"+this.labelId).html(this.labelText);else{this.labelId=lf.app.uniqueId();this.marker.setOverlayText("<span id='"+this.labelId+"'>"+this.labelText+"</span>")}},setPosition:function(e){this.position=e;this.marker&&this.marker.setPosition({lat:e.lat,lon:e.lng})},getPosition:function(){return this.position},setVisible:function(e){this.marker&&this.marker.setVisibility(e)},setPositioningMarkerVisible:function(){},bind:function(e,t,n){"undefined"==typeof this.callbacks[e]&&(this.callbacks[e]=[]);if(2===arguments.length){n=arguments[1];t=null}this.callbacks[e].push([n,t])},hasEventHandler:function(e){return"undefined"!=typeof this.callbacks[e]&&this.callbacks[e].length>0},getMarkerSettings:function(e){var t=Class.duplicate(this.getSettingsObject());t.overlayText.text="";return{coords:{lat:e.lat,lon:e.lng},icon:t.icon,size:t.size,overlayText:t.overlayText,visibility:!0}},markerClicked:function(){this.notifyCallbacksForEvent("click")},bubbleOpened:function(){var e=jQuery("#"+this.bubbleId);e.html(this.bubbleText);e.closest(".sMapBubble").parent("div").css("z-index",this.getZIndex())},notifyCallbacksForEvent:function(e){var t=this.callbacks[e];if(t)for(var n=0;n<t.length;n+=1)t[n][0].call(null,{data:t[n][1]})},attachMarker:function(){this.map.map.addLayer(this.marker);this.isAdded=!0},detachMarker:function(){this.map&&this.map.map.removeLayer(this.marker);this.isAdded=!1}});lf.maps.viamichelin.ClusterMarker=lf.maps.viamichelin.FrontOfficeMarker.extend({constructor:function(e){this.base(e)},setLabel:function(e){this.base("x "+e)},getSettingsObject:function(){return lf_viamichelin_settings.clusterMarker}});lf.maps.viamichelin.InactiveClusterMarker=lf.maps.viamichelin.FrontOfficeMarker.extend({constructor:function(e){this.base(e)},setLabel:function(e){this.base("x "+e)},getSettingsObject:function(){return lf_viamichelin_settings.inactiveClusterMarker}});lf.maps.viamichelin.InactiveMarker=lf.maps.viamichelin.FrontOfficeMarker.extend({constructor:function(e){this.base(e)},getMarkerSettings:function(e){var t=this.base(e);this.bubbleId=lf.app.uniqueId();this.bubbleText="";t.htm="<div id='"+this.bubbleId+"' style='width:250px;'></div>";return t},getSettingsObject:function(){return lf_viamichelin_settings.inactiveMarker}});lf.maps.viamichelin.NumberMarker=lf.maps.viamichelin.FrontOfficeMarker.extend({constructor:function(e,t){this.base(t);this.number=e;this.setLabel(e)},getMarkerSettings:function(e){var t=this.base(e);this.bubbleId=lf.app.uniqueId();this.bubbleText="";t.htm="<div id='"+this.bubbleId+"' class='lf_mapbubble_text'></div>";return t},getSettingsObject:function(){return lf_viamichelin_settings.numberMarker
}});lf.maps.viamichelin.SingleMarker=lf.maps.viamichelin.FrontOfficeMarker.extend({constructor:function(e){this.base(e)},getSettingsObject:function(){return lf_viamichelin_settings.singleMarker}});lf.maps.viamichelin.DirectionsService=Base.extend({constructor:function(e,t,n,i){this.delegate=e;this.origin=t;this.destination=n;i(this)},process:function(){"string"==typeof this.destination&&this.geocode("destination");"string"==typeof this.origin&&this.geocode("origin");this.processIfPossible()},processDirections:function(){var e=this,t=this.origin,n=this.destination,i=VMLaunch;i("ViaMichelin.Api.Itinerary",{steps:[{coords:t},{coords:n}],distUnit:ViaMichelin.Api.Constants.Itinerary.DIST_UNIT.METERS},{onSuccess:function(t){var n=e.convertResponse(t);e.callDelegateMethod("didReceiveSuccessfulDirections",[e,n])},onInitError:function(t,n){console&&console.error&&console.error("viamichelin init error:",n);e.callDelegateMethod("didReceiveFailingDirections",[e])},onError:function(t,n){console&&console.error&&console.error("viamichelin error:",n);e.callDelegateMethod("didReceiveFailingDirections",[e])}})},processIfPossible:function(){"string"!=typeof this.origin&&"string"!=typeof this.destination&&this.processDirections()},convertResponse:function(e){function t(e,n){if(n.details.length>0)for(var i=0;i<n.details.length;i+=1)t(e,n.details[i]);else if("string"==typeof n.description&&n.description.length>0){var a={description:n.description},o=n.partialDistance.match(/(\d|\.|\,)+/g);o&&(a.distance=parseFloat(o[0].replace(",","")));e.steps.push(a)}}var n={};n.copyrights="";n.estimatedDistance=parseFloat(e.header.summaries[0].totalDist)/1e3;n.estimatedDuration=parseInt(e.header.summaries[0].totalTime,10);n.steps=[];n.points=[];for(var i=0;i<e.roadSheet.steps.length;i+=1)t(n,e.roadSheet.steps[i]);for(var a=e.getLayer().layers[0].getPath(),o=0;o<a.length;o+=1)n.points.push({lat:a[o].lat,lng:a[o].lon});return n},geocode:function(e){var t=this,n=VMLaunch;n("ViaMichelin.Api.Geocoding",{singleFieldSearch:t[e]},{onSuccess:function(n){n.length?t[e]=n[0].coords:t.callDelegateMethod("didReceiveFailingDirections",[t]);t.processIfPossible()},onError:function(){t.callDelegateMethod("didReceiveFailingDirections",[t])}})}},{routeForPoint:function(e,t,n,i){return new lf.maps.viamichelin.DirectionsService(e,t,n,i)},routeForAddress:function(e,t,n,i){return new lf.maps.viamichelin.DirectionsService(e,t,n,i)}});Class.mixin(lf.maps.viamichelin.DirectionsService,Delegatable);lfLoadGoogleApiForViamichelin=function(){lfLoadGoogleApiForViamichelin.loaded=!0;for(var e=0;e<lfLoadGoogleApiForViamichelin.callbacks.length;e+=1)lfLoadGoogleApiForViamichelin.callbacks[e].call();lfLoadGoogleApiForViamichelin.callbacks=[]};lfLoadGoogleApiForViamichelin.loaded=!1;lfLoadGoogleApiForViamichelin.callbacks=[];lf.maps.viamichelin.PolygonLine=Base.extend({constructor:function(e,t){this.line=new ViaMichelin.Api.Map.PolyLine({strokeWeight:5,strokeColor:"#0000FF",strokeOpacity:.5,coords:this.pointsToViaMichelin(t.points)});this.setColor(t.color||{r:0,g:0,b:1,a:.75});this.setMap(e)},setMap:function(e){this.map=e;this.line&&(this.map?this.map.map.addLayer(this.line):this.map.map.removeLayer(this.line))},getMap:function(){return this.map},setColor:function(e){this.color=e;if(this.line){this.line.setStrokeColor(this.getRGBString());this.line.setStrokeOpacity(this.color.a)}},getColor:function(){return this.color},setPoints:function(e){this.points=e;this.line&&this.line.setPath(this.pointsToViaMichelin(e))},getPoints:function(){return this.points},getRGBString:function(){function e(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n}var t=parseInt(255*this.color.r,10).toString(16),n=parseInt(255*this.color.g,10).toString(16),i=parseInt(255*this.color.b,10).toString(16);return sprintf("#%s%s%s",e(t,2),e(n,2),e(i,2))},pointsToViaMichelin:function(e){for(var t=[],n=0;n<e.length;n+=1){var i=e[n];t.push({lat:i.lat,lon:i.lng})}return t}});DrivingDirectionsPopup=function(e){this.root=e;this.distanceUnit="km";this.from=e.find('input[name="lf_ddfrom"]');this.posAddress=e.find("#lf_ddto address");this.calculateButton=e.find("#lf_ddcalculate button, #lf_ddcalculate a");this.resultsDiv=e.find("#lf_ddresults");this.directionsList=e.find("#lf_ddroutesteps");this.originText=e.find("#lf_ddorigin");this.estimate=e.find("#lf_ddestimate");this.mapDiv=e.find("#lf_ddmap");this.mapCopyright=e.find("#lf_ddcopyright");this.printButton=e.find("#lf_ddprint");this.closeButton=e.find("#lf_ddclose");this.map=null;this.mapOriginMarker=null;this.mapDestinationMarker=null;this.mapRouteLine=null;var t=this;this.from.keypress(function(e){if(13===e.which){t.from.blur();t.calculateButton.focus().click()}});this.calculateButton.bind("click",function(){t.processRequest()});this.closeButton.bind("click",function(){t.hide()});this.printButton.bind("click",function(){t.root.printElement({printMode:"popup",leaveOpen:!0})});jQuery(window).bind("resize",function(){t.reposition()}).trigger("resize")};DrivingDirectionsPopup.sharedInstance=function(){if(!DrivingDirectionsPopup.__sharedInstance){var e=jQuery("#lf_drivingdirections");if(0===e.length)throw new Error("#lf_drivingdirections is not present");DrivingDirectionsPopup.__sharedInstance=new DrivingDirectionsPopup(e)}return DrivingDirectionsPopup.__sharedInstance};DrivingDirectionsPopup.prototype.reposition=function(){var e=jQuery(window).width()/2-this.root.width()/2;this.root.css({left:e})};DrivingDirectionsPopup.prototype.show=function(){this.root.show();this.root.trigger("shown")};DrivingDirectionsPopup.prototype.hide=function(){this.root.hide();this.root.trigger("hidden")};DrivingDirectionsPopup.prototype.bind=function(){this.root.bind.apply(this.root,arguments)};DrivingDirectionsPopup.prototype.unbind=function(){this.root.unbind.apply(this.root,arguments)};DrivingDirectionsPopup.prototype.print=function(){this.root.printElement({printMode:"popup",leaveOpen:!0})};DrivingDirectionsPopup.prototype.getPointOfSaleAddress=function(){return this.posAddress.text().replace(/^\s+/g,"").replace(/\s+jQuery/g,"").replace(/[\n\t]/g,"")};DrivingDirectionsPopup.prototype.processRequest=function(){if(""!==this.from.val().replace(/\s/g,"")){this.geocodingAttempt=null;this.estimate.empty();this.directionsList.empty();this.setStartAddressText(this.from.val());this.showResults();var e=lf.app.getApiModule(),t=this;this.map?t.processRequestUsingAddress():this.map=new e.Map(this.mapDiv[0],function(e){e.setCenter(posMarkerCoordinates);t.processRequestUsingAddress();jQuery(t.mapDiv[0]).trigger("lf.mapReady",[e])})}else{window.alert(I18n.translate("frontoffice.pos.directions.empty_field_error"));this.from.focus()}};DrivingDirectionsPopup.prototype.processRequestUsingAddress=function(){var e=lf.app.getApiModule(),t=this.from.val(),n=this.getPointOfSaleAddress();this.geocodingAttempt="address";e.DirectionsService.routeForAddress(this,t,n,function(e){e.process()})};DrivingDirectionsPopup.prototype.processRequestUsingLatLng=function(){var e=lf.app.getApiModule(),t=this.from.val(),n=posMarkerCoordinates;this.geocodingAttempt="latlng";e.DirectionsService.routeForPoint(this,t,n,function(e){e.process()})};DrivingDirectionsPopup.prototype.resultMatchesGeolocation=function(e,t){if("latlng"===this.geocodingAttempt)return!0;var n=69.1*(e-posMarkerCoordinates.lat),i=53*(t-posMarkerCoordinates.lng),a=Math.sqrt(n*n+i*i);return.0622>a};DrivingDirectionsPopup.prototype.didReceiveFailingDirections=function(){if("address"===this.geocodingAttempt)this.processRequestUsingLatLng();else{this.hideResults();window.alert(I18n.translate("frontoffice.pos.directions.calculate_error"))}};DrivingDirectionsPopup.prototype.didReceiveSuccessfulDirections=function(e,t){this.showResults();this.setCopyrightText(t.copyrights);this.setEstimateText(sprintf("%s (%s)",this.distanceString(this.convertDistanceForDisplay(t.estimatedDistance),this.distanceUnit),this.durationString(t.estimatedDuration)));this.setDirectionsList(t.steps);this.showResults();this.displayRoute(t.points)};DrivingDirectionsPopup.prototype.setDistanceUnit=function(e){this.distanceUnit=e};DrivingDirectionsPopup.prototype.hideResults=function(){this.resultsDiv.hide()};DrivingDirectionsPopup.prototype.showResults=function(){this.resultsDiv.show()};DrivingDirectionsPopup.prototype.setDirectionsList=function(e){this.directionsList.empty();for(var t=0;t<e.length;t+=1){var n=e[t],i=jQuery("<li/>").appendTo(this.directionsList);jQuery("<div/>").addClass("lf_ddstepdescription").html(n.description).appendTo(i);n.distance&&jQuery("<div/>").addClass("lf_ddstepdistance").html(this.distanceString(this.convertDistanceForDisplay(n.distance),this.distanceUnit)).appendTo(i)}};DrivingDirectionsPopup.prototype.setCopyrightText=function(e){this.mapCopyright.html(e)};DrivingDirectionsPopup.prototype.durationString=function(e){var t=60,n=60*t,i=Math.floor(e/n),a=e%n,o=Math.round(a/t);return 0===i?[o,I18n.pluralize(o,"frontoffice.datetime.minute")].join(" "):[i,I18n.pluralize(i,"frontoffice.datetime.hour"),o,I18n.pluralize(o,"frontoffice.datetime.minute")].join(" ")};DrivingDirectionsPopup.prototype.convertDistanceForDisplay=function(e){var t=e;"mi"===this.distanceUnit&&(t=.621371192*e);return t};DrivingDirectionsPopup.prototype.distanceString=function(e,t,n){var i=null;i=n?Math.round(parseFloat(e)):parseFloat(e).toFixed(1);return[i.toString().replace(/\.0$/,""),t].join(" ")};DrivingDirectionsPopup.prototype.setEstimateText=function(e){this.estimate.html(e)};DrivingDirectionsPopup.prototype.setStartAddressText=function(e){var t=jQuery("<div/>").text(e).html();this.originText.html(t)};DrivingDirectionsPopup.prototype.mapIsLoaded=function(){return null!==this.map};DrivingDirectionsPopup.prototype.displayRoute=function(e){for(var t=new lf.maps.Bounds(e[0],e[0]),n=1;n<e.length;n+=1)t.extend(e[n]);var i=e[0],a=e[e.length-1];if(this.mapOriginMarker){this.mapOriginMarker.setPosition(i);this.mapDestinationMarker.setPosition(a);this.map.displayRoute?this.map.displayRoute(e):this.mapRouteLine.setPoints(e)}else{var o=lf.app.getApiModule();this.mapOriginMarker=new o.NumberMarker("A",i);this.mapOriginMarker.setMap(this.map);this.mapDestinationMarker=new o.NumberMarker("B",a);this.mapDestinationMarker.setMap(this.map);this.map.displayRoute?this.map.displayRoute(e):this.mapRouteLine=new o.PolygonLine(this.map,{points:e,color:{r:0,g:0,b:1,a:.5}})}this.map.fitBounds(t,null,15)};jQuery(document).ready(function(){jQuery(document).on("click","*[data-bind='driving_directions_show']",function(e){e.preventDefault();var t=jQuery(this).data("distance-unit");"undefined"!=typeof t&&DrivingDirectionsPopup.sharedInstance().setDistanceUnit(t);gui.Backdrop.sharedInstance().showWithoutIndicator(250);DrivingDirectionsPopup.sharedInstance().show();jQuery(window).scrollTop(0);var n=function(){gui.Backdrop.sharedInstance().hide(250);DrivingDirectionsPopup.sharedInstance().unbind("hidden",n)};DrivingDirectionsPopup.sharedInstance().bind("hidden",n);return!1})});lf.ListMap=Base.extend({constructor:function(e){this.markers={};this.markersByIndex={};this.canvas=e;this.activeMarkers=[];this.inactiveMarkers=[];this.showInactiveMarkers=!0;"undefined"!=typeof show_inactive_markers&&(this.showInactiveMarkers=show_inactive_markers);this.useAggressiveMarkerClustering=!0;"undefined"!=typeof use_aggressive_marker_clustering&&(this.useAggressiveMarkerClustering=use_aggressive_marker_clustering);var t=this,n=lf.app.getApiModule();new n.Map(e,function(n){t.map=n;t.mapWasLoaded(n);jQuery(e).trigger("lf.mapReady",[n])})},loadActiveMarkers:function(e){this.activeMarkers=e;this.activeClusterer.clearMarkers();this.activeClusterer.addMarkers(e,!0)},filterMarkers:function(e){var t=[];jQuery.each(lf.app.listMap.activeMarkers,function(n,i){e(i)&&t.push(i)});this.loadActiveMarkers(t)},mapWasLoaded:function(e){var t=lf.app.getApiModule(),n=e.getPointOfSaleZoomLevel()-1;this.activeClusterer=new lf.maps.MarkerClusterer(e,t.ClusterMarker);this.activeClusterer.setMaxZoom(this.useAggressiveMarkerClustering?n:7);this.inactiveClusterer=new lf.maps.MarkerClusterer(e,t.InactiveClusterMarker);this.inactiveClusterer.setMaxZoom(n);this.buildMarkers();this.bindMarkerEvents();this.inactiveClusterer.redraw();this.activeClusterer.redraw();e.fitBounds(this.activeClusterer.getMarkerBounds(),16);this.fixViaMichelinMarkers()},bindMarkerEvents:function(){for(var e,t=this,n=function(e){t.showMarkerInfo(e.data)},i=0;i<this.activeMarkers.length;i+=1){e=this.activeMarkers[i];e.bind("click",e,n)}for(var a=0;a<this.inactiveMarkers.length;a+=1){e=this.inactiveMarkers[a];e.bind("click",e,n)}},buildMarkers:function(){var e=this,t=lf.app.getApiModule(),n={};jQuery.each(app.front_office.countries,function(e,t){jQuery.extend(n,app.front_office.points_of_sale[t])});var i=null;"baidu"===this.map.service&&(i=this.map.map);jQuery.each(active_markers,function(a,o){var s=n[o];if("undefined"!=typeof s){s.url||(s.url=o.toString());var l=new t.NumberMarker(a+1,s,i);e.useAggressiveMarkerClustering||l.setZIndex(e.map.getMaxZIndex()-a);l.pos_id=o;e.activeClusterer.addMarker(l,!0);e.markers[o]=l;e.markersByIndex[a+1]=l;e.activeMarkers.push(l)}});this.showInactiveMarkers&&jQuery.each(n,function(a){if(!e.markers[a]){var o=n[a],s=new t.InactiveMarker(o,i);s.pos_id=a;e.inactiveClusterer.addMarker(s,!0);e.markers[a]=s;e.inactiveMarkers.push(s)}})},closeOpenMarkers:function(){for(var e=function(e){if(e.isOpen){e.hideText();e.isOpen=!1;e.initialZIndex&&e.setZIndex(e.initialZIndex)}},t=0;t<this.activeMarkers.length;t+=1)e(this.activeMarkers[t]);for(var n=0;n<this.inactiveMarkers.length;n+=1)e(this.inactiveMarkers[n])},getErrorText:function(){return'<b style="color:red">'+I18n.translate("frontoffice.maps.info_window.loading_error")+"</b>"},getLoadingText:function(){return"<b>"+I18n.translate("frontoffice.maps.info_window.loading_info")+"</b>"},showMarkerInfo:function(e){this.closeOpenMarkers();var t=this,n=function(){t.map.setCenter(e.getPosition());e.setMap(t.map);e.setVisible(!0);if(!t.useAggressiveMarkerClustering){e.initialZIndex=e.getZIndex();e.setZIndex(t.map.getMaxZIndex())}e.showText(t.getLoadingText());e.isOpen=!0;jQuery.ajax({url:"/popup/"+e.pos_id,dataType:"text",success:function(t){e.showText(t)},error:function(){e.showText(t.getLoadingText())}})},i=this.map.getPointOfSaleZoomLevel();if(this.map.getZoom()<i){var a=this.map.bind("zoom_changed",function(){t.map.unbind(a);n()});this.map.setZoom(i)}else n();jQuery(this.canvas).trigger("lf.markerInfoShown",[e])},showMarkerByIndex:function(e){this.markersByIndex[e]&&this.showMarkerInfo(this.markersByIndex[e])},setPositioningMarkerVisible:function(e){this.inactiveClusterer.setPositioningMarkerVisible(e);this.activeClusterer.setPositioningMarkerVisible(e)},fixViaMichelinMarkers:function(){if("undefined"!=typeof VMLaunch)var e=this,t=window.setInterval(function(){if(e.activeClusterer.hasPlottedMarkers)window.clearInterval(t);else{e.inactiveClusterer.redraw();e.activeClusterer.redraw()}},300)}});lf.TabArray=Base.extend({constructor:function(e){this.root=jQuery(e);var t=this,n=parseUri(window.location.href),i={};this.root.find("a").each(function(){var e=parseUri(this.href);if(e.anchor){i[e.anchor]=this;jQuery.data(this,"lf_tab_content_selector","#"+e.anchor)}e.path===n.path&&jQuery(this).click(function(e){e.preventDefault();t.activateLocalTab(this)})});this.root.find("a:not(.active)").each(function(){jQuery(jQuery.data(this,"lf_tab_content_selector")).hide()});var a=i[n.anchor];if(a){t.activateLocalTab(a);window.location.hash="";window.scrollTo(0,0)}},activateLocalTab:function(e){this.root.find("a.active").each(function(){jQuery(this).removeClass("active");jQuery(jQuery.data(this,"lf_tab_content_selector")).hide()});jQuery(e).addClass("active");jQuery(jQuery.data(e,"lf_tab_content_selector")).each(function(){jQuery(this).show();if(jQuery(this).find("#lf_accessmap_canvas").length&&lf.app.accessMap){lf.app.accessMap.redraw();lf.app.accessMap.setCenter(posMarkerCoordinates)}})}});lf.SearchForm=Base.extend({constructor:function(e){this.root=jQuery(e);this.form=this.root.find("form");this.queryField=this.form.find("#query");this.queryError=this.root.find(".search_error");this.querySubmit=this.form.find(".submit");this.isInitialQuery=!0;this.initialQueryValue=this.queryField.val();this.selector=this.form.find("select[class=redirects]");var t=this;this.queryField.bind("focusin",function(){if(t.isInitialQuery){t.isInitialQuery=!1;t.queryField.val("")}});this.queryField.bind("focusout",function(){if(0===t.queryField.val().replace(/^\s+/,"").replace(/\s+$/,"").length){t.isInitialQuery=!0;t.queryField.val(t.initialQueryValue)}});this.queryField.bind("keyUp",function(){t.validateQuery()});this.form.bind("submit",function(){if(!t.validateQuery()){t.queryError.show();return!1}return!0});this.selector.bind("change",function(){t.checkForRedirect()})},validateQuery:function(){return""===this.queryField.val().replace(/^\s+/,"").replace(/\s+$/,"")?!1:!0},checkForRedirect:function(){if(this.selector.val()){this.selector.attr("disabled",!0);window.location=this.selector.val()}},comparator:function(e,t){return e.postal_code===t.postal_code?e.name<t.name?-1:1:e.postal_code<t.postal_code?-1:1},populateSelectorFromData:function(e){this.selector.empty();jQuery("<option/>").html(app.front_office.select).appendTo(this.selector);var t=[];jQuery.each(e,function(e){t.push(e)});var n=this;jQuery.each(t.sort(),function(i,a){var o=n.selector;t.length>1&&(o=jQuery("<optgroup/>").html(a).attr("label",a).appendTo(o));var s=[];jQuery.each(e[a],function(e,t){s.push(t)});jQuery.each(s.sort(n.comparator),function(e,t){if(t.pos_type_has_page===!0||"t"===t.pos_type_has_page){var n=t.postal_code+" - "+t.name,i="/"+t.url;jQuery("<option/>").html(n).attr("value",i).appendTo(o)}})})}});lf.AjaxSubmissionForm=Base.extend({constructor:function(e){this.root=jQuery(e);this.submitButton=this.root.find(":submit");this.spinner=jQuery("<span class='loading'><img width='20' height='20' src='/shared/images/loading.gif' alt='loading'></span>").hide().insertAfter(this.submitButton);this.successRequest=this.root.find(".success_request").hide();this.errorRequest=this.root.find(".errors_request").hide();this.root.find("div.error").hide();var t=this;this.root.bind("submit",function(){t.submit();return!1})},reset:function(){this.root[0].reset()},submit:function(){this.successRequest.hide();this.errorRequest.hide();this.submitButton.addClass("loading").attr("disabled",!0);this.spinner.show();var e=this;jQuery.ajax({url:this.root.attr("action"),type:"POST",data:this.root.serialize(),dataType:"json",success:function(t,n,i){e.done(t,n,i)},complete:function(t){202===t.status?e.displayVerificationChallenge(t.getResponseHeader("Location")):404===t.status&&window.location.reload()}})},done:function(e){var t=this;this.successRequest.empty();this.errorRequest.empty();this.root.find("div.error").empty();e&&e.redirect_to&&(window.location=e.redirect_to);if(e&&e.notice){this.successRequest.html(e.notice).show();this.reset();setTimeout(function(){t.successRequest.fadeOut(1e3)},1e4)}e&&e.warning?this.errorRequest.html(e.warning).show():this.root.trigger("lf.ajax_form_completed");e&&e.errors&&jQuery.each(e.errors,function(e,n){var i=jQuery(document.createElement("ul"));jQuery.each(n,function(e,t){jQuery("<li>"+t+"</li>").appendTo(i)});t.root.find("div."+e+"_errors").html(i).show()});this.submitButton.removeClass("loading").attr("disabled",!1);this.spinner.hide()},displayVerificationChallenge:function(e){var t=this,n='<div style="width: 600px; height: 300px; padding: 0px; margin: 0px; border: none; background: transparent;"><iframe id="lf_css_buster" src="'+e+'" type="text/html" width="100%" height="100%" frameborder="0"></iframe></div>';jQuery.blockUI({message:n,css:{border:"none",padding:"0",background:"transparent",width:"600px",height:"300px",top:"150px",left:(jQuery(window).width()-600)/2+"px"}});jQuery(document).one("lf.ham_verification.success",function(e,n){jQuery.unblockUI();t.done(n)}).one("lf.ham_verification.cancel",function(){jQuery.unblockUI();t.done()})}});lf.ProductSearchForm=Base.extend({constructor:function(e){this.root=jQuery(e);this.initialState=this.root.html();this.loading=!1;this.cascadingChanges=!1;var t=this;this.root.on("change","select",function(){t.loadResults(t.buildFilterURL())});this.root.on("change",":checkbox",function(){if(!t.cascadingChanges){t.cascadingChanges=!0;var e=jQuery(this);t.root.find("input[name="+e.attr("name")+"]:checked").not(e).attr("checked",!1);t.loadResults(t.buildFilterURL())}}).on("doneLoading",function(){t.cascadingChanges=!1});this.root.on("click","#pagination a",function(e){e.preventDefault();t.loadResults(jQuery(this).attr("href"))});this.root.on("submit",function(e){e.preventDefault();t.loadResults(t.buildFilterURL())});window.addEventListener("popstate",jQuery.proxy(this.handleBackButton,this))},displayResults:function(e){this.root.html(e)},loadResults:function(e){if(!this.loading){this.loading=!0;this.root.trigger("loading");var t=this,n=[e,e.indexOf("?")>=0?"&":"?","ajax=1"].join("");jQuery.ajax({url:n}).done(function(n){var i=jQuery(n).html();t.displayResults(i);window.history.pushState&&window.history.pushState(i,null,e)}).complete(function(){t.loading=!1;t.root.trigger("doneLoading")})}},buildFilterURL:function(){var e=this.root.find("form"),t=[e.attr("action").split("?")[0],e.serialize()].join("?");return t},handleBackButton:function(e){this.displayResults(e.state||this.initialState)}});LFListMapScroller=function(e){this.init(e)};jQuery.extend(LFListMapScroller.prototype,{init:function(e){this.resultsCol=jQuery(e.resultsCol||".lf_column1");this.map=jQuery(e.map||"#lf_listmap");this.canvas=jQuery(e.canvas||"#lf_listmap_canvas");this.mapCol=jQuery(e.mapCol||".lf_column2");this.sizeButton=jQuery(e.sizeButton||"#lf_enlargemap");this.legendButton=jQuery(e.legendButton||"#lf_showlegend");this.legend=jQuery(e.legend||"#lf_listmaplegend").hide();this.legendClose=jQuery(e.legend||"#lf_listmaplegend > span");this.mapButtons=jQuery(e.mapButtons||"#lf_listmap_buttons");this.results=e.results?jQuery(e.results):jQuery("#lf_results2").length>0?jQuery("#lf_results2"):jQuery("#lf_results");this.wide=!1;this.scrollTarget=this.map;var t=this;this.sizeButton.bind("click",function(){t.toggleSize();return!1});this.legendButton.bind("click",function(){t.toggleLegend();return!1});this.legendClose.bind("click",function(){t.closeLegend();return!1});jQuery(window).bind("scroll",function(){t.userScrolled()});this.spacer=jQuery('<div id="spacer" style="height:0"></li>');this.map.before(this.spacer)},closeLegend:function(){this.legend.hide()},toggleLegend:function(){if(this.legend.is(":visible")){this.closeLegend();this.legendButton.html(I18n.translate("frontoffice.maps.links.legend.show"))}else{this.legend.show();this.legendButton.html(I18n.translate("frontoffice.maps.links.legend.hide"))}this.userScrolled()},toggleSize:function(){var e;lf.app.listMap&&(e=lf.app.listMap.map.getCenter());this.mapCol.toggleClass("wide");this.resultsCol.toggleClass("wide");if(this.mapCol.hasClass("wide")){this.wide=!0;this.sizeButton.html(I18n.translate("frontoffice.maps.links.map.shrink"));this.sizeButton.toggleClass("close");this.spacer.css("height",0)}else{this.wide=!1;this.sizeButton.html(I18n.translate("frontoffice.maps.links.map.increase"));this.sizeButton.toggleClass("close")}if(lf.app.listMap){lf.app.listMap.map.redraw();lf.app.listMap.map.setCenter(e)}this.userScrolled()},userScrolled:function(){if(!this.wide){{var e,t=(this.map.offset().top,parseInt(this.map.innerHeight(),10)),n=this.results.offset().top,i=parseInt(this.results.innerHeight(),10),a=jQuery(window).scrollTop();jQuery(window).height()}if(a>n){e=a-n+10;e+t>i&&(e=i-t)}else e=0;jQuery("#lf_listmap_legend").html("offset:"+e+", mapHeight:"+t+", resultsHeight:"+i);this.spacer.animate({height:e},{duration:500,easing:"easeOutQuint",queue:!1})}}});jQuery(document).ready(function(){"undefined"==typeof lf_asset_base&&(lf_asset_base="");if("undefined"==typeof lf_viamichelin_settings){lf_viamichelin_settings={};lf_viamichelin_settings.numberMarker={icon:{url:lf_asset_base+"/images/markers/active_number.png",offsetX:0,offsetY:0},size:{width:36,height:44},overlayText:{offsetX:0,offsetY:0,style:{color:"#FFD900",fontSize:"11pt",lineHeight:"52px",textAlign:"center",width:"36px",height:"44px"}}};lf_viamichelin_settings.inactiveMarker={icon:{url:lf_asset_base+"/images/markers/inactive_number.png",offsetX:0,offsetY:0},size:{width:36,height:44},overlayText:{offsetX:0,offsetY:0,style:{color:"#FFD900",fontSize:"11pt",lineHeight:"52px",textAlign:"center",width:"36px",height:"44px"}}};lf_viamichelin_settings.clusterMarker={icon:{url:lf_asset_base+"/images/markers/active_cluster.png",offsetX:0,offsetY:0},size:{width:47,height:53},overlayText:{offsetX:0,offsetY:0,style:{color:"#FFD900",fontSize:"11pt",lineHeight:"52px",textAlign:"center",width:"47px",height:"53px"}}};lf_viamichelin_settings.inactiveClusterMarker={icon:{url:lf_asset_base+"/images/markers/inactive_cluster.png",offsetX:0,offsetY:0},size:{width:47,height:53},overlayText:{offsetX:0,offsetY:0,style:{color:"#FFD900",fontSize:"11pt",lineHeight:"52px",textAlign:"center",width:"47px",height:"53px"}}};lf_viamichelin_settings.singleMarker={icon:{url:lf_asset_base+"/images/markers/marker.png",offsetX:0,offsetY:0},size:{width:51,height:47},overlayText:{offsetX:0,offsetY:0,style:{color:"#FFD900",fontSize:"11pt",lineHeight:"52px",textAlign:"center",width:"51px",height:"47px"}}}}});var app={};jQuery(document).ready(function(){initializeFormObjects();jQuery("#lf_postabs").each(function(){lf.app.tabs=new lf.TabArray(this)});jQuery(".lf_event a").click(function(){if(jQuery(this).data("new_window")){window.open(jQuery(this).attr("href"));return!1}});jQuery("body.print #lf_printbutton a").bind("click",function(){window.print();return!1});detectCountry(jQuery("#lf_search, #lf_search2"));jQuery(window).load(function(){initializeAppDependentObjects();initializePointsOfSaleJSON();jQuery.getJSON("/javascripts/translations.json",function(e){I18n.translations=e});I18n.locale=0===jQuery("html[lang]").length?"fr":jQuery("html").attr("lang")||jQuery("html").attr("xml:lang");if(jQuery("#lf_openinghours").length){var e=(new Date).getDay()||7,t=jQuery(".lf_openinghoursdays .lf_days > li:nth-child("+e+")");t.length&&t.addClass("today")}if(jQuery("#lf_listmap").length){new LFListMapScroller({})}})});