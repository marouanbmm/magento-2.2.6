/////////////////////////////////////
// watchBox.js
// by loic TCHING
// on 2018.10.29
// v4.15.4
/////////////////////////////////////
var CDN="https://backoffice.targetfirst.com/bo/cobrowsing",getnode="https://prod-nlb.watcheebox.net/getnode",sioSrvRoot="https://"+window._wz_lb.host;function afficheSysMessage(e,t){t?console.log(e+t):console.log(e)}var agentSelected,WatcheezyIDAgentSelected,WatcheezyDeviceAgentSelected,agentNameSelected,enConversationAvecAgent,selectAgentNotification,languageNav,cobrowsingNameAgent,cobrowsingJobAgent,mySocketID="",roomName=wek,siteId=sitId,entrepriseId=entId,multiUrl=mUrl,uniqueAutoinvit=0,invitationReceived="",auteur="Visiteur",cookieAgentId="",agents=[],socket=null,VisWzSessionid=sessionid,historiqueChat=[],historiqueChatCookie=[],chatMax=30,chatMaxCookie=5,doonce=0,optionsDate={weekday:"long",year:"numeric",month:"long",day:"numeric"},optionsDateHeure={hour:"2-digit",minute:"2-digit"},oneAgentFound=0,filterSuccess=0,chatAgentIMG=1,cobrowsingSessionAgent=!1,cobrowsingDialogConnection=!1,cobrowsingStatus=!1,waitforreponse=0,alternateSwitch=null,alternateagent="",reconnexionWebSocket=!1,reconnect=0,timeReconnexion=null,largWindow=Math.min(document.body.clientWidth,document.body.offsetWidth,window.innerWidth);languageNav=navigator.browserLanguage?navigator.browserLanguage:navigator.language,"EN"==geteLang&&(languageNav="en-US"),"https://preprod.watcheezy.net"==urlSrvRoot&&(urlSrvRoot="https://my.targetfirst.com");var widgetDisplayedOnce=0,newURL=window.location.protocol+"//"+window.location.host+window.location.pathname;""!=watcheeForcePage&&(newURL=watcheeForcePage);var dataFirstInvit=null;function r(e){/in/.test(document.readyState)?setTimeout("r("+e+")",9):e()}function LoadAllScripts(){roomName&&siteId&&VisWzSessionid&&""!=VisWzSessionid&&wlk&&$LAB.script("https://s3-eu-west-1.amazonaws.com/watcheezy-front-media/socket.io/socket.io.targetfirst.min.js").wait(function(){r(function(){$LAB.script(CDN+"/js/mutation_summary.js").wait(function(){r(function(){$LAB.script(CDN+"/js/tree_mirror.js").wait(function(){r(function(){VisWzSessionid&&-1!=VisWzSessionid?startSocket():(document.getElementById("vwatch").className="GeL_displaynone",document.getElementById("vwatch").style.display="none")})})})})})})}function LoadSocket(){roomName&&siteId&&VisWzSessionid&&wlk&&$LAB.script("https://s3-eu-west-1.amazonaws.com/watcheezy-front-media/socket.io/socket.io.targetfirst.min.js").wait(function(){r(function(){void 0!==TargetFirst.io&&startSocket()})})}function LoadFichiersSocket(){"1"==cobrowsingOnOff?(sessionid&&"-1"!=sessionid||sessionid&&"0"!=sessionid)&&LoadAllScripts():(sessionid&&"-1"!=sessionid||sessionid&&"0"!=sessionid)&&LoadSocket()}if(creatWatchBox=function(){var e=document.getElementById("communication"),t=document.createElement("div");t.id="WatchBoxContainer";var n=document.createTextNode("");void 0===t||void 0===e||document.getElementById("WatchBoxContainer")||(t.appendChild(n),e.appendChild(t));var a="<div id='contentWatchBox' class='desk videoRtcClose desk_Right mydesk-template iconsOn listAgentsOn lang_FR open'>";a+="\t<div id='WatchBox-titleBar'>",a+="\t\t<div class='contentTitleBar'>",a+="\t\t</div>",a+="\t\t<div id='TargetBox-pref' style='display:none'>",a+="\t\t\t<svg version='1.1' id='pref_ico' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 17 17' enable-background='new 0 0 17 17' xml:space='preserve'>",a+="\t\t\t\t<g>",a+="\t\t\t\t\t<path fill='#FFFFFF' d='M13.1,9.7c0.1,0,0.1,0.1,0.1,0.1c0,0.1,0,0.1,0,0.2c-0.2,0.7-0.6,1.3-1.1,1.9c0,0-0.1,0.1-0.1,0.1c-0.1,0-0.1,0-0.2,0L11,11.4c-0.4,0.3-0.8,0.5-1.2,0.7v1c0,0.1,0,0.1,0,0.1c0,0-0.1,0.1-0.1,0.1c-0.7,0.2-1.5,0.2-2.2,0c-0.1,0-0.1,0-0.1-0.1c0,0,0-0.1,0-0.1v-1c-0.5-0.2-0.9-0.4-1.2-0.7l-0.8,0.5c-0.1,0-0.1,0-0.2,0c-0.1,0-0.1,0-0.1-0.1C4.4,11.3,4,10.7,3.8,10c0-0.1,0-0.1,0-0.2c0-0.1,0.1-0.1,0.1-0.1l0.8-0.5c-0.1-0.5-0.1-0.9,0-1.4L3.9,7.3c-0.1,0-0.1-0.1-0.1-0.1c0-0.1,0-0.1,0-0.2C4,6.3,4.4,5.7,4.9,5.2c0,0,0.1-0.1,0.1-0.1s0.1,0,0.2,0L6,5.6c0.4-0.3,0.8-0.5,1.2-0.7v-1c0-0.1,0-0.1,0-0.1c0,0,0.1-0.1,0.1-0.1c0.7-0.2,1.5-0.2,2.2,0c0.1,0,0.1,0,0.1,0.1c0,0,0,0.1,0,0.1v1c0.5,0.2,0.9,0.4,1.2,0.7l0.8-0.5c0.1,0,0.1,0,0.2,0c0.1,0,0.1,0,0.1,0.1C12.6,5.7,13,6.3,13.2,7c0,0.1,0,0.1,0,0.2c0,0.1-0.1,0.1-0.1,0.1l-0.8,0.5c0.1,0.5,0.1,0.9,0,1.4L13.1,9.7z M9.6,7.4C9.3,7.1,8.9,6.9,8.5,6.9S7.7,7.1,7.4,7.4C7.1,7.7,6.9,8.1,6.9,8.5s0.2,0.8,0.5,1.1c0.3,0.3,0.7,0.5,1.1,0.5s0.8-0.2,1.1-0.5s0.5-0.7,0.5-1.1S9.9,7.7,9.6,7.4z'/>",a+="\t\t\t\t</g>",a+="\t\t\t</svg>",a+="\t\t</div>",a+="\t\t<div id='TargetBox-reduce' style='display:none' onclick='openPanel();'>",a+="\t\t\t<svg version='1.1' id='reduce_ico' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 17 17' enable-background='new 0 0 17 17' xml:space='preserve'>",a+="\t\t\t\t\t<rect x='2.5' y='12' fill='#F3F2F2' width='12' height='2'/>",a+="\t\t\t</svg>",a+="\t\t</div>",a+="\t\t<div id='TargetBox-close' style='display:none' onclick='reduceMydesk();'>",a+="\t\t\t<svg version='1.1' id='close_ico' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 17 17' enable-background='new 0 0 17 17' xml:space='preserve'>",a+="\t\t\t\t\t<polygon fill='#F3F2F2' points='13.5,5 12,3.6 8.5,7.1 5,3.6 3.6,5 7.1,8.5 3.6,12 5,13.5 8.5,9.9 12,13.5 13.5,12 9.9,8.5 '/>",a+="\t\t\t</svg>",a+="\t\t</div>",a+="\t</div>",a+="\t<div id='WatchBox-contentChat'>",a+="\t\t<div id='WatchBox-toolsBar'></div>",a+="\t\t<div id='wz_dropzone' class='dropzone inactifDropZone'>",a+="\t\t\t<div id='WatchBox-chatSendDropZone' class='ui-icones icone_sendMessage actif  wz_SendFileDropZone superInactif ' title='Envoyer'><svg version='1.1' id='bt_envoi' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='25px' height='25px' viewBox='-3 -2 25 25' style='enable-background:new 0 0 25 25;' xml:space='preserve'><title>Envoyer</title><polygon class='primary_color' points='3.4,17.4 16.6,10 3.4,2.6 4.5,9.3 12.2,10 4.5,10.7 '></polygon></svg></div>",a+="\t\t</div>",a+="\t\t<div id='WatchBox-conversation-body' >",a+="\t\t<div id='WatchBox-conversation' ></div>",a+="\t\t</div>",a+="\t\t<div id='WatchBox-MessageWrapper'>",a+="\t\t\t<textarea name='WatchBox-message' id='WatchBox-message' rows='2' maxlength='255' class='newMessage' data-emoji-picker='true' placeholder='"+typehereString+"'></textarea>",a+="\t\t\t<div id='WatchBox-chatupload' class='' title='"+sendString+"'>",a+="\t\t\t\t<svg xmlns='http://www.w3.org/2000/svg' id='icon_upload' width='20' height='20' viewBox='0 0 24 24'>",a+="\t\t\t\t\t<path class='tronbone' d='M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z'/>",a+="\t\t\t\t\t<path d='M0 0h24v24H0z' fill='none'/>",a+="\t\t\t\t</svg>",a+="\t\t\t</div>",a+="\t\t\t<div id='WatchBox-chatSend' class='ui-icones icone_sendMessage actif WatchBoxSendMessage' title='"+sendString+"'>",a+="\t\t\t\t<svg version='1.1' id='bt_envoi' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='25px' height='25px' viewBox='0 0 25 25' style='enable-background:new 0 0 25 25;' xml:space='preserve'>",a+="\t\t\t\t<polygon class='primary_color' points='3.4,17.4 16.6,10 3.4,2.6 4.5,9.3 12.2,10 4.5,10.7 '/>",a+="\t\t\t\t</svg>",a+="\t\t\t</div>",a+="\t\t\t<div id='WatchBox-optionChat'><div id='iconeOptionChat' class='iconeOptionChatPlus actif'>",a+="\t\t\t\t<svg version='1.1' baseProfile='tiny' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='22.3px' height='27px' viewBox='0 0 22.3 21.8' overflow='scroll' xml:space='preserve'>",a+="\t\t\t\t\t<g id='bt_preftools'>",a+="\t\t\t\t\t\t<path  fill='#FFFFFF' d='M19.5,12.1c0,0.2-0.1,0.4-0.3,0.4l-2,0.3c-0.1,0.3-0.3,0.7-0.4,1c0.4,0.5,0.8,1,1.2,1.5c0.1,0.1,0.1,0.2,0.1,0.3s0,0.2-0.1,0.3c-0.3,0.3-1.7,1.9-2.1,1.9c-0.1,0-0.2,0-0.3-0.1l-1.5-1.2c-0.3,0.2-0.7,0.3-1,0.4c-0.1,0.7-0.1,1.4-0.3,2c0,0.2-0.2,0.3-0.4,0.3H10c-0.2,0-0.4-0.1-0.4-0.3l-0.3-2c-0.3-0.1-0.7-0.2-1-0.4l-1.5,1.2c-0.1,0.1-0.2,0.1-0.3,0.1s-0.2,0-0.3-0.1c-0.6-0.5-1.3-1.2-1.8-1.8c-0.1-0.1-0.1-0.2-0.1-0.3c0-0.1,0-0.2,0.1-0.3c0.4-0.5,0.8-1,1.1-1.5c-0.2-0.3-0.3-0.7-0.4-1.1l-2-0.3c-0.2,0-0.3-0.2-0.3-0.4V9.7c0-0.2,0.1-0.4,0.3-0.4l2-0.3c0.1-0.3,0.3-0.7,0.4-1C5.2,7.5,4.8,7,4.4,6.5C4.3,6.4,4.3,6.3,4.3,6.2s0-0.2,0.1-0.3C4.6,5.6,6.1,4,6.5,4c0.1,0,0.2,0,0.3,0.1l1.5,1.2c0.3-0.2,0.7-0.3,1-0.4c0.1-0.7,0.1-1.4,0.3-2c0-0.2,0.2-0.3,0.4-0.3h2.4c0.2,0,0.4,0.1,0.4,0.3l0.3,2c0.3,0.1,0.7,0.2,1,0.4l1.5-1.2C15.6,4.1,15.7,4,15.8,4s0.2,0,0.3,0.1c0.6,0.5,1.3,1.2,1.8,1.8C18,6.1,18,6.1,18,6.2c0,0.1,0,0.2-0.1,0.3c-0.4,0.5-0.8,1-1.1,1.5c0.2,0.3,0.3,0.7,0.4,1.1l2,0.3c0.2,0,0.3,0.2,0.3,0.4V12.1z M11.2,8.1c-1.5,0-2.8,1.2-2.8,2.8s1.2,2.8,2.8,2.8s2.8-1.2,2.8-2.8S12.7,8.1,11.2,8.1z'/>",a+="\t\t\t\t\t</g>",a+="\t\t\t\t</svg>",a+="\t\t\t</div>",a+="\t\t\t</div>",a+="\t\t</div>",a+="\t</div>",a+="</div>",t.innerHTML=a},creatWatchBox(),LoadFichiersSocket(),cobrowsingOnOff){var SessionKey,oDOM,CobrowsingStarted=0,cobrowsingSession=VisWzSessionid,chatSession=wzgetCookie("session_id");function socketSend(e){cobrowsingSessionAgent&&socket.emit("changeHappened",{change:e,room:VisWzSessionid})}function startMirroring(){new TreeMirrorClient(document,{initialize:function(e,t){oDOM={f:"initialize",args:[e,t]}},applyChanged:function(e,t,n,a){void 0!=socket&&socketSend({f:"applyChanged",args:[e,t,n,a]})}})}function ContinueSession(){cobrowsingSessionAgent&&socket.emit("PageChange",{chatSession:VisWzSessionid})}function CreateSession(){socket.emit("CreateSession",{chatSession:VisWzSessionid})}var on="addEventListener"in window?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,function(){n(window.event)})};function BindEverything(){if(cobrowsingSessionAgent){for(var e=document.querySelectorAll("input"),t=0;t<e.length;t++)on(e[t],"keyup",function(){this.setAttribute("value",this.value)});var n=document.querySelectorAll("textarea");for(t=0;t<n.length;t++)on(n[t],"keyup",function(){""!=this.value&&(this.setAttribute("value",this.value),this.innerHTML=this.value)});var a=document.querySelectorAll("select");for(t=0;t<a.length;t++)on(a[t],"change",function(){for(var e=void 0===this.selectedIndex?window.event.srcElement:this,t=(e.selectedIndex,0);t<e.options.length;t++)"selected"==e.options[t].getAttribute("selected")&&e.options[t].removeAttribute("selected");e.options[e.selectedIndex].setAttribute("selected","selected")})}}function SendPositions(){cobrowsingSessionAgent?(document.onmousemove=function(e){if(e||(e=window.event),null==e.pageX&&null!=e.clientX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t.clientTop||0)}socket.emit("ClientMousePosition",{room:VisWzSessionid,PositionLeft:e.pageX,PositionTop:e.pageY})},document.onclick=function(e){if(e||(e=window.event),null==e.pageX&&null!=e.clientX){var t=document.documentElement,n=document.body;e.pageX=e.clientX+(t&&t.scrollLeft||n&&n.scrollLeft||0)-(t.clientLeft||0),e.pageY=e.clientY+(t&&t.scrollTop||n&&n.scrollTop||0)-(t.clientTop||0)}socket.emit("ClientMouseClick",{room:VisWzSessionid,PositionLeft:e.pageX,PositionTop:e.pageY})}):(document.onmousemove=function(e){e&&e.stopPropagation()},document.onclick=function(e){e&&e.stopPropagation()},window.onresize=function(e){e&&e.stopPropagation()},window.onscroll=function(e){e&&e.stopPropagation()})}sendScroll=function(e){cobrowsingSessionAgent&&socket.emit("changeHappened",{change:{scroll:e},room:VisWzSessionid})},sendResizeWindow=function(e,t){cobrowsingSessionAgent&&socket.emit("changeHappened",{change:{height:t,width:e},room:VisWzSessionid})}}function changeAgent(){alternateSwitch&&(switchAgent(alternateSwitch),document.querySelector("#system_changeAgent")&&(document.querySelector("#system_changeAgent").style.display="none"),waitforreponse=0)}function switchAgent(e){if("online"==e.etat||"busy"==e.etat){var t,n,a,s,i,o;if(t=e.sioid,n=e.name,a=e.job,s=e.avatar,i=e.WZAgentId,o=e.device,t&&""!=t){agentSelected=t,WatcheezyIDAgentSelected=i,WatcheezyDeviceAgentSelected=o,agentNameSelected=n,document.querySelector(".contentTitleBar")&&(agentDetailString="<div class='imageCurrentAgentContainer'>",agentDetailString+=s?"\t<img id='agent_img' title='' class='imageCurrentAgent' rel='' alt='avatar' src='"+urlSrvRoot+"/media/user/small/"+s+"'>":"\t<img id='agent_img' title='' class='imageCurrentAgent' rel='' alt='avatar'>",agentDetailString+="</div>",agentDetailString+="<div class='descCurrentAgentContainer'>",agentDetailString+="\t<p class='currentAgentName'>"+n+"</p>",agentDetailString+="\t<p class='currentAgentJob'>"+a+"</p>",agentDetailString+="</div>",document.querySelector(".contentTitleBar").innerHTML=agentDetailString);for(var c=document.querySelectorAll(".WZMessageActif"),d=0;d<c.length;d++)c[d].classList.remove("WZMessageActif"),c[d].classList.add("WZMessageInactif");var r=".WZagent-"+WatcheezyIDAgentSelected,l=document.querySelectorAll(r);for(d=0;d<l.length;d++)l[d].classList.remove("WZMessageInactif"),l[d].classList.add("WZMessageActif")}changeClasses("contentListAgent","actif","inactif");var g=document.getElementById("WatchBox-message"),m=null;document.getElementById("WatchBox-conversation")&&(m=document.getElementById("WatchBox-conversation"));var u=null;for(m&&(u=m.getElementsByClassName("messageVisiteur")),g.disabled=!1,g.placeholder=typehereString,d=0;d<u.length;d++)u[d].classList.remove("offline");var p=null;for(m&&(p=m.getElementsByClassName("messageAgent")),d=0;d<p.length;d++)p[d].classList.remove("offline");changeClasses("WatchBox-chatSend","inactif","actif"),changeClasses("mydesk_title","open","wzclose"),changeClasses("mydesk_title","tf_open","tf_wzclose")}}var myDropzone,dataAWS,windowChat,btPrintChat,timerNavCobrowsing,isOnline=!1,attachmentFile=!1,fileName="",dragEnter=!1;function testAttachment(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200!==e.status||(dataAWS=JSON.parse(e.responseText),myDropzone.processQueue()))},e.open("GET","https://backoffice.targetfirst.com/dist/ajax-webpack/utils/aws-s3-url-signer-php-master/",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send()}function openNotificationAgent(e,t,n,a,s,i){var o=document.createElement("div"),c="";(selectAgentNotification=e,o.id="formNotifAgent-"+e,o.className="formNotification",c+='\t<div id="iconeNotificationClose" class="ui-icones icone_closeNotification" onclick="sendNotificationComplete();"></div>',c+=i?'\t<div id="avatarNotification"><img title="" rel="" alt="avatar" src="'+urlSrvRoot+"/media/user/small/"+i+'"></div>':'\t<div id="avatarNotification"><img title="" rel="" alt="avatar" ></div>',c+='\t<div id="iconeNotificationAgent">',c+='\t\t<div class="notificationIphone"></div>',c+='\t\t<div class="iconeWatcheezyIphone iphoneSendNotification"></div>',c+="\t</div>",c+='\t<div id="contentNotificationAgent">',c+='\t\t<div id="txt-NotificationMessage">Actuellement '+t+" n'est pas disponible pour chatter, mais vous pouvez lui envoyer directement une notification sur son mobile, ou démarrer un chat avec un autre agent disponible.</div>",c+='\t\t<textarea name="WatchBox-message" id="WatchBox-NotificationMessage" rows="2" maxlength="255" class="newMessage" placeholder="Tapez votre message ici"></textarea>',c+='\t\t<div id="WatchBox-notificationSend" onclick="sendNotificationAgent(\''+e+"', '"+t+"', '"+n+"', '"+s+'\');" class="ui-icones icone_sendMessage actif WatchBoxSendMessage" title="Envoyer" ></div>',c+="\t</div>",o.innerHTML=c,document.getElementById("ListeAgentOnline"))&&document.getElementById("ListeAgentOnline").appendChild(o)}function logSendChat(e,t,n,a,s){var i="agentid="+e+"&idVisitor="+t+"&message="+n+"&type=sendChatFO&siteId="+a+"&entId="+s+"&preprod="+watcheePreprod,o=null;(window.XDomainRequest?o=new XDomainRequest:window.XMLHttpRequest&&(o=new XMLHttpRequest),o)&&(o.onreadystatechange=function(){},o.onload=function(){},o.open("POST",urlSrvRoot+"/fo/ajx/log_update_send.php"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(i))}function logUpdateChat(e,t,n,a,s){var i="agentid="+e+"&message="+n+"&idVisitor="+t+"&type=updateChatFO&siteId="+a+"&entId="+s+"&preprod="+watcheePreprod,o=null;(window.XDomainRequest?o=new XDomainRequest:window.XMLHttpRequest&&(o=new XMLHttpRequest),o)&&(o.onreadystatechange=function(){},o.onload=function(){},o.open("POST",urlSrvRoot+"/fo/ajx/log_update_send.php"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(i))}function sendNotificationAgent(e,t,n,a){var s=document.getElementById("WatchBox-NotificationMessage").value,i="Message du visiteur ("+a+") : "+s;if(document.getElementById("sitId"))var o=document.getElementById("sitId"),c=o.innerText||o.textContent;if(document.getElementById("entId"))var d=document.getElementById("entId"),r=d.innerText||d.textContent;var l,g=null;(window.XDomainRequest?g=new XDomainRequest:window.XMLHttpRequest&&(g=new XMLHttpRequest),g)&&(g.onreadystatechange=function(){4==g.readyState&&200==g.status?(sendPushNotification({message:i,agentID:e,idVisiteur:a,room:n,notif:"notif",messageContent:s}),l='<div id="RetourNotificationWatcheezy">L\'agent '+t+" a reçu une notification sur son mobile, il vous recontactera dès qu'il aura pris connaissance de votre message.</div>"):404==g.status&&(l='<div id="RetourNotificationWatcheezy">Erreur d\'envois</div>');document.getElementById("formNotifAgent-"+e)&&appendHtml(document.getElementById("formNotifAgent-"+e),l)},g.onload=function(){},g.open("GET",urlSrvRoot+"/fo/ajx/serverPush/storeMessageNotification.php?agentid="+e+"&message="+s+"&idVisitor="+a+"&room="+n+"&siteId="+c+"&entId="+r),g.send())}function retourSatisfaction(){socket.emit("confirmationFormSatisfaction",{clientSocketID:mySocketID,agentSocketID:agentSelected,chatSession:VisWzSessionid})}function retourNoSatisfaction(){socket.emit("noFormSatisfaction",{clientSocketID:mySocketID,agentSocketID:agentSelected,chatSession:VisWzSessionid})}function sendNotificationComplete(){document.querySelector(".formNotification")&&fade(document.querySelector(".formNotification"))}function fade(e){var t=1,n=setInterval(function(){t<=.1&&(clearInterval(n),e.style.display="none",e.parentNode.removeChild(e)),e.style.opacity=t,e.style.filter="alpha(opacity="+100*t+")",t-=.1*t},20)}function creatLoading(e,t,n){var a=document.createElement("div");a.classList.add("wrapper"),a.classList.add("showCanvasLoader"),a.classList.add(t),a.id="loadingVisitor"+n;var s=document.createElement("div");s.id="WatchBox_pourcent",a.appendChild(s),document.getElementById(e).appendChild(a);var i=new CanvasLoader("loadingVisitor"+n);i.setColor("#000000"),i.setShape("roundRect"),i.setDiameter(80),i.setDensity(13),i.setRange(1),i.setSpeed(1),i.setFPS(12),i.show()}function effaceLoading(e){document.getElementById("loadingVisitor"+e)&&fade(document.getElementById("loadingVisitor"+e))}function sendPushNotification(e){socket.emit("sendWebPushTo",{message:e.messageContent,agentSocketID:agentSelected,WZAgentId:WatcheezyIDAgentSelected,timeMsgVisiteur:""}),setCookieWz("wz_sendNotif","1",31536e3)}function saveHistoChatInStorage(e,t,n){e.length>chatMax&&e.splice(0,1),localStorage.setItem("histoChat",JSON.stringify(e)),"2"==t&&(sessionStorage.getItem("messageAuto")||sessionStorage.setItem("messageAuto","1")),setCookieWz("wz_histoChat",JSON.stringify("0"),1),n("ok")}function sendPushNotificationAllAgents(e){for(var t=0;t<agents.length;t++)socket.emit("sendWebPushTo",{message:e.messageContent,agentSocketID:agentSelected,WZAgentId:agents[t][2],timeMsgVisiteur:""});setCookieWz("wz_sendNotif","1",31536e3)}function findUrls(e){for(var t,n=(e||"").toString(),a=[],s=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g;null!==(t=s.exec(n));){var i=t[0];a.push(i)}return a}function disconnectBox(){"undefined"!=typeof startJS&&delete startJS,displayABS(),document.getElementById("vwatch").className="GeL_displaynone",document.getElementById("vwatch").style.display="none"}function changeroom(e,t){wlk=t,agentSelected=null,socket.emit("adduser",{myName:myName,roomName:roomName,geteLang:geteLang,siteId:e,entrepriseId:entrepriseId,mywzsession:VisWzSessionid,watcheeKey:t,wzspecialtable:specialtable,mySocketID:mySocketID,referer:newURL})}function r(e){/in/.test(document.readyState)?setTimeout("r("+e+")",9):e()}function appendHtml(e,t){var n=document.createElement("div");for(n.innerHTML=t;n.children.length>0;)e.appendChild(n.children[0])}function suppr(e){e.parentNode.removeChild(e)}function FindXY(e){for(var t=0,n=0;null!=e;)t+=e.offsetLeft-e.scrollLeft,n+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:n}}function wzgetCookie(e){if(0==document.cookie.length)return null;for(var t=new RegExp("(; )","g"),n=document.cookie.split(t),a=0;a<n.length;a++){var s=new RegExp("=","g"),i=n[a].split(s);if(i[0]==e)return unescape(i[1])}return null}function sticky(e,t){document.documentElement;var n=document.getElementById(t),a=document.getElementById(e),s=function(){var e,t,s,i;e=n.pageYOffset||n.scrollTop,t=/(nav\-is\-stuck)/i,s=n.className.match(t),a.offsetHeight,n.getBoundingClientRect(),FindXY(n).x,FindXY(n).y,i=n.offsetWidth,e>10&&!s&&(n.className=n.className+" nav-is-stuck",a.style.width=i-17+"px"),e<2&&s&&(n.className=n.className.replace(t,""),n.style.paddingTop="0",a.style.width=i-17+"px")};n.addEventListener("scroll",function(){window.requestAnimationFrame(s)})}function modifListAllMessage(){if(document.getElementById("WatchBox-conversation"))for(var e=document.getElementById("WatchBox-conversation").querySelectorAll(".WZ-MessageChat"),t=0;t<e.length;t++)t==e.length-1?e[t].classList.add("WZ_endMessage"):e[t].classList.remove("WZ_endMessage")}(startSocket=function(){var e;((socket=TargetFirst.io.connect(sioSrvRoot,{secure:!0,transports:["websocket"],reconnectionDelayMax:5e3,reconnectionDelay:1e3,reconnectionAttempts:100,reconnection:!0})).on("connect",function(){if(reconnexionWebSocket=!1,isOnline=!0,"1"==cobrowsingOnOff){var e=!1;function t(t){e&&(e=!1)}startMirroring(),VisWzSessionid?ContinueSession():CreateSession(),socket.on("demandeCobrowsing",function(e){e.data.demandeActive?((hasClassName("mydesk","desactive")||hasClassName("mydesk","tf_desactive"))&&openMydesk(),afficheDemandeCobrowsing(e)):effaceDemandeCobrowsing()}),socket.on("SessionCobrowsingStoped",function(e){IndicateurCobrowsing({status:!1}),cobrowsingSessionAgent=!1,SendPositions()}),socket.on("SessionStarted",function(){isLocalStorageNameSupported()&&sessionStorage.setItem("cobrowsingSession",VisWzSessionid),CobrowsingStarted=1,cobrowsingSession=VisWzSessionid,socket.emit("changeHappened",{change:{base:location.href.match(/^(.*\/)[^\/]*$/)[1]},room:VisWzSessionid}),socket.emit("changeHappened",{change:oDOM,room:VisWzSessionid});var t=Math.min(document.body.clientWidth,document.body.offsetWidth,window.innerWidth),n=Math.min(document.body.clientHeight,document.body.offsetHeight,window.innerHeight);socket.emit("changeHappened",{change:{height:n,width:t},room:VisWzSessionid});var a=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;if(socket.emit("changeHappened",{change:{scroll:a},room:VisWzSessionid}),window.onresize=function(e){var t=Math.min(document.body.clientWidth,document.body.offsetWidth,window.innerWidth),n=Math.min(document.body.clientHeight,document.body.offsetHeight,window.innerHeight);sendResizeWindow(t,n),largWindow=t},window.onscroll=function(){if(!e){var t=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;sendScroll(t)}},!document.getElementById("AdminPointer")){var s='<div id="AdminPointer"><div id="pointerNameAdmin" class="posRight">'+cobrowsingNameAgent+'</div></div><div id="ClickPointer" class="ClickPointer"></div>';appendHtml(document.body,s)}SendPositions(),BindEverything()}),socket.on("DOM_Loaded",function(){}),socket.on("AgentEventPage",function(t){var n=t.data;if("clickMouse"===n.typeEvent)try{n.dataEvent&&n.dataEvent.eventClick.tagName&&("A"===n.dataEvent.eventClick.tagName?n.dataEvent.eventClick.id?document.querySelectorAll('a[id="'+n.dataEvent.eventClick.id+'"]')[0].click():n.dataEvent.eventClick.className?document.querySelectorAll('a[class="'+n.dataEvent.eventClick.className+'"]')[0].click():document.location.href=n.dataEvent.eventClick.href:"BUTTON"===n.dataEvent.eventClick.tagName?document.querySelectorAll('button[name="'+n.dataEvent.eventClick.name+'"]')[0].click():"SELECT"===n.dataEvent.eventClick.tagName?"select-one"===n.dataEvent.eventClick.type&&(document.querySelectorAll('select[name="'+n.dataEvent.eventClick.name+'"]')[0].selected=n.dataEvent.eventClick.checked,document.querySelectorAll('select[name="'+n.dataEvent.eventClick.name+'"]')[0].selectedIndex=n.dataEvent.eventClick.selectedIndex,document.querySelectorAll('select[name="'+n.dataEvent.eventClick.name+'"]')[0].click()):"INPUT"===n.dataEvent.eventClick.tagName&&("text"===n.dataEvent.eventClick.type||("checkbox"===n.dataEvent.eventClick.type?document.querySelectorAll('input[name="'+n.dataEvent.eventClick.name+'"]')[0].click():"radio"===n.dataEvent.eventClick.type?n.dataEvent.eventClick.id?(document.querySelector('input[id="'+n.dataEvent.eventClick.id+'"]').checked=n.dataEvent.eventClick.checked,document.querySelector('input[id="'+n.dataEvent.eventClick.id+'"]').click()):(document.querySelector('input[name="'+n.dataEvent.eventClick.name+'"][value="'+n.dataEvent.eventClick.value+'"]').checked=!0,document.querySelector('input[name="'+n.dataEvent.eventClick.name+'"][value="'+n.dataEvent.eventClick.value+'"]').click()):(n.dataEvent.eventClick.type,n.dataEvent.eventClick.id?document.querySelector('input[id="'+n.dataEvent.eventClick.id+'"]').click():document.querySelector('input[name="'+n.dataEvent.eventClick.name+'"][value="'+n.dataEvent.eventClick.value+'"]').click())))),ClickMouseAgent(n.dataEvent.eventClick.mousePosX,n.dataEvent.eventClick.mousePosY)}catch(e){console.log(e)}else if("scrollPage"===n.typeEvent)e=!0,document.body.scrollTop=n.dataEvent.scrollTop,document.documentElement.scrollTop=n.dataEvent.scrollTop;else if("mousePos"===n.typeEvent){if(document.getElementById("AdminPointer")){var a=document.getElementById("AdminPointer"),s=document.getElementById("pointerNameAdmin");a.style.left=n.dataEvent.posLeft+"px",a.style.top=n.dataEvent.posTop+"px",n.dataEvent.posLeft>largWindow-200?s.classList.contains("posRight")&&(s.classList.remove("posRight"),s.classList.add("posLeft")):s.classList.contains("posLeft")&&(s.classList.remove("posLeft"),s.classList.add("posRight"))}}else if("keyPress"===n.typeEvent){var i;n.dataEvent.eventKeyUP.id?i=document.getElementById(n.dataEvent.eventKeyUP.id):n.dataEvent.eventKeyUP.name&&("TEXTAREA"===n.dataEvent.eventKeyUP.tagName?i=document.querySelectorAll('textarea[name="'+n.dataEvent.eventKeyUP.name+'"]')[0]:"INPUT"===n.dataEvent.eventKeyUP.tagName&&(i=document.querySelectorAll('input[name="'+n.dataEvent.eventKeyUP.name+'"]')[0])),i.value=n.dataEvent.eventKeyUP.value,"INPUT"===n.dataEvent.eventKeyUP.tagName||"TEXTAREA"===n.dataEvent.eventKeyUP.tagName&&(i.innerHTML=n.dataEvent.eventKeyUP.value)}}),window.addEventListener("mousewheel",t),window.addEventListener("DOMMouseScroll",t),window.addEventListener("mousedown",t)}var n=document.getElementById("mydesk");n.classList.contains("wb_offline")&&(n.classList.remove("wb_offline"),n.classList.add("wb_online")),getCookieWz("wz_agid")&&(cookieAgentId=getCookieWz("wz_agid")),getDomain()===getReferrerDomain()&&isLocalStorageNameSupported()&&"cd2df7e296dd2d89771d7d7ffc43d94d"!=wek&&localStorage.getItem("histoChat")&&0!==JSON.parse(localStorage.getItem("histoChat")).length&&(historiqueChat=JSON.parse(localStorage.getItem("histoChat")));var a="0";getCookieWz("wz_sendNotif")&&(a="1"),socket.emit("adduser",{myName:myName,roomName:roomName,geteLang:geteLang,siteId:siteId,entrepriseId:entrepriseId,mywzsession:VisWzSessionid,watcheeKey:wlk,wzspecialtable:specialtable,mySocketID:"",notification:a,referer:newURL}),afficheStatusSocket({connexion:!0});clearInterval(timeReconnexion),timeReconnexion=setInterval(function(){reconnexionWebSocket?(clearInterval(timeReconnexion),socket.emit("quitRoom",{roomName:roomName}),socket.close(),afficheStatusSocket({connexion:!1})):(socket.emit("modifUserRedis",{myName:myName,roomName:roomName,geteLang:geteLang,siteId:siteId,entrepriseId:entrepriseId,mywzsession:VisWzSessionid,watcheeKey:wlk,wzspecialtable:specialtable,mySocketID:"",notification:a}),reconnexionWebSocket=!0)},6e5)}),socket.on("disconnect",function(){clearInterval(timeReconnexion)}),socket.on("event",function(e){}),socket.on("sys_message",function(e){}),socket.on("error",function(e){navIsOffline(),isOnline=!1}),socket.on("connecting",function(e){isOnline=!0}),socket.on("connect_failed",function(){navIsOffline(),isOnline=!1}),socket.on("close",function(){navIsOffline(),isOnline=!1}),socket.on("reconnect",function(e,t){isOnline=!0}),socket.on("reconnect_attempt",function(e){isOnline=!1,rechargeLoadBalancer()}),socket.on("reconnecting",function(e){isOnline=!1}),socket.on("reconnect_failed",function(){}),socket.on("lastSocketDisconnected",function(e){}),socket.on("myInfos",function(e){mySocketID=e.mySocketID,socket.emit("changeMySocketID",{roomName:roomName,socketID:mySocketID,chatSession:VisWzSessionid,siteId:siteId,entrepriseId:entrepriseId,histoChat:historiqueChat,msgAttente:e.msgAttente}),getDomain()===getReferrerDomain()&&1!=reconnect||(socket.emit("demandeHistoChat",{chatSession:VisWzSessionid,clientSocketID:mySocketID,siteId:siteId,entrepriseId:entrepriseId}),reconnect=0)}),socket.on("visitorChangeAgent",function(e){var t=document.querySelector(".isTyping");t&&t.parentNode.removeChild(t);for(var n=0;n<agents.length;n++){if(agents[n][2]==e.data.WZAgentId)switchAgent({sioid:agents[n][4],aid:agents[n][2],charge:agents[n][5],name:agents[n][1],job:agents[n][6],avatar:agents[n][7],WZAgentId:agents[n][2],etat:agents[n][3],device:agents[n][13]})}}),socket.on("updatePresenceAgent",function(e){var t;agents=[],document.getElementById("listAgentMydesk")&&(t=document.getElementById("listAgentMydesk")),t&&(t.innerHTML=""),oneAgentFound=0;var n="",s=0,i=0,o="",c="",d=0,r="";document.getElementById("WatchBox-message")&&(r=document.getElementById("WatchBox-message"));var l=null;document.getElementById("WatchBox-conversation")&&(l=document.getElementById("WatchBox-conversation"));var g=null;l&&(g=l.getElementsByClassName("messageVisiteur"));var m=null;l&&(m=l.getElementsByClassName("messageAgent"));var u="",p=watcheeTags.split("|");for(listOfAvailableAgents=[],_=0;_<e.presenceAgent.length;_++)if("online"==e.presenceAgent[_][3]&&-1!=e.presenceAgent[_][11].indexOf(wlk)){var h=1;if(e.presenceAgent[_][21]&&"undefined"!=e.presenceAgent[_][21]&&""!=e.presenceAgent[_][21])if(-1!=(A=e.presenceAgent[_][21]).indexOf("|")){if(""!=(I=A.split("|"))[1])if(-1!=I[1].indexOf(";")){for(var v=I[1].split(";"),f=0;f<v.length;f++)if(-1!=currentpage.indexOf(v[f])){h=0;break}}else-1!=currentpage.indexOf(I[1])&&(h=0);I.length>2&&""!=I[2]&&watcheeTags!=I[2]&&(h=0),I.length>3&&""!=I[3]&&watcheeTags==I[3]&&(h=0)}else if(-1!=A.indexOf(";")){var y=A.split(";"),w=0;for(f=0;f<y.length;f++)-1!=currentpage.indexOf(y[f])&&w++;0!=w&&(h=1)}else-1==currentpage.indexOf(A)&&(h=0);1==h&&listOfAvailableAgents.push(e.presenceAgent[_])}var S=0;for(a=0;a<e.presenceAgent.length;a++){var A,k;if(e.presenceAgent[a][21]&&"undefined"!=e.presenceAgent[a][21]&&""!=e.presenceAgent[a][21])if(-1!=(A=e.presenceAgent[a][21]).indexOf("|")){var I;if(""!=(I=A.split("|"))[1])if(-1!=I[1].indexOf(";")){var C=I[1].split(";");for(w=0,f=0;f<C.length;f++)-1!=currentpage.indexOf(C[f])&&w++;if(0!=w)continue}else if(-1!=currentpage.indexOf(I[1]))continue;if(I.length>2&&""!=I[2]&&watcheeTags!=I[2])continue;if(I.length>3&&""!=I[3]&&watcheeTags==I[3])continue}else if(-1!=A.indexOf(";")){for(y=A.split(";"),w=0,f=0;f<y.length;f++)-1!=currentpage.indexOf(y[f])&&w++;if(0==w)continue}else if(-1==currentpage.indexOf(A))continue;if(e.presenceAgent[a][6]=e.presenceAgent[a][6]&&e.presenceAgent[a][6].replace("Ã¨","è"),e.presenceAgent[a][6]=e.presenceAgent[a][6]&&e.presenceAgent[a][6].replace("Ã©","é"),e.presenceAgent[a][6]=e.presenceAgent[a][6]&&e.presenceAgent[a][6].replace("Ã§","ç"),e.presenceAgent[a][6]=e.presenceAgent[a][6]&&e.presenceAgent[a][6].replace("Ã ","à"),e.presenceAgent[a][1]=e.presenceAgent[a][1]&&e.presenceAgent[a][1].replace("Ã¨","è"),e.presenceAgent[a][1]=e.presenceAgent[a][1]&&e.presenceAgent[a][1].replace("Ã©","é"),e.presenceAgent[a][1]=e.presenceAgent[a][1]&&e.presenceAgent[a][1].replace("Ã§","ç"),e.presenceAgent[a][1]=e.presenceAgent[a][1]&&e.presenceAgent[a][1].replace("Ã ","à"),d=0,e.chatAgent.length>0)for(chat=0;chat<e.chatAgent.length;chat++)e.chatAgent[chat][0]==sessionid&&e.chatAgent[chat][3]==e.presenceAgent[a][2]&&(d=1);if("offline"==e.presenceAgent[a][3]){var b=document.querySelector(".isTyping");b&&b.firstChild.innerText==e.presenceAgent[a][1]&&b.parentNode.removeChild(b),cobrowsingSessionAgent===e.presenceAgent[a][2]&&(cobrowsingSessionAgent=!1,IndicateurCobrowsing({status:!1}),SendPositions(),socket.emit("VisiteurQuitCobrowsing",{chatSession:cobrowsingSession,status:"remove"}))}else{var x=e.presenceAgent[a][20].split("|").filter(function(e){return""!=e&&NaN!=e&&void 0!=e&&null!=e});-1!==x.indexOf("C#"+sessionid)?cobrowsingSessionAgent||(IndicateurCobrowsing({status:!0}),cobrowsingSessionAgent=e.presenceAgent[a][2],ContinueSession(),cobrowsingNameAgent=e.presenceAgent[a][1]):-1!==x.indexOf("M#"+sessionid)&&(cobrowsingSessionAgent||(cobrowsingSessionAgent=e.presenceAgent[a][2],ContinueSession()))}if("true"==e.presenceAgent[a][16]&&e.presenceAgent[a][17]==VisWzSessionid){k=message_read;for(var z=document.querySelectorAll(".statusMessageVisiteur"),_=0;_<z.length;_++)z[_].textContent!=k&&(z[_].innerHTML=k)}if(e.presenceAgent[a][11]&&(-1==e.presenceAgent[a][11]||-1!=e.presenceAgent[a][11].indexOf(wlk))){agents.push(e.presenceAgent[a]);var B;B=e.presenceAgent[a][18];var E="";E=e.presenceAgent[a][19];var W=document.createElement("li"),L="";if(e.presenceAgent[a][0]==e.roomName){W.id="WZAgentId-"+e.presenceAgent[a][8];var D=e.presenceAgent[a][3];"busy"==D&&(D="offline",e.presenceAgent[a][17]!=sessionid&&1!=d||(D="online")),0==e.presenceAgent[a][13]?W.className=D:W.className=D+" device",function(t){var n={sioid:e.presenceAgent[t][4],aid:e.presenceAgent[t][2],charge:e.presenceAgent[t][5],name:e.presenceAgent[t][1],job:e.presenceAgent[t][6],avatar:e.presenceAgent[t][7],WZAgentId:e.presenceAgent[t][8],etat:D,device:e.presenceAgent[t][13]};W.onclick=function(){switchAgent(n)}}(a),L+='<div class="imageListeAgent">',L+='\t<a id="agent_img" class="imageAgent">',e.presenceAgent[a][7]?L+='\t\t<img title="" rel="" alt="avatar" src="'+urlSrvRoot+"/media/user/small/"+e.presenceAgent[a][7]+'">':L+='\t\t<img title="" rel="" alt="avatar" >',L+="\t</a>",L+="</div>",(1==e.presenceAgent[a][13]&&"offline"==e.presenceAgent[a][3]||1==e.presenceAgent[a][13]&&"busy"==e.presenceAgent[a][3]&&e.presenceAgent[a][17]!=sessionid)&&(L+='<div id="mobileListeAgent_'+e.presenceAgent[a][8]+'" class="mobileListeAgent"  onclick="openNotificationAgent('+e.presenceAgent[a][8]+", '"+e.presenceAgent[a][1]+"', '"+roomName+"', '"+mySocketID+"', '"+VisWzSessionid+"', '"+e.presenceAgent[a][7]+'\');" title="Contacter l\'agent directement sur son mobile avec une notification">',L+='\t<div class="notificationIphone"></div>',L+='\t<div class="iconeWatcheezyIphone"></div>',L+="</div>"),L+='<div class="nomListeAgent">',L+='\t<span class="listeAgentName">'+e.presenceAgent[a][1]+"</span>",L+='\t<span class="listeAgentJob">'+e.presenceAgent[a][6]+"</span>",L+="</div>",W.innerHTML=L;if("online"==e.presenceAgent[a][3]||"busy"==e.presenceAgent[a][3]&&1==d){if(e.presenceAgent[a][2]==cookieAgentId)u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8],S=1;else if(0==S)if(""==o)u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8];else if(1==d)u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8];else if(B>0&&B>s)u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8];else{var T=0;if(""!=watcheeTags&&""!=E){var M=E.split(";");for(var f in p)for(var N in M)f==N&&""!=f&&(T=1)}1==T?(u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8]):e.presenceAgent[a][5]<n?(u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8]):e.presenceAgent[a][5]!=n||Math.random()<.5||(u=e.presenceAgent[a][4],o=e.presenceAgent[a][4],i=e.presenceAgent[a][13],c=e.presenceAgent[a][8])}s=B,n=e.presenceAgent[a][5]}}if(t&&t.appendChild(W),"online"!=e.presenceAgent[a][3]&&("busy"!=e.presenceAgent[a][3]||e.presenceAgent[a][17]!=sessionid&&1!=d)||""==e.presenceAgent[a][4]||"0"==e.presenceAgent[a][4]||(oneAgentFound=1),e.presenceAgent[a][8]==WatcheezyIDAgentSelected&&-1!=e.presenceAgent[a][11].indexOf(wlk)){for(alternateagent="",alternateSwitch=null,_=0;_<listOfAvailableAgents.length;_++)listOfAvailableAgents[_][2]!=e.presenceAgent[a][2]&&(alternateagent=listOfAvailableAgents[_][1],alternateSwitch={sioid:listOfAvailableAgents[_][4],aid:listOfAvailableAgents[_][2],charge:listOfAvailableAgents[_][5],name:listOfAvailableAgents[_][1],job:listOfAvailableAgents[_][6],avatar:listOfAvailableAgents[_][7],WZAgentId:listOfAvailableAgents[_][8],etat:"online",device:listOfAvailableAgents[_][13]});if(agentSelected!=e.presenceAgent[a][4]&&-1!=e.presenceAgent[a][11].indexOf(wlk)&&(agentSelected=e.presenceAgent[a][4]),("offline"==e.presenceAgent[a][3]||"busy"==e.presenceAgent[a][3]&&0==d)&&0==chatBot){for(r.disabled=!0,"offline"==e.presenceAgent[a][3]?r.placeholder=visitorDisconnect:r.placeholder=agentAvailString,_=0;_<g.length;_++)g[_].classList.add("offline");for(_=0;_<m.length;_++)m[_].classList.add("offline");var O=null;if(document.getElementById("WatchBox-chatSend")&&(O=document.getElementById("WatchBox-chatSend"))&&(O.classList.remove("actif"),O.classList.add("inactif")),changeClasses("mydesk_title","open","wzclose"),changeClasses("mydesk_title","tf_open","tf_wzclose"),0==waitforreponse){if(document.getElementById("system_changeAgent"))(V=document.getElementById("system_changeAgent")).parentNode.removeChild(V);(W=document.createElement("li")).id="system_changeAgent",W.classList.add("messageSystem");var H="<div class='ui-icones icone_MessageSystem '></div><div data-timestamp='' class='timestamp_System'></div>";for("offline"==e.presenceAgent[a][3]?H+="<div class='message_System '><p class='txtChat'>"+agentOffString+"<br><br>":H+="<div class='message_System '><p class='txtChat'>"+agentBusyString+"<br><br>",alternateagent="",alternateSwitch=null,_=0;_<listOfAvailableAgents.length;_++)listOfAvailableAgents[_][2]!=e.presenceAgent[a][2]&&(alternateagent=listOfAvailableAgents[_][1],alternateSwitch={sioid:listOfAvailableAgents[_][4],aid:listOfAvailableAgents[_][2],charge:listOfAvailableAgents[_][5],name:listOfAvailableAgents[_][1],job:listOfAvailableAgents[_][6],avatar:listOfAvailableAgents[_][7],WZAgentId:listOfAvailableAgents[_][8],etat:"online",device:listOfAvailableAgents[_][13]});H+=""!=alternateagent&&"undefined"!=alternateagent&&alternateSwitch?agentString+alternateagent+agentSeemsString+" <span onclick='changeAgent();'><u>"+yesString+"</u></span> <span>"+retypeString+"</span>":nomoreString1+"<br>"+nomoreString2,H+="</p></div>",W.innerHTML=H,"322d5980fd4ca05072553dd17440ef76"==watcheeKey||"9c44184c124fda32ac19523ff93d2488"==watcheeKey?""!=alternateagent&&"undefined"!=alternateagent&&alternateSwitch?changeAgent():(document.getElementById("option_noagent")&&"default_agents"==document.getElementById("option_noagent").innerHTML||"interpel"==watcheeHide||1==shouldHaveBeenHide)&&(document.getElementById("vwatch").className="GeL_displaynone",document.getElementById("vwatch").style.display="none"):l.appendChild(W),remonteChat(),waitforreponse=1}}else if("online"==e.presenceAgent[a][3]||"busy"==e.presenceAgent[a][3]&&1==d&&0==chatBot){for(r.disabled=!1,r.placeholder=typehereString,_=0;_<g.length;_++)g[_].classList.remove("offline");for(_=0;_<m.length;_++)m[_].classList.remove("offline");var V;O=null;if(document.getElementById("WatchBox-chatSend")&&(O=document.getElementById("WatchBox-chatSend"))&&(O.classList.remove("inactif"),O.classList.add("actif")),changeClasses("mydesk_title","open","wzclose"),changeClasses("mydesk_title","tf_open","tf_wzclose"),document.getElementById("system_changeAgent"))(V=document.getElementById("system_changeAgent")).parentNode.removeChild(V),waitforreponse=0}}}}if(!(agentSelected&&void 0!==agentSelected||""==o&&""==u)){agentSelected=o,WatcheezyDeviceAgentSelected=i,""!=u&&(agentSelected=u),WatcheezyIDAgentSelected=c;var F=null;for(a=0;a<e.presenceAgent.length;a++)if(e.presenceAgent[a][4]==agentSelected&&-1!=e.presenceAgent[a][11].indexOf(wlk)){F=e.presenceAgent[a],WatcheezyIDAgentSelected=e.presenceAgent[a][8];break}F&&document.querySelector(".contentTitleBar")&&0==chatBot&&(agentNameSelected=F[1],agentDetailString="<div class='imageCurrentAgentContainer'>",F[7]?agentDetailString+="\t<img id='agent_img' class='imageCurrentAgent' rel='' alt='avatar' src='"+urlSrvRoot+"/media/user/small/"+F[7]+"'>":agentDetailString+="\t<img id='agent_img' class='imageCurrentAgent' rel='' alt='avatar'>",agentDetailString+="</div>",agentDetailString+="<div class='descCurrentAgentContainer'>",agentDetailString+="\t<p class='currentAgentName'>"+F[1]+"</p>",agentDetailString+="\t<p class='currentAgentJob'>"+F[6]+"</p>",agentDetailString+="</div>",document.querySelector(".contentTitleBar").innerHTML=agentDetailString)}0==oneAgentFound&&0==chatBot?(changeClasses("mydesk","agonline","agoffline"),changeClasses("mydesk_thirdstate_text","tfonline","tfoffline"),changeClasses("mydesk-callback","agonline","agoffline"),addClass("bt-callback","on"),1!=widgetDisplayedOnce&&(1==deskPrechatOnOff&&closePrechatFO(),displayABS(),changeClasses("mydesk_title","open","wzclose"),changeClasses("mydesk_title","tf_open","tf_wzclose"),oneAgentConnected=0,(document.getElementById("option_noagent")&&"default_agents"==document.getElementById("option_noagent").innerHTML||"interpel"==watcheeHide||1==shouldHaveBeenHide)&&(document.getElementById("vwatch").className="GeL_displaynone",document.getElementById("vwatch").style.display="none"),(hasClassName("mydesk","open")||hasClassName("mydesk","tf_open"))&&document.querySelector(".titleOuterMydesk")),setCookieWz("wz_bot_off",0,-1e3),"function"==typeof wz_agent_ko_callback&&wz_agent_ko_callback()):(0==chatBot&&(oneAgentConnected=1,changeClasses("mydesk","agoffline","agonline"),changeClasses("mydesk_thirdstate_text","tfoffline","tfonline"),changeClasses("mydesk-callback","agoffline","agonline"),addClass("bt-callback","on"),getCookieWz("prechatted")&&1==getCookieWz("prechatted")&&(prechatted=1),0==deskPrechatOnOff||1==deskPrechatOnOff&&1==prechatted?(hideABS(),1==deskPrechatOnOff&&closePrechatFO(),(hasClassName("mydesk","open")||hasClassName("mydesk","tf_open"))&&(changeClasses("mydesk_title","wzclose","open"),changeClasses("mydesk_title","tf_wzclose","tf_open")),(document.getElementById("option_noagent")&&"default_agents"==document.getElementById("option_noagent").innerHTML||1==shouldHaveBeenHide)&&"event"!=watcheeHide&&"total"!=watcheeHide&&(widgetDisplayedOnce=1,document.getElementById("vwatch").className="GeL_displayblock",document.getElementById("vwatch").style.display="block",remonteChat())):((document.getElementById("option_noagent")&&"default_agents"==document.getElementById("option_noagent").innerHTML||1==shouldHaveBeenHide)&&"event"!=watcheeHide&&"total"!=watcheeHide&&(widgetDisplayedOnce=1,document.getElementById("vwatch").className="GeL_displayblock",document.getElementById("vwatch").style.display="block",remonteChat()),1==deskPrechatOnOff&&1!=prechatted&&openPrechatFO()),1==moonDelayed&&(""!=pushToPush||""!=chatToSend&&""!=agentThatSend)&&(""==delaiToWait?checkAgentAndSendInvit(chatToSend,agentThatSend):setTimeout(function(){checkAgentAndSendInvit(chatToSend,agentThatSend)},1e3*delaiToWait))),"function"==typeof wz_agent_ok_callback&&wz_agent_ok_callback()),1==fbMessenger&&hideABS(),e.presenceAgent.length<2&&0==chatBot?changeClasses("contentListAgent","afficheOn","afficheOff"):"0"==hideAgentList&&0==chatBot&&changeClasses("contentListAgent","afficheOff","afficheOn")}),socket.on("updatechat",function(e){var t=e.data;if(t.chatSession==VisWzSessionid&&0==chatBot){var n,a;if(n=void 0!==t?t.timeStamp?new Date(1e3*t.timeStamp):new Date(1e3*t.timestamp):new Date,historiqueChat){var s=historiqueChat.length;if(0!=s)a=(historiqueChat[s-1].timeStamp?new Date(1e3*historiqueChat[s-1].timeStamp):new Date(1e3*historiqueChat[s-1].timestamp)).toLocaleDateString(languageNav,optionsDate)}else a=n.toLocaleDateString(languageNav,optionsDate);var i=document.getElementById("WatchBox-conversation");if("999"==t.messageType&&disconnectBox(),"11"==t.messageType&&sendAnalytics(VisWzSessionid),"12"==t.messageType&&cleanVis(vis_watchEZ_id),"13"==t.messageType&&activateBot(wlk),"14"==t.messageType&&deactivateBot(),"15"==t.messageType){openTransfertFileWindows(t.chatSession),(f=document.createElement("li")).id="system_transfert",f.classList.add("messageSystem");var o="<div class='ui-icones icone_MessageSystem '></div><div data-timestamp='' class='timestamp_System'></div>";o+="<div class='message_System '><p class='txtChat'>Pour recevoir un fichier, pensez à autoriser l'ouverture des pops-up (en haut dans votre navigateur)<br><br>",o+="</p></div>",f.innerHTML=o,i.appendChild(f),remonteChat()}if("17"==t.messageType&&closeTransfertFileWindows(t.chatSession),"1"==t.messageType||"16"==t.messageType){if(document.cookie.indexOf("wz_sendNotif=")>=0&&(socket.emit("visiteurSupNotif",{idVisitor:t.chatSession}),setCookieWz("wz_sendNotif",0,-1)),historiqueChat?historiqueChat.push(t):historiqueChat=t,saveHistoChatInStorage(historiqueChat,t.messageType,function(e){}),"adduser"!=t.step&&"WATCHEEZY"!=t.nameAuteur&&(openMydeskIncoming(),1==mUrl)){var c=compteElementChat(i);t.timeMsgVisiteur&&c.dateMessage!=t.timeMsgVisiteur&&t.chatSession==VisWzSessionid&&socket.emit("demandeHistoChat",{chatSession:VisWzSessionid,clientSocketID:mySocketID,siteId:t.siteId,entrepriseId:t.entrepriseId})}"Agent"==t.auteur&&logUpdateChat(t.WZAgentId,VisWzSessionid,t.message,t.siteId,t.entrepriseId)}var d=t.message,r=d.indexOf("autochat_"),l=d.indexOf("push_"),g=d.indexOf("Would you let us a feedback?"),m=d.indexOf("Souhaitez-vous nous evaluer ?"),u=d.indexOf("Merci de remplir ce formulaire."),p=d.indexOf("Thank you to fill this form.");if(-1!=r)d=d.substring(0,r)+d.substring(r+9);if(-1!=l||"3"==t.messageType||-1!=g||-1!=m||"4"==t.messageType||-1!=u||-1!=p||"5"==t.messageType){if(1,-1!=l){var h=d.substring(5);showPush(h)}else"3"==t.messageType&&showPush(t.message);"4"!=t.messageType&&"Souhaitez-vous nous evaluer ?"!=d&&"Would you let us a feedback?"!=d||switchToEval(),"5"!=t.messageType&&"Merci de remplir ce formulaire."!=d&&"Thank you to fill this form."!=d||switchToLead()}if(0==(1==uniqueAutoinvit&&"2"==t.messageType||getCookieWz("wz_agid")&&"2"==t.messageType?1:0)&&"WATCHEEZY"!=t.nameAuteur&&("1"==t.messageType||"2"==t.messageType||"16"==t.messageType)){var v;v=void 0!==t?new Date(1e3*t.timeStamp):new Date;var f,y=0;y=0!=i.querySelectorAll(".WZ-MessageChat").length?30:0,a!=v.toLocaleDateString(languageNav,optionsDate)&&addDateMessage(i,v,y,function(e){e.retour="ok"}),(f=document.createElement("div")).id=t.timeStamp,f.classList.add("WZ-MessageChat"),f.classList.add("WZMessageActif"),"Visiteur"!=t.auteur&&(f.classList.add("WZagent-"+t.WZAgentId),1==chatAgentIMG&&f.classList.add("chatIMG"));var w="";if(-1!=d.indexOf("http")){var S=findUrls(d);d=d.replace(S,"<a href='"+S+"' target='_blank'>"+S+"</a>"),w="ext_link"}var A=myName;if("Visiteur"!=t.auteur&&(A=t.nameAuteur),"7"==t.messageType){f.classList.add("messageSystem");o="<div class='ui-icones icone_MessageSystem '></div>";o+="<div data-timestamp='"+t.timeStamp+"' class='timestamp_System'>"+v.toLocaleTimeString(languageNav,optionsDateHeure)+"</div>",o+="<div class='message_System "+w+"'><p class='txtChat'>"+d+"</p></div>"}else{f.classList.add("message"+t.auteur);o="<div class='nom_"+t.auteur+"'>"+A+"</div>";o+="<div data-timestamp='"+t.timeStamp+"' class='timestamp_"+t.auteur+"'>"+v.toLocaleTimeString(languageNav,optionsDateHeure)+"</div>",t.attachments&&"undefined"!=t.attachments?"pdf"==t.attachments.split(".")[1]||"doc"==t.attachments.split(".")[1]||"zip"==t.attachments.split(".")[1]?(o+="<div class='message_"+t.auteur+" "+w+"'>",o+="\t<p class='txtChat'>"+d+"</p>",o+="\t<a id='filednwl' href='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t.attachments+"' alt='"+t.attachments.split(".")[1]+"' target='_blank'>",o+="\t\t<svg class='wz_icone_attachment' viewBox='0 0 36 23' xmlns='http://www.w3.org/2000/svg'>",o+="\t\t<path d='M3,13.75C3,9.19,6.69,5.5,11.25,5.5H27c3.314,0,6,2.685,6,6c0,3.314-2.686,6-6,6H14.25c-2.07,0-3.75-1.68-3.75-3.75c0-2.07,1.68-3.75,3.75-3.75H25.5v3H14.115c-0.825,0-0.825,1.5,0,1.5H27c1.65,0,3-1.35,3-3s-1.35-3-3-3H11.25C8.355,8.5,6,10.855,6,13.75C6,16.645,8.355,19,11.25,19H25.5v3H11.25C6.69,22,3,18.311,3,13.75z'/>",o+="\t\t</svg> <span class='formatFile'> Format : "+t.attachments.split(".")[1],o+="\t</span>",o+="\t</a>",o+="</div>"):o+="<div class='message_"+t.auteur+" "+w+"'><p class='txtChat'>"+d+"</p><a id='imgdnwl' href='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t.attachments+"' alt='"+t.attachments.split(".")[1]+"' target='_blank'><div id='tfzoomin'><svg version='1.1' id='Calque_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px'\t viewBox='0 0 30 30' enable-background='new 0 0 30 30' xml:space='preserve'><g>\t<path fill='#FFFFFF' d='M25.4,26.6c-0.2,0.2-0.5,0.3-0.8,0.3c-0.3,0-0.6-0.1-0.8-0.3l-4.7-4.7c-0.2-0.2-0.3-0.5-0.3-0.8v-0.8\t\tc-1.8,1.4-3.8,2.1-6,2.1c-1.8,0-3.4-0.4-4.9-1.3c-1.5-0.9-2.7-2.1-3.5-3.5C3.5,16.1,3,14.4,3,12.6c0-1.8,0.4-3.4,1.3-4.9\t\ts2.1-2.7,3.5-3.5s3.1-1.3,4.9-1.3c1.8,0,3.4,0.4,4.9,1.3c1.5,0.9,2.7,2.1,3.5,3.5c0.9,1.5,1.3,3.1,1.3,4.9c0,2.3-0.7,4.3-2.1,6h0.8\t\tc0.3,0,0.6,0.1,0.8,0.3l4.7,4.7c0.2,0.2,0.3,0.5,0.3,0.8c0,0.3-0.1,0.6-0.3,0.8L25.4,26.6z M18.3,9.4c-0.6-1-1.4-1.7-2.3-2.3\t\tc-1-0.6-2-0.9-3.2-0.9c-1.2,0-2.2,0.3-3.2,0.9S7.9,8.5,7.3,9.4s-0.9,2-0.9,3.2c0,1.2,0.3,2.2,0.9,3.2c0.6,1,1.4,1.7,2.3,2.3\t\ts2,0.9,3.2,0.9c1.2,0,2.2-0.3,3.2-0.9c1-0.6,1.7-1.4,2.3-2.3c0.6-1,0.9-2,0.9-3.2C19.2,11.5,18.9,10.4,18.3,9.4z M17.3,13.4\t\tc0,0.2-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.4,0.2h-2.6v2.6c0,0.2-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.4,0.2h-1.5\t\tc-0.2,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.2-0.4v-2.6H8.9c-0.2,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.2-0.4v-1.5\t\tc0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.2-0.2,0.4-0.2h2.6V8.7c0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.2-0.2,0.4-0.2h1.5c0.2,0,0.3,0.1,0.4,0.2\t\tc0.1,0.1,0.2,0.2,0.2,0.4v2.6h2.6c0.2,0,0.3,0.1,0.4,0.2c0.1,0.1,0.2,0.2,0.2,0.4V13.4z'/></g></svg></div><img src='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t.attachments+"' alt='"+t.attachments.split(".")[1]+"' onload='remonteChat()' target='_blank' class='wz_attachmentsMedia'/></a></div>":o+="<div class='message_"+t.auteur+" "+w+"'><p class='txtChat'>"+d+"</p></div>"}if(f.innerHTML=o,1==chatAgentIMG&&"Visiteur"!=t.auteur){var k=t.WZAgentId+"_avatar.jpg";if(agents)for(var I=0;I<agents.length;I++)agents[I][2]==t.WZAgentId&&(k=agents[I][7]);var C=document.createElement("img");k&&C.setAttribute("src",urlSrvRoot+"/media/user/small/"+k),C.setAttribute("alt",t.nameAuteur),C.classList.add("WZ-chatAgentIMG"),f.appendChild(C)}var b=0;if("2"==t.messageType&&("da2733a9e815757319292325aa5a4ca0"==wlk||"2e5be6b04a462356a9d7db9ac4028c24"==wlk||"0817f377d7b8e0e5d67bd5c1e130db6a"==wlk||"322d5980fd4ca05072553dd17440ef76"==wlk||"9c44184c124fda32ac19523ff93d2488"==wlk)){var x=getCookieWz("wz_autoChat");if(x&&-1!=x.indexOf("|"+d))b=1;else{var z=86400;if("322d5980fd4ca05072553dd17440ef76"==wlk||"9c44184c124fda32ac19523ff93d2488"==wlk)z=10;b=0,x?setCookieWz("wz_autoChat",x+"|"+d,z):setCookieWz("wz_autoChat","|"+d,z)}}if(0==b&&(openMydeskIncoming(),i.appendChild(f)),"Visiteur"==t.auteur){for(var _=message_sent,B=0;B<agents.length;B++)agents[B][8]==WatcheezyIDAgentSelected&&"true"==agents[B][16]&&agents[B][17]==t.chatSession&&(_=message_read);var E=document.createElement("div");if(E.id="statusMessage-"+t.timeStamp,E.classList.add("statusMessageVisiteur"),E.classList.add("WZagent-"+t.WZAgentId),E.innerHTML=_,i.appendChild(E),""!=invitationReceived&&0==filterSuccess){var W=getXDomainRequest();W.onload=function(){},W.open("GET",urlSrvRoot+"/fo/ajx/incrementFilter.php?id="+invitationReceived),W.send(),filterSuccess=1}}if(remonteChat(),"adduser"!=t.step&&("interpel"!=watcheeHide&&"event"!=watcheeHide&&"openalert"!=watcheeHide||(document.getElementById("vwatch").className="GeL_displayblock",document.getElementById("vwatch").style.display="block",remonteChat())),"adduser"!=t.step&&"3"!=t.messageType&&"Visiteur"!=t.auteur&&0==b&&(interval2||(interval2=setInterval(changeTitleNewMsg,2e3),setTimeout(function(){interval2&&(window.clearInterval(interval2),interval2=null,resetTitle())},3e4))),t.WZAgentId!=WatcheezyIDAgentSelected){var L=null;for(B=0;B<agents.length;B++)agents[B][8]==t.WZAgentId&&(L=agents[B]);if(L)switchAgent({sioid:L[4],aid:L[2],charge:L[5],name:L[1],job:L[6],avatar:L[7],WZAgentId:L[8],etat:L[3],device:L[13]})}}0==uniqueAutoinvit&&"2"==t.messageType&&(invitationReceived=t.filterId,dataFirstInvit=t),"2"!=t.messageType&&"1"!=t.messageType&&"7"!=t.messageType||(uniqueAutoinvit=1),"function"==typeof wz_inbound_chat_callback&&"Agent"==t.auteur&&wz_inbound_chat_callback(),"function"==typeof wz_outbound_chat_callback&&"Visiteur"==t.auteur&&wz_outbound_chat_callback(),modifListAllMessage()}}),socket.on("updatechatRoomClient",function(e){var t=e.data;if(t.chatSession==VisWzSessionid&&0==chatBot){var n,a;if(n=void 0!==t?t.timeStamp?new Date(1e3*t.timeStamp):new Date(1e3*t.timestamp):new Date,historiqueChat){var s=historiqueChat.length;if(0!=s)a=(historiqueChat[s-1].timeStamp?new Date(1e3*historiqueChat[s-1].timeStamp):new Date(1e3*historiqueChat[s-1].timestamp)).toLocaleDateString(languageNav,optionsDate)}else a=n.toLocaleDateString(languageNav,optionsDate);var i=document.getElementById("WatchBox-conversation");if("999"==t.messageType&&disconnectBox(),"11"==t.messageType&&sendAnalytics(VisWzSessionid),"12"==t.messageType&&cleanVis(vis_watchEZ_id),"13"==t.messageType&&activateBot(wlk),"14"==t.messageType&&deactivateBot(),"15"==t.messageType){openTransfertFileWindows(t.chatSession),(f=document.createElement("li")).id="system_transfert",f.classList.add("messageSystem");var o="<div class='ui-icones icone_MessageSystem '></div><div data-timestamp='' class='timestamp_System'></div>";o+="<div class='message_System '><p class='txtChat'>Pour recevoir un fichier, pensez à autoriser l'ouverture des pops-up (en haut dans votre navigateur)<br><br>",o+="</p></div>",f.innerHTML=o,i.appendChild(f),remonteChat()}if("17"==t.messageType&&closeTransfertFileWindows(t.chatSession),"1"==t.messageType||"16"==t.messageType){if(document.cookie.indexOf("wz_sendNotif=")>=0&&(socket.emit("visiteurSupNotif",{idVisitor:t.chatSession}),setCookieWz("wz_sendNotif",0,-1)),historiqueChat?historiqueChat.push(t):historiqueChat=t,saveHistoChatInStorage(historiqueChat,t.messageType,function(e){}),"adduser"!=t.step&&"WATCHEEZY"!=t.nameAuteur&&(openMydeskIncoming(),1==mUrl)){var c=compteElementChat(i);t.timeMsgVisiteur&&c.dateMessage!=t.timeMsgVisiteur&&t.chatSession==VisWzSessionid&&socket.emit("demandeHistoChat",{chatSession:VisWzSessionid,clientSocketID:mySocketID,siteId:t.siteId,entrepriseId:t.entrepriseId})}"Agent"==t.auteur&&logUpdateChat(t.WZAgentId,VisWzSessionid,t.message,t.siteId,t.entrepriseId)}var d=t.message,r=d.indexOf("autochat_"),l=d.indexOf("push_"),g=d.indexOf("Would you let us a feedback?"),m=d.indexOf("Souhaitez-vous nous evaluer ?"),u=d.indexOf("Merci de remplir ce formulaire."),p=d.indexOf("Thank you to fill this form.");if(-1!=r)d=d.substring(0,r)+d.substring(r+9);if(-1!=l||"3"==t.messageType||-1!=g||-1!=m||"4"==t.messageType||-1!=u||-1!=p||"5"==t.messageType){if(1,-1!=l){var h=d.substring(5);showPush(h)}else"3"==t.messageType&&showPush(t.message);"4"!=t.messageType&&"Souhaitez-vous nous evaluer ?"!=d&&"Would you let us a feedback?"!=d||switchToEval(),"5"!=t.messageType&&"Merci de remplir ce formulaire."!=d&&"Thank you to fill this form."!=d||switchToLead()}if(0==(1==uniqueAutoinvit&&"2"==t.messageType||getCookieWz("wz_agid")&&"2"==t.messageType?1:0)&&"WATCHEEZY"!=t.nameAuteur&&("1"==t.messageType||"2"==t.messageType||"16"==t.messageType)){var v;v=void 0!==t?new Date(1e3*t.timeStamp):new Date;var f,y=0;y=0!=i.querySelectorAll(".WZ-MessageChat").length?30:0,a!=v.toLocaleDateString(languageNav,optionsDate)&&addDateMessage(i,v,y,function(e){e.retour="ok"}),(f=document.createElement("div")).id=t.timeStamp,f.classList.add("WZ-MessageChat"),f.classList.add("WZMessageActif"),"Visiteur"!=t.auteur&&(f.classList.add("WZagent-"+t.WZAgentId),1==chatAgentIMG&&f.classList.add("chatIMG"));var w="";if(-1!=d.indexOf("http")){var S=findUrls(d);d=d.replace(S,"<a href='"+S+"' target='_blank'>"+S+"</a>"),w="ext_link"}var A=myName;if("Visiteur"!=t.auteur&&(A=t.nameAuteur),"7"==t.messageType){f.classList.add("messageSystem");o="<div class='ui-icones icone_MessageSystem '></div>";o+="<div data-timestamp='"+t.timeStamp+"' class='timestamp_System'>"+v.toLocaleTimeString(languageNav,optionsDateHeure)+"</div>",o+="<div class='message_System "+w+"'><p class='txtChat'>"+d+"</p></div>"}else{f.classList.add("message"+t.auteur);o="<div class='nom_"+t.auteur+"'>"+A+"</div>";o+="<div data-timestamp='"+t.timeStamp+"' class='timestamp_"+t.auteur+"'>"+v.toLocaleTimeString(languageNav,optionsDateHeure)+"</div>",":-)"==d?o+="<div class='message_"+t.auteur+" "+w+"'><p class='txtChat'><img src='https://preprod.watcheezy.net/bo/img/smiley/smiley2.png' alt='Lol' width='30'></p></div>":":-("==d?o+="<div class='message_"+t.auteur+" "+w+"'><p class='txtChat'><img src='https://preprod.watcheezy.net/bo/img/smiley/smiley.png' alt='Grrr' width='30'></p></div>":t.attachments&&"undefined"!=t.attachments?"pdf"==t.attachments.split(".")[1]||"doc"==t.attachments.split(".")[1]||"zip"==t.attachments.split(".")[1]?(o+="<div class='message_"+t.auteur+" "+w+"'>",o+="\t<p class='txtChat'>"+d+"</p>",o+="\t<a id='filednwl' href='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t.attachments+"' alt='"+t.attachments.split(".")[1]+"' target='_blank'>",o+="\t\t<svg class='wz_icone_attachment' viewBox='0 0 36 23' xmlns='http://www.w3.org/2000/svg'>",o+="\t\t<path d='M3,13.75C3,9.19,6.69,5.5,11.25,5.5H27c3.314,0,6,2.685,6,6c0,3.314-2.686,6-6,6H14.25c-2.07,0-3.75-1.68-3.75-3.75c0-2.07,1.68-3.75,3.75-3.75H25.5v3H14.115c-0.825,0-0.825,1.5,0,1.5H27c1.65,0,3-1.35,3-3s-1.35-3-3-3H11.25C8.355,8.5,6,10.855,6,13.75C6,16.645,8.355,19,11.25,19H25.5v3H11.25C6.69,22,3,18.311,3,13.75z'/>",o+="\t\t</svg> <span class='formatFile'> Format : "+t.attachments.split(".")[1],o+="\t</span>",o+="\t</a>",o+="</div>"):o+="<div class='message_"+t.auteur+" "+w+"'><p class='txtChat'>"+d+"</p><a id='imgdnwl' href='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t.attachments+"' alt='"+t.attachments.split(".")[1]+"' target='_blank'><div id='tfzoomin'><svg version='1.1' id='Calque_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px'\t viewBox='0 0 30 30' enable-background='new 0 0 30 30' xml:space='preserve'><g>\t<path fill='#FFFFFF' d='M25.4,26.6c-0.2,0.2-0.5,0.3-0.8,0.3c-0.3,0-0.6-0.1-0.8-0.3l-4.7-4.7c-0.2-0.2-0.3-0.5-0.3-0.8v-0.8c-1.8,1.4-3.8,2.1-6,2.1c-1.8,0-3.4-0.4-4.9-1.3c-1.5-0.9-2.7-2.1-3.5-3.5C3.5,16.1,3,14.4,3,12.6c0-1.8,0.4-3.4,1.3-4.9s2.1-2.7,3.5-3.5s3.1-1.3,4.9-1.3c1.8,0,3.4,0.4,4.9,1.3c1.5,0.9,2.7,2.1,3.5,3.5c0.9,1.5,1.3,3.1,1.3,4.9c0,2.3-0.7,4.3-2.1,6h0.8c0.3,0,0.6,0.1,0.8,0.3l4.7,4.7c0.2,0.2,0.3,0.5,0.3,0.8c0,0.3-0.1,0.6-0.3,0.8L25.4,26.6z M18.3,9.4c-0.6-1-1.4-1.7-2.3-2.3c-1-0.6-2-0.9-3.2-0.9c-1.2,0-2.2,0.3-3.2,0.9S7.9,8.5,7.3,9.4s-0.9,2-0.9,3.2c0,1.2,0.3,2.2,0.9,3.2c0.6,1,1.4,1.7,2.3,2.3s2,0.9,3.2,0.9c1.2,0,2.2-0.3,3.2-0.9c1-0.6,1.7-1.4,2.3-2.3c0.6-1,0.9-2,0.9-3.2C19.2,11.5,18.9,10.4,18.3,9.4z M17.3,13.4c0,0.2-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.4,0.2h-2.6v2.6c0,0.2-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.4,0.2h-1.5c-0.2,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.2-0.4v-2.6H8.9c-0.2,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.2-0.4v-1.5c0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.2-0.2,0.4-0.2h2.6V8.7c0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.2-0.2,0.4-0.2h1.5c0.2,0,0.3,0.1,0.4,0.2c0.1,0.1,0.2,0.2,0.2,0.4v2.6h2.6c0.2,0,0.3,0.1,0.4,0.2c0.1,0.1,0.2,0.2,0.2,0.4V13.4z'/></g></svg></div><img src='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t.attachments+"' alt='"+t.attachments.split(".")[1]+"' onload='remonteChat()' target='_blank' class='wz_attachmentsMedia'/></a></div>":o+="<div class='message_"+t.auteur+" "+w+"'><p class='txtChat'>"+d+"</p></div>"}if(f.innerHTML=o,1==chatAgentIMG&&"Visiteur"!=t.auteur){var k=t.WZAgentId+"_avatar.jpg";if(agents)for(var I=0;I<agents.length;I++)agents[I][2]==t.WZAgentId&&(k=agents[I][7]);var C=document.createElement("img");k&&C.setAttribute("src",urlSrvRoot+"/media/user/small/"+k),C.setAttribute("alt",t.nameAuteur),C.classList.add("WZ-chatAgentIMG"),f.appendChild(C)}var b=0;if("2"==t.messageType&&("da2733a9e815757319292325aa5a4ca0"==wlk||"2e5be6b04a462356a9d7db9ac4028c24"==wlk||"0817f377d7b8e0e5d67bd5c1e130db6a"==wlk||"322d5980fd4ca05072553dd17440ef76"==wlk||"9c44184c124fda32ac19523ff93d2488"==wlk)){var x=getCookieWz("wz_autoChat");if(x&&-1!=x.indexOf("|"+d))b=1;else{var z=86400;if("322d5980fd4ca05072553dd17440ef76"==wlk||"9c44184c124fda32ac19523ff93d2488"==wlk)z=10;b=0,x?setCookieWz("wz_autoChat",x+"|"+d,z):setCookieWz("wz_autoChat","|"+d,z)}}if(0==b&&(openMydeskIncoming(),i.appendChild(f)),"Visiteur"==t.auteur){for(var _=message_sent,B=0;B<agents.length;B++)agents[B][8]==WatcheezyIDAgentSelected&&"true"==agents[B][16]&&agents[B][17]==t.chatSession&&(_=message_read);var E=document.createElement("div");if(E.id="statusMessage-"+t.timeStamp,E.classList.add("statusMessageVisiteur"),E.classList.add("WZagent-"+t.WZAgentId),E.innerHTML=_,i.appendChild(E),""!=invitationReceived&&0==filterSuccess){var W=getXDomainRequest();W.onload=function(){},W.open("GET",urlSrvRoot+"/fo/ajx/incrementFilter.php?id="+invitationReceived),W.send(),filterSuccess=1}}if(remonteChat(),"adduser"!=t.step&&("interpel"!=watcheeHide&&"event"!=watcheeHide&&"openalert"!=watcheeHide||(document.getElementById("vwatch").className="GeL_displayblock",document.getElementById("vwatch").style.display="block",remonteChat())),"adduser"!=t.step&&"3"!=t.messageType&&"Visiteur"!=t.auteur&&0==b&&(interval2||(interval2=setInterval(changeTitleNewMsg,2e3),setTimeout(function(){interval2&&(window.clearInterval(interval2),interval2=null,resetTitle())},3e4))),t.WZAgentId!=WatcheezyIDAgentSelected){var L=null;for(B=0;B<agents.length;B++)agents[B][8]==t.WZAgentId&&(L=agents[B]);if(L)switchAgent({sioid:L[4],aid:L[2],charge:L[5],name:L[1],job:L[6],avatar:L[7],WZAgentId:L[8],etat:L[3],device:L[13]})}}0==uniqueAutoinvit&&"2"==t.messageType&&(invitationReceived=t.filterId,dataFirstInvit=t),"2"!=t.messageType&&"1"!=t.messageType&&"7"!=t.messageType||(uniqueAutoinvit=1),"function"==typeof wz_inbound_chat_callback&&"Agent"==t.auteur&&wz_inbound_chat_callback(),"function"==typeof wz_outbound_chat_callback&&"Visiteur"==t.auteur&&wz_outbound_chat_callback(),modifListAllMessage()}}),socket.on("retourAccuseReception",function(e){var t=document.getElementById("statusMessage-"+e.data.messageID);if(t){var n=message_sent;t.textContent!=n&&(t.innerHTML=n)}}),socket.on("forceAppear",function(e){"interpel"!=watcheeHide&&"openalert"!=watcheeHide||(document.getElementById("vwatch").className="GeL_displayblock",document.getElementById("vwatch").style.display="block",remonteChat())}),socket.on("formSatisfaction",function(e){switchToEval(e)}),socket.on("confirmSatisfaction",function(e){}),socket.on("afficheHistochat",function(e){var t;if(t=e.data?e.data:e,document.getElementById("mydesk").classList.contains("desk"),t&&0==chatBot){if(historiqueChat=[],document.getElementById("WatchBox-conversation")){var n=0;void 0!==t[0]&&(n=t[0].timeStamp?new Date(1e3*t[0].timeStamp):new Date(1e3*t[0].timestamp));var a="";n&&(a=n.toLocaleDateString(languageNav,optionsDate));var s=document.getElementById("WatchBox-conversation");s.innerHTML="";var i=document.createElement("div");if(i.classList.add("dates-messages"),i.classList.add("WZ-MessageChat"),i.style.zIndex="2",i.innerHTML=a,s.appendChild(i),0==t.length&&1==user_firstmsg_onoff&&""!=user_firstmsg_msg&&"undefined"!=agentNameSelected){(v=document.createElement("div")).classList.add("messageAgent"),v.classList.add("WZagent-"+WatcheezyIDAgentSelected),1==chatAgentIMG&&v.classList.add("chatIMG"),v.classList.add("WZ-MessageChat"),v.classList.add("WZMessageActif");var o=new Date,c="<div class='nom_Agent'>"+(w=agentNameSelected)+"</div><div data-timestamp='"+p+"' class='timestamp_Agent'>"+o.toLocaleTimeString(languageNav,optionsDateHeure)+"</div><div class='message_Agent'><p class='txtChat'>"+user_firstmsg_msg+"</p></div>";v.innerHTML=c;var d=WatcheezyIDAgentSelected+"_avatar.jpg";if(1==chatAgentIMG){if(agents)for(var r=0;r<agents.length;r++)agents[r][2]==WatcheezyIDAgentSelected&&(d=agents[r][7]);var l=document.createElement("img");d&&l.setAttribute("src",urlSrvRoot+"/media/user/small/"+d),l.setAttribute("alt","Agent"),l.classList.add("WZ-chatAgentIMG"),v.appendChild(l)}s.appendChild(v)}for(var g=0;g<t.length;g++){var m,u,p,h=0;if(m=t[g].WZAgentId?t[g].WZAgentId:t[g].agentId,3!=(u=t[g].messageType?t[g].messageType:t[g].type))if(void 0!==t[g]?t[g].timeStamp?(o=new Date(1e3*t[g].timeStamp),p=t[g].timeStamp):(o=new Date(1e3*t[g].timestamp),p=t[g].timestamp):o=new Date,a!=o.toLocaleDateString(languageNav,optionsDate)?addDateMessage(s,o,g+1,function(e){(e.retour="ok")&&(a=e.dateReference,h=1)}):h=2,0!=h){var v;if(t[g].auteur,(v=document.createElement("div")).id=t[g].timeStamp,v.classList.add("message"+t[g].auteur),v.classList.add("WZagent-"+m),1==chatAgentIMG&&"Visiteur"!=t[g].auteur&&v.classList.add("chatIMG"),v.classList.add("WZ-MessageChat"),m==WatcheezyIDAgentSelected?v.classList.add("WZMessageActif"):v.classList.add("WZMessageInactif"),7==u){c="<div class='nom_"+t[g].auteur+"'>"+t[g].nameAuteur+"</div><div data-timestamp='"+p+"' class='timestamp_"+t[g].auteur+"'>"+o.toLocaleTimeString(languageNav,optionsDateHeure)+"</div><div class='message_"+t[g].auteur+"'><p class='txtChat'>"+t[g].message+"</p></div>";v.innerHTML=c,s.appendChild(v)}else if(1==u){var f="";if(-1!=t[g].message.indexOf("http")){var y=findUrls(t[g].message);t[g].message=t[g].message.replace(y,"<a href='"+y+"' target='_blank'>"+y+"</a>"),f="ext_link"}var w=myName;if("Visiteur"!=t[g].auteur&&(w=t[g].nameAuteur),t[g].attachments&&"undefined"!=t[g].attachments)if("pdf"==t[g].attachments.split(".")[1]||"doc"==t[g].attachments.split(".")[1]||"zip"==t[g].attachments.split(".")[1])c="<div class='nom_"+t[g].auteur+"'>"+w+"</div><div data-timestamp='"+p+"' class='timestamp_"+t[g].auteur+"'>"+o.toLocaleTimeString(languageNav,optionsDateHeure)+"</div><div class='message_"+t[g].auteur+" "+f+"'><p class='txtChat'>"+t[g].message+"</p><a id='filednwl' href='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t[g].attachments+"' target='_blank'>\t\t<svg class='wz_icone_attachment' viewBox='0 0 36 23' xmlns='http://www.w3.org/2000/svg'>\t\t<path d='M3,13.75C3,9.19,6.69,5.5,11.25,5.5H27c3.314,0,6,2.685,6,6c0,3.314-2.686,6-6,6H14.25c-2.07,0-3.75-1.68-3.75-3.75c0-2.07,1.68-3.75,3.75-3.75H25.5v3H14.115c-0.825,0-0.825,1.5,0,1.5H27c1.65,0,3-1.35,3-3s-1.35-3-3-3H11.25C8.355,8.5,6,10.855,6,13.75C6,16.645,8.355,19,11.25,19H25.5v3H11.25C6.69,22,3,18.311,3,13.75z'/>\t\t</svg>  <span class='formatFile'> Format : "+t[g].attachments.split(".")[1]+"</span></a></div>";else c="<div class='nom_"+t[g].auteur+"'>"+w+"</div><div data-timestamp='"+p+"' class='timestamp_"+t[g].auteur+"'>"+o.toLocaleTimeString(languageNav,optionsDateHeure)+"</div><div class='message_"+t[g].auteur+" "+f+"'><p class='txtChat'>"+t[g].message+"</p><a id='imgdnwl' href='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t[g].attachments+"' target='_blank'><div id='tfzoomin'><svg version='1.1' id='Calque_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px'\t viewBox='0 0 30 30' enable-background='new 0 0 30 30' xml:space='preserve'><g>\t<path fill='#FFFFFF' d='M25.4,26.6c-0.2,0.2-0.5,0.3-0.8,0.3c-0.3,0-0.6-0.1-0.8-0.3l-4.7-4.7c-0.2-0.2-0.3-0.5-0.3-0.8v-0.8\t\tc-1.8,1.4-3.8,2.1-6,2.1c-1.8,0-3.4-0.4-4.9-1.3c-1.5-0.9-2.7-2.1-3.5-3.5C3.5,16.1,3,14.4,3,12.6c0-1.8,0.4-3.4,1.3-4.9\t\ts2.1-2.7,3.5-3.5s3.1-1.3,4.9-1.3c1.8,0,3.4,0.4,4.9,1.3c1.5,0.9,2.7,2.1,3.5,3.5c0.9,1.5,1.3,3.1,1.3,4.9c0,2.3-0.7,4.3-2.1,6h0.8\t\tc0.3,0,0.6,0.1,0.8,0.3l4.7,4.7c0.2,0.2,0.3,0.5,0.3,0.8c0,0.3-0.1,0.6-0.3,0.8L25.4,26.6z M18.3,9.4c-0.6-1-1.4-1.7-2.3-2.3\t\tc-1-0.6-2-0.9-3.2-0.9c-1.2,0-2.2,0.3-3.2,0.9S7.9,8.5,7.3,9.4s-0.9,2-0.9,3.2c0,1.2,0.3,2.2,0.9,3.2c0.6,1,1.4,1.7,2.3,2.3\t\ts2,0.9,3.2,0.9c1.2,0,2.2-0.3,3.2-0.9c1-0.6,1.7-1.4,2.3-2.3c0.6-1,0.9-2,0.9-3.2C19.2,11.5,18.9,10.4,18.3,9.4z M17.3,13.4\t\tc0,0.2-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.4,0.2h-2.6v2.6c0,0.2-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.4,0.2h-1.5\t\tc-0.2,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.2-0.4v-2.6H8.9c-0.2,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.2-0.4v-1.5\t\tc0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.2-0.2,0.4-0.2h2.6V8.7c0-0.2,0.1-0.3,0.2-0.4c0.1-0.1,0.2-0.2,0.4-0.2h1.5c0.2,0,0.3,0.1,0.4,0.2\t\tc0.1,0.1,0.2,0.2,0.2,0.4v2.6h2.6c0.2,0,0.3,0.1,0.4,0.2c0.1,0.1,0.2,0.2,0.2,0.4V13.4z'/></g></svg></div><img src='https://s3-eu-west-1.amazonaws.com/box-targetfirst/"+t[g].attachments+"' onload='remonteChat()' title='' rel='' alt="+t[g].attachments.split(".")[1]+" class='wz_attachmentsMedia' /></a></div>";else c="<div class='nom_"+t[g].auteur+"'>"+w+"</div><div data-timestamp='"+p+"' class='timestamp_"+t[g].auteur+"'>"+o.toLocaleTimeString(languageNav,optionsDateHeure)+"</div><div class='message_"+t[g].auteur+" "+f+"'><p class='txtChat'>"+t[g].message+"</p></div>";if(v.innerHTML=c,"Visiteur"!=t[g].auteur){d=m+"_avatar.jpg";if(1==chatAgentIMG){if(agents)for(r=0;r<agents.length;r++)agents[r][2]==m&&(d=agents[r][7]);l=document.createElement("img");d&&l.setAttribute("src",urlSrvRoot+"/media/user/small/"+d),l.setAttribute("alt",t[g].auteur),l.classList.add("WZ-chatAgentIMG"),v.appendChild(l)}s.appendChild(v)}else s.appendChild(v);historiqueChat&&historiqueChat.push(t[g])}remonteChat()}}}modifListAllMessage(),saveHistoChatInStorage(historiqueChat,u,function(e){})}erasePb()}),document.getElementById("WatchBox-chatSend"))&&(document.getElementById("WatchBox-chatSend").onclick=function(){attachmentFile?testAttachment():t({})});document.getElementById("WatchBox-chatSendDropZone")&&(document.getElementById("WatchBox-chatSendDropZone").onclick=function(){attachmentFile?testAttachment():t({})});function t(e){var t="";if(document.getElementById("WatchBox-message")&&(t=document.getElementById("WatchBox-message").value),0==chatBot){var a=document.getElementById("WatchBox-chatSend"),s=document.getElementById("WatchBox-conversation");if(a.classList.contains("actif")){reconnexionWebSocket=!1;var i=1,o=0;if(t||!t&&e.attachments){if(isLocalStorageNameSupported())if(sessionStorage.getItem("messageAuto"))"1"==JSON.parse(sessionStorage.getItem("messageAuto"))&&(o=1,sessionStorage.setItem("messageAuto","2"));socket.emit("stop-typing-targetFirst",{auteur:auteur,nameAuteur:"",senderSocketID:mySocketID,cibleSocketID:agentSelected,etat:0,chatSession:VisWzSessionid}),n=!1;var c=compteElementChat(s);if("admin:clean"==t&&(i=12),"admin:bot_on"==t&&(i=13),"admin:bot_off"==t&&(i=14),socket.emit("sendChat-targetFirst",{auteur:auteur,nameAuteur:"",message:t,attachments:e.attachments,agentSocketID:agentSelected,clientSocketID:mySocketID,chatSession:VisWzSessionid,WZAgentId:WatcheezyIDAgentSelected,messageType:i,siteId:siteId,entrepriseId:entrepriseId,repMessAuto:o,read:0,numElementChat:c.numChild+1,timeMsgVisiteur:c.dateMessage,tags:watcheeTags}),logSendChat(WatcheezyIDAgentSelected,VisWzSessionid,t,siteId,entrepriseId),document.getElementById("WatchBox-message").value="",document.getElementById("WatchBox-message").focus(),enConversationAvecAgent=agentSelected,dataFirstInvit&&(socket.emit("saveMessageAuto",dataFirstInvit,"save"),dataFirstInvit=null),"cd2df7e296dd2d89771d7d7ffc43d94d"!=wek&&setCookieWz("wz_agid",WatcheezyIDAgentSelected,""),setCookieWz("wz_chat_active","1",30),1==WatcheezyDeviceAgentSelected)for(var d=0;d<agents.length;d++){if(agents[d][2]==WatcheezyIDAgentSelected)if("false"==agents[d][16])sendPushNotification({message:"Le visiteur ("+VisWzSessionid+") souhaite vous parler sur "+document.location.origin,agentID:WatcheezyIDAgentSelected,idVisiteur:VisWzSessionid,room:roomName,messageContent:t})}}}}else t&&(sendToBot(t,""),document.getElementById("WatchBox-message").value="")}var n=!1;document.body.onkeydown=function(t){var a=1,s=t.keyCode||t.charCode||t.which,i=(t.target||t.srcElement,""),o=0,c=document.getElementById("WatchBox-conversation");if(document.getElementById("WatchBox-message")&&(i=document.getElementById("WatchBox-message").value),"WatchBox-message"==t.target.id)if(reconnexionWebSocket=!1,0==chatBot)if(13===s){if(t.preventDefault(),attachmentFile)testAttachment();else if(i){if(isLocalStorageNameSupported())if(sessionStorage.getItem("messageAuto"))"1"==JSON.parse(sessionStorage.getItem("messageAuto"))&&(o=1,sessionStorage.setItem("messageAuto","2"));socket.emit("stop-typing-targetFirst",{auteur:auteur,nameAuteur:"",senderSocketID:mySocketID,cibleSocketID:agentSelected,etat:0,chatSession:VisWzSessionid}),n=!1;var d=compteElementChat(c);if("admin:clean"==i&&(a=12),"admin:bot_on"==i&&(a=13),"admin:bot_off"==i&&(a=14),socket.emit("sendChat-targetFirst",{auteur:auteur,nameAuteur:"",message:i,attachments:this.fileName,agentSocketID:agentSelected,clientSocketID:mySocketID,chatSession:VisWzSessionid,WZAgentId:WatcheezyIDAgentSelected,messageType:a,siteId:siteId,entrepriseId:entrepriseId,repMessAuto:o,numElementChat:d.numChild+1,timeMsgVisiteur:d.dateMessage,tags:watcheeTags}),logSendChat(WatcheezyIDAgentSelected,VisWzSessionid,i,siteId,entrepriseId),document.getElementById("WatchBox-message").value="",document.getElementById("WatchBox-message").focus(),enConversationAvecAgent=agentSelected,dataFirstInvit&&(socket.emit("saveMessageAuto",dataFirstInvit,"save"),dataFirstInvit=null),"cd2df7e296dd2d89771d7d7ffc43d94d"!=wek&&setCookieWz("wz_agid",WatcheezyIDAgentSelected,""),setCookieWz("wz_chat_active","1",30),1==WatcheezyDeviceAgentSelected)for(var r=0;r<agents.length;r++){if(agents[r][2]==WatcheezyIDAgentSelected)if("false"==agents[r][16])sendPushNotification({message:"Le visiteur ("+VisWzSessionid+") souhaite vous parler sur "+document.location.origin,agentID:WatcheezyIDAgentSelected,idVisiteur:VisWzSessionid,room:roomName,messageContent:i})}}}else clearTimeout(e),n?"1"==superIstypingOnOff&&socket.emit("start-typing-targetFirst",{auteur:auteur,nameAuteur:"",senderSocketID:mySocketID,cibleSocketID:agentSelected,etat:1,chatSession:VisWzSessionid,message:i}):(socket.emit("start-typing-targetFirst",{auteur:auteur,nameAuteur:"",senderSocketID:mySocketID,cibleSocketID:agentSelected,etat:1,chatSession:VisWzSessionid}),n=!0);else 13===s&&(t.preventDefault(),i&&(sendToBot(i,""),document.getElementById("WatchBox-message").value=""));document.getElementById("WatchBox-NotificationMessage")&&(txtMessageNotification=document.getElementById("WatchBox-NotificationMessage").value),"WatchBox-NotificationMessage"==t.target.id&&13===s&&0==chatBot&&(t.preventDefault(),txtMessageNotification&&sendNotificationAgent(selectAgentNotification,"agent",roomName,VisWzSessionid))},document.body.onkeyup=function(t){13!==(t.keyCode||t.charCode||t.which)&&0==chatBot&&(clearTimeout(e),e=setTimeout(function(){n&&(socket.emit("stop-typing-targetFirst",{auteur:auteur,nameAuteur:"",senderSocketID:mySocketID,cibleSocketID:agentSelected,etat:0,chatSession:VisWzSessionid}),n=!1)},5e3))},socket.on("update-typing",function(e){var t=e.data;if(document.getElementById("WatchBox-conversation")){var n=document.getElementById("WatchBox-conversation"),a=document.createElement("div");if(a.classList.add("isTyping"),1==t.etat){var s="<div class='isTyping_nom'>"+t.nameAuteur+"</div><div class='isTyping_message'><div class='WatchBox-istyping'><div class='bounce1'></div><div class='bounce2'></div><div class='bounce3'></div></div></div>";if(a.innerHTML=s,1==chatAgentIMG){a.classList.add("chatIMG");var i=t.WZAgentId+"_avatar.jpg";if(agents)for(var o=0;o<agents.length;o++)agents[o][2]==t.WZAgentId&&(i=agents[o][7]);var c=document.createElement("img");i&&c.setAttribute("src",urlSrvRoot+"/media/user/small/"+i),c.setAttribute("alt",t.nameAuteur),c.classList.add("WZ-chatAgentIMG"),a.appendChild(c)}n.appendChild(a),remonteChat()}else{var d=document.querySelector(".isTyping");d&&d.parentNode.removeChild(d)}}});socket.on("updateTyping",function(e){var t=e.data;if("Visiteur"!=t.auteur&&document.getElementById("WatchBox-conversation")){var n=document.getElementById("WatchBox-conversation"),a=document.createElement("div");if(a.classList.add("isTyping"),1==t.etat){var s="<div class='isTyping_nom'>"+t.nameAuteur+"</div><div class='isTyping_message'><div class='WatchBox-istyping'><div class='bounce1'></div><div class='bounce2'></div><div class='bounce3'></div></div></div>";if(a.innerHTML=s,1==chatAgentIMG){a.classList.add("chatIMG");var i=t.WZAgentId+"_avatar.jpg";if(agents)for(var o=0;o<agents.length;o++)agents[o][2]==t.WZAgentId&&(i=agents[o][7]);var c=document.createElement("img");i&&c.setAttribute("src",urlSrvRoot+"/media/user/small/"+i),c.setAttribute("alt",t.nameAuteur),c.classList.add("WZ-chatAgentIMG"),a.appendChild(c)}n.appendChild(a),!0,remonteChat()}else{var d=document.querySelector(".isTyping");d&&(d.parentNode.removeChild(d),!1)}}}),socket.on("openChatVisiteur",function(e){if(document.getElementById("contentListAgent")){var t=document.getElementById("contentListAgent");t.classList.contains("actif")&&(t.classList.remove("actif"),t.classList.add("inactif")),document.getElementById("formNotifAgent-"+e.agentID)&&sendNotificationComplete()}for(a=0;a<agents.length;a++)if(agents[a][8]==e.data.agentID){var n;if("true"==agents[a][16]&&agents[a][17]==VisWzSessionid){n=message_read;for(var s=document.querySelectorAll(".statusMessageVisiteur"),i=0;i<s.length;i++)s[i].textContent!=n&&(s[i].innerHTML=n)}switchAgent({sioid:agents[a][4],aid:agents[a][2],charge:agents[a][5],name:agents[a][1],job:agents[a][6],avatar:agents[a][7],WZAgentId:agents[a][8],etat:"online",device:agents[a][13]})}}),socket.on("askGeoloc",function(e){function t(t){socket.emit("respGeoloc",{senderSocketID:mySocketID,agentSocketID:e.agentSocketID,chatSession:VisWzSessionid,error:t.code,errorMessage:t.message})}navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=t.coords.latitude,a=t.coords.longitude,s=t.coords.altitude;socket.emit("respGeoloc",{senderSocketID:mySocketID,agentSocketID:e.agentSocketID,chatSession:VisWzSessionid,error:"0",latitude:n,longitude:a,altitude:s})},t):((void 0).code="BROWSER_NOHTML5",t(void 0))}),document.getElementById("isMobile")&&1==document.getElementById("isMobile").innerHTML||$LAB.script("https://backoffice.targetfirst.com/lib/emoji/emoji.min.js").wait(function(){TargetFirst&&TargetFirst.EmojiPicker&&new TargetFirst.EmojiPicker}),$LAB.script("https://backoffice.targetfirst.com/lib/dropzone/dropzone.min.js").wait(function(){var e;function n(){document.getElementById("wz_dropzone").classList.remove("inactifDropZone"),document.getElementById("wz_dropzone").classList.add("actifDropZone")}"fr-FR"===languageNav&&(Dropzone.prototype.defaultOptions.dictDefaultMessage="Déposez votre fichier ici",Dropzone.prototype.defaultOptions.dictFallbackMessage="Votre navigateur ne supporte pas le glisser/déposer.",Dropzone.prototype.defaultOptions.dictFallbackText="Utiliser le formulaire de téléchargement",Dropzone.prototype.defaultOptions.dictFileTooBig="Fichier trop volumineux ({{filesize}}MiB). taille max : {{maxFilesize}}MiB.",Dropzone.prototype.defaultOptions.dictInvalidFileType="Vous ne pouvez pas téléchager ce type de fichier.",Dropzone.prototype.defaultOptions.dictResponseError="Réponse serveur {{statusCode}}.",Dropzone.prototype.defaultOptions.dictCancelUpload="Annulez le téléchargement",Dropzone.prototype.defaultOptions.dictCancelUploadConfirmation="Vous êtes sur de vouloir annuler ce téléchargement ?",Dropzone.prototype.defaultOptions.dictRemoveFile="Retirez ce fichier",Dropzone.prototype.defaultOptions.dictMaxFilesExceeded="Vous ne pouvez pas télécharger plus de fichier."),(myDropzone=new Dropzone("div#wz_dropzone",{url:"https://s3-eu-west-1.amazonaws.com/box-targetfirst",addRemoveLinks:!0,autoProcessQueue:!1,maxFiles:1,thumbnailWidth:null,thumbnailHeight:120,thumbnailMethod:"contain",maxFilesize:4,maxThumbnailFilesize:4,acceptedFiles:"image/*,application/pdf,.zip,.doc",clickable:"#WatchBox-chatupload",dragleave:function(e){attachmentFile||(document.getElementById("wz_dropzone").classList.remove("actifDropZone"),document.getElementById("wz_dropzone").classList.add("inactifDropZone"))},drop:function(t){attachmentFile=!0,e=setTimeout(function(){document.getElementById("wz_dropzone").classList.remove("actifDropZone"),document.getElementById("wz_dropzone").classList.add("inactifDropZone")},2e3)},sending:function(e,t,n){var a=e.name.lastIndexOf("'"),s=e.name.substring(a+1).split("."),i=s[s.length-1];this.fileName=Date.now()+"_"+Math.floor(1e9*Math.random()+1)+"."+i,n.append("key",this.fileName),n.append("acl","public-read-write"),n.append("success_action_status","201"),n.append("Content-Type",""),n.append("X-amz-Algorithm","AWS4-HMAC-SHA256"),n.append("X-amz-Credential",dataAWS.signature["X-amz-credential"]),n.append("X-amz-Date",dataAWS.signature["X-amz-date"]),n.append("Policy",dataAWS.signature.policy),n.append("X-amz-Signature",dataAWS.signature["X-amz-signature"])}})).on("removedfile",function(e){myDropzone.files.length||(document.getElementById("wz_dropzone").classList.remove("actifDropZone"),document.getElementById("wz_dropzone").classList.add("inactifDropZone"),attachmentFile=!1,this.fileName="",document.getElementsByClassName("wz_SendFileDropZone")[0].classList.remove("superActif"),document.getElementsByClassName("wz_SendFileDropZone")[0].classList.add("superInactif"))}),myDropzone.on("thumbnail",function(e){}),myDropzone.on("canceled",function(e){}),myDropzone.on("addedfile",function(t){clearTimeout(e),n(),attachmentFile=!0,document.getElementsByClassName("wz_SendFileDropZone")[0].classList.remove("superInactif"),document.getElementsByClassName("wz_SendFileDropZone")[0].classList.add("superActif")}),myDropzone.on("success",function(e,n){t({attachments:this.fileName}),myDropzone.removeFile(e),document.getElementsByClassName("wz_SendFileDropZone")[0].classList.remove("superActif"),document.getElementsByClassName("wz_SendFileDropZone")[0].classList.add("superInactif")}),myDropzone.on("error",function(e){}),document.getElementById("WatchBox-conversation").addEventListener("dragenter",n)})},isLocalStorageNameSupported=function(){var e=window.sessionStorage;try{return e.setItem("test","1"),e.removeItem("test"),!0}catch(e){return!1}},addDateMessage=function(e,t,n,a){dateReference=t.toLocaleDateString(languageNav,optionsDate);var s=document.createElement("div");s.classList.add("dates-messages"),s.style.zIndex=n,s.innerHTML=dateReference,e.appendChild(s),a({retour:"ok",dateReference:dateReference})},document.getElementById("TargetBox-pref"))&&((btOpt=document.getElementById("TargetBox-pref")).onclick=function(){openPrint()});if(document.getElementById("WatchBox-optionChat")){var btOpt=document.getElementById("WatchBox-optionChat"),btOption=document.getElementById("iconeOptionChat"),menuOption=document.getElementById("WatchBox-navBarChat");btOpt.onclick=function(){openPrint()}}if(document.getElementById("WatchBox-message")){var textAreaChat=document.getElementById("WatchBox-message");btOpt=document.getElementById("WatchBox-optionChat"),btOption=document.getElementById("iconeOptionChat"),menuOption=document.getElementById("WatchBox-navBarChat");textAreaChat.onclick=function(){btOption.classList.contains("iconeOptionChatMoins")&&btOption.classList.remove("iconeOptionChatMoins"),btOption.classList.add("iconeOptionChatPlus")}}document.getElementById("printChat")&&((btPrintChat=document.getElementById("printChat")).onclick=function(){openPrint()});document.getElementById("saveChat")&&((btPrintChat=document.getElementById("saveChat")).onclick=function(){openPrint()});document.getElementById("emailChat")&&((btPrintChat=document.getElementById("emailChat")).onclick=function(){openPrint()});document.getElementById("popupChat")&&((btPrintChat=document.getElementById("popupChat")).onclick=function(){openPopup()});function compteElementChat(e){for(var t,n=e.childNodes.length,a=0;a<e.childNodes.length;a++)(e.childNodes[a].classList.contains("WZ-MessageAuto")||e.childNodes[a].classList.contains("dates-messages")||e.childNodes[a].classList.contains("statusMessageVisiteur"))&&n--,e.childNodes[a].classList.contains("messageVisiteur")&&e.childNodes[a].children[1].getAttribute("data-timestamp")&&(t=e.childNodes[a].children[1].getAttribute("data-timestamp"));return{numChild:n,dateMessage:t}}function checkAgentAndSendInvit(e,t){getCookieWz("wz_bluechat")||0!=uniqueAutoinvit||autoChatFo(e)}function autoChatFo(e){if(1==oneAgentFound&&0==chatBot){var t,n=document.getElementById("WatchBox-conversation");compteElementChat(n).numChild<2&&1==mUrl&&socket.emit("demandeHistoChat",{chatSession:VisWzSessionid,clientSocketID:mySocketID,siteId:siteId,entrepriseId:entrepriseId}),openMydeskIncoming(),hideABS(),t=new Date;var a=document.createElement("div");a.classList.add("WZagent-"+WatcheezyIDAgentSelected),a.classList.add("WZ-MessageChat"),a.classList.add("WZ-MessageAuto"),a.classList.add("WZMessageActif"),a.classList.add("messageAgent");var s="<div class='nom_Agent'>"+agentNameSelected+"</div>";s+="<div data-timestamp='"+t+"' class='timestamp_Agent'>"+t.toLocaleTimeString(languageNav,optionsDateHeure)+"</div>",s+="<div class='message_Agent'><p class='txtChat'>"+e+"</p></div>",a.innerHTML=s,n.appendChild(a),remonteChat(),uniqueAutoinvit=1,"322d5980fd4ca05072553dd17440ef76"==watcheeKey||"9c44184c124fda32ac19523ff93d2488"==watcheeKey?setCookieWz("wz_bluechat",1,10):setCookieWz("wz_bluechat",1,5)}}function afficheDemandeCobrowsing(e){var t=e.data.datasAgent.fname+" "+e.data.datasAgent.lname;e.data.datasAgent.job;if(0==chatBot&&!cobrowsingDialogConnection){cobrowsingDialogConnection=!0;var n=document.getElementById("mydesk"),a=document.createElement("div"),s="";a.id="dialogDemandeCobrowsing",a.className="wz_connexionSocket",s+='\t<div class="wz_titleReconnexion">'+cobrowsing_request+"</div>",s+='\t<div id="tf_iconeDemandeCobrowsing" ><div class="tf_tv_iconDemande tf_tv01"></div><div class="tf_tv_iconDemande tf_tv02"></div></div>',s+='\t<div class="wz_contentReconnexion"><p class="wz_contentP">'+agent_txt+" <b>"+e.data.datasAgent.fname+" "+e.data.datasAgent.lname+"</b> "+ask_cobrowsing_txt+"</div>",s+='\t<div class="wz_btsConnexion">',s+='\t<input type="button" onclick="reponseCobrosing({reponse: true, cibleSocketID: \''+e.data.agentSocketID+"', placePupitre: "+e.data.placePupitre+", nameAgentCobrowsing: '"+t+"', jobAgentCobrowsing: '"+e.data.datasAgent.job+"', idAgentCobrowsing: "+e.data.datasAgent.id+'});" class="wz-btReconnexion" value="'+yesString+'" >',s+='\t<input type="button" onclick="reponseCobrosing({reponse: false, cibleSocketID: \''+e.data.agentSocketID+"', placePupitre: "+e.data.placePupitre+'});" class="wz-btReconnexionNo" value="'+noString+'" >',s+="\t</div>",a.innerHTML=s,1==oneAgentConnected&&n.appendChild(a)}}function effaceDemandeCobrowsing(){cobrowsingDialogConnection=!1,document.getElementById("dialogDemandeCobrowsing")&&suppr(document.getElementById("dialogDemandeCobrowsing"))}function reponseCobrosing(e){if(socket.emit("ReponseDemandeCobrowsing",{reponse:e.reponse,cibleSocketID:e.cibleSocketID,placePupitre:e.placePupitre}),effaceDemandeCobrowsing(),e.reponse){cobrowsingNameAgent=e.nameAgentCobrowsing,cobrowsingJobAgent=e.jobAgentCobrowsing;var t=document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop;sendScroll(t)}}function IndicateurCobrowsing(e){if(e.status){if(!cobrowsingStatus){if(document.getElementById("contentDesk")){cobrowsingStatus=!0;var t=document.body,n=document.createElement("div");n.id="CobrowsingActif",n.classList="Actif";var a="";a+='\t<div id="tf_iconeCobrowsing" ><div id="tf_actionCobrowsing" onclick="ActionsMenuCobrosing();"></div><div class="tf_tv_icon tf_tv1"></div><div class="tf_tv_icon tf_tv2"></div></div>',a+='\t<div class="tf_titleCobrowsing">'+cobrowsing_activated+"</div>",a+='\t<div class="tf_btn_Cobrowsing" onclick="stopCobrosing();" class="wz-btReconnexionNo">'+cancel_txt+"</div>",a+='\t<div id="tf_btn_MenuCobrowsing" class="Actif" onclick="ActionsMenuCobrosing();"></div>',n.innerHTML=a,t.appendChild(n)}autoCloseMenuCobrowsing({time:2e4,status:"start"})}}else cobrowsingStatus=!1,document.getElementById("CobrowsingActif")&&suppr(document.getElementById("CobrowsingActif")),document.getElementById("AdminPointer")&&(suppr(document.getElementById("AdminPointer")),suppr(document.getElementById("ClickPointer")))}function autoCloseMenuCobrowsing(e){"start"===e.status?timerNavCobrowsing=setTimeout(function(){var e=document.getElementById("CobrowsingActif"),t=document.getElementById("tf_btn_MenuCobrowsing");e&&e.classList.contains("Actif")&&(e.classList.remove("Actif"),e.classList.add("Inactif")),t&&t.classList.contains("Actif")&&t.classList.remove("Actif")},e.time):clearTimeout(timerNavCobrowsing)}function ActionsMenuCobrosing(){var e=document.getElementById("CobrowsingActif"),t=document.getElementById("tf_btn_MenuCobrowsing");e&&(e.classList.contains("Inactif")?(e.classList.remove("Inactif"),e.classList.add("Actif")):e.classList.contains("Actif")&&(e.classList.remove("Actif"),e.classList.add("Inactif"))),t&&(t.classList.contains("Actif")?(t.classList.remove("Actif"),autoCloseMenuCobrowsing({status:"stop"})):(t.classList.add("Actif"),autoCloseMenuCobrowsing({time:2e4,status:"start"})))}function stopCobrosing(){for(var e=0;e<agents.length;e++)agents[e][2]==cobrowsingSessionAgent&&socket.emit("VisiteurQuitCobrowsing",{chatSession:VisWzSessionid,roomName:roomName,agentID:agents[e][2],agentSocketID:agents[e][4],clientSocketID:mySocketID,status:"remove"});document.getElementById("CobrowsingActif")&&suppr(document.getElementById("CobrowsingActif")),document.getElementById("AdminPointer")&&(suppr(document.getElementById("AdminPointer")),suppr(document.getElementById("ClickPointer"))),SendPositions(),cobrowsingSessionAgent=!1,cobrowsingStatus=!1}openPrint=function(){var e,t;(document.getElementById("wz_cssMydesk")&&(e=document.getElementById("wz_cssMydesk").href),windowChat&&windowChat.close(),document.getElementById("WatchBox-titleBar"))&&document.getElementById("WatchBox-titleBar").childNodes[1].childNodes[1].textContent;var n=document.location.href;if(n=n.substring(0,n.lastIndexOf("/")),document.getElementById("WatchBox-conversation")){t=document.getElementById("WatchBox-conversation").innerHTML.replace(/draggable="false"/g,'style="max-width:20px"'),console.log("chatContentPrint : "),console.log(t),windowChat=window.open("","windowChatPrint","width=500, height=600, toolbar=1");var a="";a+="<head>",a+='<meta name="url" content="'+urlSrvRoot+'">',a+='<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">',a+='<link rel="stylesheet" href="'+e+'" type="text/css" media="all">',a+='\t<style type="text/css">',a+="\t\t@media print {#wz_navbar{display:none;}}",a+="\t\t@media screen {#wz_navbar{display:block;}}",a+="\t\tbody{margin:0px; -webkit-print-color-adjust: exact; font-family:Arial, Helvetica, sans-serif;}",a+="\t\t#contentChat{width:400px;}",a+="\t\t#urlSite{margin-top:58px; margin-left:8px;}",a+="\t\t.dates-messages { width: 100% !important; /*position: relative !important;*/ } ",a+="\t\t.dates-messages-2 {width: 100% !important; /*position: relative !important;*/} ",a+='\t\t.messageAgent.chatIMG:before { content: ""; position: absolute; left: inherit; right: 100%; top: 12px; width: 0; height: 0;  }',a+="\t\t.messageAgent {opacity: 1 !important; position: relative; color: #ffffff; float: left; border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; margin: 9px 30px 8px 55px !important; padding: 4px 4px 6px 4px;} ",a+="\t\t.messageVisiteur {opacity: 1 !important; position: relative; color: #000000; float: right;  border-radius: 4px; -moz-border-radius: 4px; -webkit-border-radius: 4px; margin: 1px 6px 14px 30px; padding: 4px 4px 6px 4px; } ",a+='\t\t.messageVisiteur:before {content: "";position: absolute;right: 8px;top: 100%;width: 0; height: 0;}',a+="\t\t.nom_Visiteur {font-size: 0.8em;margin: 0px 0px 2px 4px;}",a+="\t\t.timestamp_Visiteur, .timestamp_Agent {font-size: 0.6em;font-style: italic;position: absolute;top: 4px;right: 6px;}",a+="\t\t.message_Visiteur, .message_Agent {font-size: 0.9em;}",a+="\t\t.txtChat {padding: 0px;margin: 2px 4px 2px 4px;-webkit-hyphens: auto;-moz-hyphens: auto;-ms-hyphens: auto;-o-hyphens: auto;hyphens: auto;word-wrap: break-word;line-height: 1.1em;}",a+="\t\t.nom_Agent { font-size: 0.8em; margin: 0px 0px 2px 4px;}",a+="\t\t.WZ-chatAgentIMG {position: absolute;top: -4px;left: -52px;width: 40px;height: 40px;border-radius: 20px;-moz-border-radius: 20px;-webkit-border-radius: 20px;}",a+="\t\t.wz_iconePrintB{background-position: -425px -240px;background-repeat: no-repeat; width: 40px;height: 40px;background-color: rgb(255, 255, 255, 0.05); float:right; cursor:pointer;}",a+="\t\t.wz_iconeSaveB{background-position: -366px -61px;background-repeat: no-repeat; width: 40px;height: 40px;background-color: rgb(255, 255, 255, 0.05); margin-right: 4px; float:right; cursor:pointer;}",a+="\t\t.wz_iconeSendEmailB{background-position: -394px -239px;background-repeat: no-repeat; width: 40px;height: 40px;background-color: rgba(255, 255, 255, 0.05); margin-right: 4px; float:right; cursor:pointer;}",a+="\t\t.wz_iconeSendEmailB:hover, .wz_iconeSaveB:hover, .wz_iconePrintB:hover{background-color: rgba(255, 255, 255, 0.1);}",a+="\t\t.wz_sendEmailIcone{color:#999;font-size:1.5em; margin-Top:4px;margin-left:7px;}",a+="\t\t#wz_navbar {position:fixed; z-index:110; right:0px; top:0px; width:100%; padding:6px; background-color:rgba(40, 40, 40, 0.9)}",a+="\t\t#popupEmail .wz-txtSendChatEmail{font-size: 0.9em; margin: 0px auto 12px auto;}",a+="\t\t#popupBG{position: fixed; top: 0; left: 0; background-color: rgba(0,0,0,0.6);  height: 100%; width: 100%; z-index: 10000;}",a+="\t\t#popupBG.inactif{display:none;}",a+="\t\t#popupBG.actif{display:block;}",a+="\t\t#popupEmail{position: absolute;top: calc(50% - 75px);left: calc(50% - 150px); height: 150px;width: 300px;background-color: #eee;opacity: 1; z-index: 10010;}",a+="\t\t#popupEmail form{padding:8px}",a+="\t\t.close {float:right;position: relative;display: inline-block;width: 26px;height: 26px;overflow: hidden;}",a+="\t\t.close:hover::before, .close:hover::after {background: #222;}",a+="\t\t.close::before, .close::after {content: '';position: absolute;height: 2px;width: 100%;top: 50%;left: 0;margin-top: -1px;background: #000;}",a+="\t\t.close::before {-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);}",a+="\t\t.close::after {-webkit-transform: rotate(-45deg);-moz-transform: rotate(-45deg);-ms-transform: rotate(-45deg);-o-transform: rotate(-45deg);transform: rotate(-45deg);}",a+="\t\t.close.thick::before, .close.thick::after {height: 2px;margin-top: -2px;",a+="\t\t#closeSendChatEmail{float:right;}",a+="\t\t#popupEmail .inputEmailChat{margin-bottom:8px;}",a+="\t</style>",a+='<SCRIPT src="https://www.watcheezy.net/fo/js/extractChat.js?"><\/script>',a+='<SCRIPT language="Javascript">',a+="<\/script>",a+="</head>";var s="";s+='<div id="popupBG" class="inactif">',s+='\t<div id="popupEmail">',s+="\t</div>",s+="</div>",windowChat.document.write("<html>"+a+'<body><div id="wz_navbar"><div id="wz_btPrint" class="ui-icones wz_iconePrintB" title="Imprimer cette discussion"></div><div class="ui-icones wz_iconeSaveB" title="Sauvegarder cette discussion sur votre ordinateur" onclick="clickSave()"></div><div class="ui-icones  wz_iconeSendEmailB" title="Envoyer cette discussion sur votre email" onclick="activMail()"></div></div><div id="urlSite" >Site : '+n+'</div><hr><div id="contentChat">'+t+'</div> <SCRIPT language="Javascript">var btPrint = document.getElementById("wz_btPrint"); btPrint.onclick = function(){window.print()};<\/script>'+s+"</body></html>")}},openPopup=function(){setCookieWz("wz_popin",1,5);var e=window.open("https://www.watcheezy.net/fo/popin.php?wzkey="+watcheeKey+"&wfsessid="+VisWzSessionid+"&wfcurrpage="+currentpage,"","width=500, height=600"),t=setInterval(function(){e.closed&&(clearInterval(t),t=null,setCookieWz("wz_popin",0,-1e7),document.getElementById("vwatch").className="GeL_displayblock",document.getElementById("vwatch").style.display="block",reconnect=1)},1e3);document.getElementById("vwatch").className="GeL_displaynone",document.getElementById("vwatch").style.display="none"},1==deskAutoMsgOnOff&&""!=messageToSend&&setTimeout(function(){getCookieWz("wz_bluechat")||autoChatFo(messageToSend)},1e3*timeFirstMsg);var affichageStatusSocket=!1;function afficheStatusSocket(e){if(0==chatBot)if(e.connexion||affichageStatusSocket)document.getElementById("dialogReconnexion")&&(suppr(document.getElementById("dialogReconnexion")),reconnexionWebSocket=!1),affichageStatusSocket=!1;else{affichageStatusSocket=!0;var t=document.getElementById("mydesk"),n=document.createElement("div"),a="";n.id="dialogReconnexion",n.className="wz_connexionSocket",a+='\t<div class="wz_titleReconnexion">'+DiscussionDecoTitle+"</div>",a+='\t<div class="wz_contentReconnexion"><p class="wz_contentP">'+DiscussionDeco1+".</p>"+DiscussionDeco2+"</div>",a+='\t<div class="wz_btsConnexion">',a+='\t<input type="button" onclick="startSocket();" class="wz-btReconnexion" value="'+yesString+'" >',a+='\t<input type="button" onclick="openMydesk();" class="wz-btReconnexionNo" value="Non" >',a+="\t</div>",n.innerHTML=a,1==oneAgentConnected&&t.appendChild(n)}}function rechargeLoadBalancer(){if(navIsOffline(),socket.disconnected){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200!==e.status||(data=JSON.parse(e.responseText),sioSrvRoot="https://"+data.host,socket.destroy(),startSocket(),navIsOnline()))},e.open("POST",getnode,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send()}}function remonteChat(){if("ghsfgsf2222222222222222"==watcheeKey||"4e74a2228c249e6b158860700c3ad340"==watcheeKey)var e=document.getElementById("WatchBox-conversation-body");else e=document.getElementById("WatchBox-conversation");e.scrollTop=e.scrollHeight,resetTextarea()}function getDomain(){return window.location.hostname.split(".").join(".")}function getReferrerDomain(){var e=document.createElement("a");return e.href=document.referrer,e.hostname}navIsOnline=function(){},navIsOffline=function(){if(0==chatBot){var e=document.getElementById("mydesk");e.classList.remove("wb_online"),e.classList.add("wb_offline")}},window.addEventListener?(window.addEventListener("online",navIsOnline,!1),window.addEventListener("offline",navIsOffline,!1)):(document.body.ononline=navIsOnline,document.body.onoffline=navIsOffline);var ClickMouseAgent=function(e,t){if(document.querySelector('div[class="ClickPointer"]')){var n=document.querySelector('div[class="ClickPointer"]');n.style.left=e+"px",n.style.top=t+"px",n.classList.toggle("click"),setTimeout(function(){n.classList.toggle("click")},1e3)}};if(document.getElementById("isMobile")&&1==document.getElementById("isMobile").innerHTML){var zonechat=document.getElementById("WatchBox-conversation");zonechat.onclick=function(){document.getElementById("WatchBox-message").blur()}}var zonemessage=document.getElementById("WatchBox-message");zonemessage.onfocus=function(){document.getElementById("WatchBox-chatSend").classList.add("typing")},zonemessage.onblur=function(){document.getElementById("WatchBox-chatSend").classList.remove("typing")},flexFont=function(){if(document.getElementById("mydesk_title")){var e=document.getElementById("mydesk_title"),t=.04*e.offsetWidth;e.style.fontSize=t+"px"}if(document.getElementById("mydesk_thirdstate_text")){var n=document.getElementById("mydesk_thirdstate_text"),a=.05*n.offsetWidth;n.style.fontSize=a+"px"}},window.onload=function(e){flexFont(),"ghsfgsf2222222222222222"!=watcheeKey&&"4e74a2228c249e6b158860700c3ad340"!=watcheeKey||(flexFont(),textarearesize())},window.onresize=function(e){"ghsfgsf2222222222222222"!=watcheeKey&&"4e74a2228c249e6b158860700c3ad340"!=watcheeKey||textarearesize()},document.getElementById("mydesk_thirdstate_text")&&("ghsfgsf2222222222222222"!=watcheeKey&&"4e74a2228c249e6b158860700c3ad340"!=watcheeKey||(flexFont(),textarearesize()));